/* 
* !html5-sdk v2.0.17.17.0 | client-side HTML5 SDK 2.x
* Copyright (c) 2017 by Ooyala, www.ooyala.com 
* email: info@ooyala.com 
*/ 
!function(window,a){"use strict";var b,c={adrequest:{},adresponse:{},tracking:{}};if(window.OO){if(window.OO.Pulse)return;b=window.OO}else b={};!function(a){a.adresponse.Session=function(){return this instanceof a.adresponse.Session?(this.id="",this.language="",this.trackingEvents={},this.insertionPoints=[],void(this.secure=!1)):new a.adresponse.Session}}(c),function(a){a.adresponse.InsertionPoint=function(){return this instanceof a.adresponse.InsertionPoint?(this.parentSession=null,this.conditions=[],void(this.slots=[])):new a.adresponse.InsertionPoint},a.adresponse.InsertionPoint.isReady=function(a){for(var b,c=0;c<a.slots.length;++c){b=a.slots[c];for(var d=0;d<b.ads.length;++d)if(!b.ads[d].ready)return!1}return!0},a.adresponse.InsertionPoint.maximumPreparationTime=function(a){for(var b,c,d=0,e=0;e<a.slots.length;++e){b=a.slots[e];for(var f=0;f<b.ads.length;++f)c=b.ads[f],d+=c.maximumPreparationTime}return d}}(c),function(a){a.adresponse.Slot=function(){return this instanceof a.adresponse.Slot?(this.parentInsertionPoint=null,this.trackingEvents={},void(this.ads=[])):new a.adresponse.Slot}}(c),function(b){b.adresponse.EventCondition=function(){return this instanceof b.adresponse.EventCondition?(this.type=a,void(this.conditions=[])):new b.adresponse.EventCondition},b.adresponse.EventCondition.ConditionName={ON_BEFORE_CONTENT:"onBeforeContent",ON_CONTENT_END:"onContentEnd",ON_PAUSE:"onPause"}}(c),function(b){b.adresponse.PropertyCondition=function(){return this instanceof b.adresponse.PropertyCondition?(this.type=a,this.operator=a,this.value=a,void(this.conditions=[])):new b.adresponse.PropertyCondition},b.adresponse.PropertyCondition.Operator={EQ:"eq",GEQ:"geq"},b.adresponse.PropertyCondition.ConditionName={PLAYBACK_POSITION:"playbackPosition",TIME_SINCE_LINEAR:"timeSinceLinear",PLAYBACK_TIME:"playbackTime"}}(c),function(a){a.adresponse.Companion=function(){return this instanceof a.adresponse.Companion?(this.id="",this.customId="",this.parentAd=null,this.sequence=0,this.width=0,this.height=0,this.trackingEvents={},this.resources=[],this.required=a.adresponse.Companion.RequiredRule.NO,void(this.zone="")):new a.adresponse.Companion},a.adresponse.Companion.RequiredRule={YES:"yes",AT_LEAST_ONE_FOR_THIS_SEQUENCE:"atLeastOne",NO:"no"}}(c),function(b){b.adresponse.Ad=function(){return this instanceof b.adresponse.Ad?(this.id="",this.title="",this.description="",this.advertiser="",this.customId="",this.goalId="",this.customGoalId="",this.campaignId="",this.customCampaignId="",this.parentSlot=null,this.allowLinearityToChange=!1,this.partOfAnExclusiveCampaign=!1,this.showCountdown=!1,this.type=a,this.variant=a,this.maximumPreparationTime=0,this.startTimeout=0,this.thirdPartyURL="",this.thirdPartyChain=[],this.survey="",this.trackingEvents={},this.creatives=[],this.companions=[],this.ads=[],this.ready=!1,this.labels={},this.conditional=null,this.categories=[],this.verifications=[],void(this.pricing=null)):new b.adresponse.Ad},b.adresponse.Ad.hasPassback=function(a){return a.ready&&a.type!==b.adresponse.Ad.AdType.SPOT_SELECTOR&&a.ads.length>0},b.adresponse.Ad.AdType={INVENTORY:"inventory",SPOT_STANDARD:"spot_standard",SPOT_INTERACTIVE:"spot_interactive",SPOT_SELECTOR:"spot_selector",SPOT_TAKEOVER:"spot_takeover",OVERLAY_STANDARD:"overlay_standard",OVERLAY_VIDEO:"overlay_video",OVERLAY_IMAGESET:"overlay_imageset",OVERLAY_SPLASH:"overlay_splash",SPLASH_STANDARD:"splash_standard",SKIN_INSKIN:"skin_inskin"},b.adresponse.Ad.Variant={NORMAL:"normal",SPONSOR:"sponsor"}}(c),function(b){b.adresponse.LinearCreative=function(){var c=function(){return this instanceof b.adresponse.LinearCreative?(this.parentAd=null,this.clickThroughUrl="",this.duration=a,this.sequence=0,this.type="",this.trackingEvents={},this.skipOffset=a,this.skipButtonMode=a,this.lastCompletion=a,this.skipResetTime=a,this.mediaFiles=[],this.adParameters="",void(this.universalAdId=null)):new b.adresponse.LinearCreative};return c}(),b.adresponse.LinearCreative.SkipButtonMode={ALWAYS:"always",NEVER:"never",AFTER_FIRST_COMPLETION:"after_first_completion"}}(c),function(b){b.adresponse.NonLinearCreative=function(){var c=function(){return this instanceof b.adresponse.NonLinearCreative?(this.parentAd=null,this.duration=a,this.sequence=0,this.width=0,this.height=0,this.type="",this.trackingEvents={},void(this.resources=[])):new b.adresponse.NonLinearCreative};return c}()}(c),function(b){b.adresponse.MediaFile=function(){return this instanceof b.adresponse.MediaFile?(this.apiFramework=a,this.adParameters=a,this.bitRate=0,this.deliveryMethod=a,this.height=0,this.mimeType="",this.width=0,void(this.url="")):new b.adresponse.MediaFile},b.adresponse.MediaFile.DeliveryMethod={PROGRESSIVE:"progressive",STREAMING:"streaming"},b.adresponse.MediaFile.ApiFramework={VPAID:"VPAID"}}(c),function(a){a.adresponse.HtmlResource=function(){this.source=""}}(c),function(a){a.adresponse.IFrameResource=function(){this.url=""}}(c),function(b){b.adresponse.StaticResource=function(){this.adParameters=a,this.adParametersXmlEncoded=a,this.apiFramework=a,this.assetWidth=a,this.assetHeight=a,this.expandedWidth=a,this.expandedHeight=a,this.clickThroughUrl=a,this.mimeType=a,this.url=""},b.adresponse.StaticResource.ApiFramework={VPAID:"VPAID",CLICK_TAG:"clickTAG"}}(c),function(a){a.adrequest.URLBuilder=function(){function b(a){return a&&a.hasOwnProperty("callerVersion")?a.callerVersion:"h5_"+window.videoplaza.versionNumber}function c(c,i,j,k,l){try{d(j),e(k)}catch(m){throw m}var n=c;if(-1===n.indexOf("http://")&&-1===n.indexOf("https://")&&(n="http://"+n),n.lastIndexOf("/")!==n.length-1&&(n+="/"),n+="proxy/distributor/v2?",n+="rt=vp_3.0",n+="&pf=html5",n+="&cv="+b(k),j){j.hasOwnProperty("flags")&&j.flags.length>0&&(n+="&f="+encodeURIComponent(j.flags.join(","))),j.hasOwnProperty("tags")&&j.tags.length>0&&(n+="&t="+encodeURIComponent(j.tags.join(",")));var o="";if(j.hasOwnProperty("category")&&j.category.length>0&&(o+=j.category),j.hasOwnProperty("contentPartner")&&j.contentPartner&&(o=o?o+=","+j.contentPartner:j.contentPartner),o&&(n+="&s="+encodeURIComponent(o)),j.hasOwnProperty("contentForm")&&j.contentForm&&(n+="&cf="+f(j.contentForm)),j.hasOwnProperty("id")&&j.id&&(n+="&ci="+encodeURIComponent(j.id)),j.hasOwnProperty("duration")&&j.duration&&(n+="&cd="+j.duration),j.hasOwnProperty("customParameters")&&Object.keys(j.customParameters).length>0){var p=/[^A-Za-z0-9_~\-.]/;for(var q in j.customParameters)j.customParameters.hasOwnProperty(q)&&!p.test(q)&&(n+="&cp."+q+"="+encodeURIComponent(j.customParameters[q]))}if(j.hasOwnProperty("contentProviderInformation")&&j.contentProviderInformation){var r=j.contentProviderInformation;r.pcode&&(n+="&opc="+r.pcode),r.embedCode&&(n+="&oec="+r.embedCode)}}if(k){k.hasOwnProperty("width")&&k.width&&(n+="&vwt="+k.width),k.hasOwnProperty("pulse_preview")&&k.pulse_preview&&(n+="&vppreview="+k.pulse_preview),k.hasOwnProperty("height")&&k.height&&(n+="&vht="+k.height),k.hasOwnProperty("maxBitRate")&&k.maxBitRate&&(n+="&vbw="+k.maxBitRate),k.hasOwnProperty("linearSlotSize")&&k.linearSlotSize&&(n+="&pp="+k.linearSlotSize,n+="&mp="+k.linearSlotSize,n+="&pop="+k.linearSlotSize);var s=!1,t=!1;if(k.hasOwnProperty("insertionPointFilter")&&k.insertionPointFilter.length>0){for(var u=[],v=0;v<k.insertionPointFilter.length;v++)try{u.push(g(k.insertionPointFilter[v])),k.insertionPointFilter[v]===a.adrequest.AdRequester.InsertionPointType.PLAYBACK_POSITION?(s=!0,k.hasOwnProperty("linearPlaybackPositions")&&k.linearPlaybackPositions.length>0&&(t=!0),k.hasOwnProperty("nonlinearPlaybackPositions")&&k.nonlinearPlaybackPositions.length>0&&u.push("o")):k.insertionPointFilter[v]===a.adrequest.AdRequester.InsertionPointType.ON_BEFORE_CONTENT&&(t=!0)}catch(m){}t&&u.push("s"),u=u.filter(function(a,b,c){return c.indexOf(a)==b}),n+="&tt="+u.join(",")}else s=!0;if(s&&(k.hasOwnProperty("linearPlaybackPositions")&&k.linearPlaybackPositions.length>0&&(n+="&bp="+encodeURIComponent(k.linearPlaybackPositions.join(","))),k.hasOwnProperty("nonlinearPlaybackPositions")&&k.nonlinearPlaybackPositions.length>0&&(n+="&obp="+encodeURIComponent(k.nonlinearPlaybackPositions.join(",")))),!s&&k.hasOwnProperty("linearPlaybackPositions")&&k.linearPlaybackPositions.length>0){var w=new a.LogItem;w.message="linearPlaybackPositions provided, but insertionPointFilter excludes PLAYBACK_POSITION. No linear insertion points will be requested for the given playback positions.",w.source=a.LogItem.SourceType.SESSION,w.event=a.LogItem.EventType.WARNING,l(w)}if(!s&&k.hasOwnProperty("nonlinearPlaybackPositions")&&k.nonlinearPlaybackPositions.length>0){var w=new a.LogItem;w.message="nonlinearPlaybackPositions provided, but insertionPointFilter excludes PLAYBACK_POSITION. No nonlinear insertion points will be requested for the given playback positions.",w.source=a.LogItem.SourceType.SESSION,w.event=a.LogItem.EventType.WARNING,l(w)}k.hasOwnProperty("referrerUrl")&&k.referrerUrl&&(n+="&ru="+encodeURIComponent(k.referrerUrl)),k.hasOwnProperty("maxLinearBreakDuration")&&k.maxLinearBreakDuration&&(n+="&tbbl="+k.maxLinearBreakDuration),k.hasOwnProperty("forceSiteId")&&k.forceSiteId&&(n+="&sid="+k.forceSiteId)}i&&i.hasOwnProperty("deviceContainer")&&i.deviceContainer&&(n+="&dcid="+encodeURIComponent(i.deviceContainer)),i&&i.hasOwnProperty("persistentId")&&i.persistentId&&(n+="&pid="+encodeURIComponent(i.persistentId));var x=h("vppreview");return x&&(n+="&vppreview="+x),n+="&xpb=1",n+="&st=20:1",n+="&rnd="+Math.floor(1e16*Math.random())}function d(b){var c={id:"",category:"",contentForm:"",contentPartner:"",duration:0,flags:[],tags:[],customParameters:{}};if(b){if(b.hasOwnProperty("id")){if("string"!=typeof b.id)throw new Error("InvalidType of contentMetadata.id, should be string but is "+typeof b.id);b.id&&(c.id=b.id)}if(b.hasOwnProperty("category")&&b.category){if("string"!=typeof b.category)throw new Error("InvalidType of property contentMetadata.category, should be string but is "+typeof b.category);c.category=b.category}if(b.hasOwnProperty("contentForm")){if("string"!=typeof b.contentForm)throw new Error("InvalidType of property contentMetadata.contentForm, should be string but is "+typeof b.contentForm);if(b.contentForm!==a.adrequest.AdRequester.ContentForm.SHORT_FORM&&b.contentForm!==a.adrequest.AdRequester.ContentForm.LONG_FORM)throw new Error("Invalid contentMetadata.contentForm Value");c.contentForm=b.contentForm}if(b.hasOwnProperty("contentPartner")&&b.contentPartner){if("string"!=typeof b.contentPartner)throw new Error("InvalidType of property contentMetadata.contentPartner, should be string but is "+typeof b.contentPartner);c.contentPartner=b.contentPartner}if(b.hasOwnProperty("duration")){if("number"!=typeof b.duration)throw new Error("InvalidType of property contentMetadata.duration, should be number but is "+typeof b.duration);if(!(b.duration>=0))throw new Error("contentMetadata.duration value must be 0 or greater, but is "+b.duration);c.duration=b.duration}if(b.hasOwnProperty("flags")){if("[object Array]"!==Object.prototype.toString.call(b.flags))throw new Error("InvalidType of contentMetadata.flags, should be Array but is "+Object.prototype.toString.call(b.flags));c.flags=b.flags}if(b.hasOwnProperty("tags")){if("[object Array]"!==Object.prototype.toString.call(b.tags))throw new Error("InvalidType of contentMetadata.tags, should be Array but is "+Object.prototype.toString.call(b.tags));c.tags=b.tags}if(b.hasOwnProperty("customParameters")){if("[object Object]"!==Object.prototype.toString.call(b.customParameters))throw new Error("InvalidType of contentMetadata.customParameters, should be Object but is "+Object.prototype.toString.call(b.customParameters));for(var d in b.customParameters){if(!d)throw new Error("Empty contentMetadata.customParameters key");if("string"!=typeof b.customParameters[d])throw new Error("InvalidType of contentMetadata.customParameters property "+d+". Should be string but is "+typeof b.customParameters[d])}c.customParameters=b.customParameters}}return c}function e(b){var c,d,e={height:0,maxBitRate:0,referrerUrl:"",width:0,linearPlaybackPositions:[],nonlinearPlaybackPositions:[],insertionPointFilter:[]};if(b.hasOwnProperty("height")){if("number"!=typeof b.height)throw new Error("InvalidType of requestSettings.height, should be number but is "+typeof b.height);if(!(b.height>=0))throw new Error("Invalid value of requestSettings.height, must be larger than or equal to 0");e.height=b.height}if(b.hasOwnProperty("width")){if("number"!=typeof b.width)throw new Error("InvalidType of requestSettings.width, should be number but is "+typeof b.width);if(!(b.width>=0))throw new Error("Invalid value of requestSettings.width, must be larger than or equal to 0");e.width=b.width}if(b.hasOwnProperty("maxBitRate")){if("number"!=typeof b.maxBitRate)throw new Error("InvalidType of requestSettings.maxBitRate, should be number but is "+typeof b.maxBitRate);if(!(b.maxBitRate>=0))throw new Error("Invalid value of requestSettings.maxBitRate, must be larger than or equal to 0");e.maxBitRate=b.maxBitRate}if(b.hasOwnProperty("linearSlotSize")){if("number"!=typeof b.linearSlotSize)throw new Error("InvalidType of requestSettings.linearSlotSize, should be number but is "+typeof b.linearSlotSize);if(!(b.linearSlotSize>=0))throw new Error("Invalid value of requestSettings.linearSlotSize, must be larger than or equal to 0");e.linearSlotSize=b.linearSlotSize}if(b.hasOwnProperty("referrerUrl")){if("string"!=typeof b.referrerUrl)throw new Error("InvalidType of requestSettings.referrerUrl, should be string but is "+typeof b.referrerUrl);b.referrerUrl&&(e.referrerUrl=b.referrerUrl)}if(b.hasOwnProperty("linearPlaybackPositions")){if("[object Array]"!==Object.prototype.toString.call(b.linearPlaybackPositions))throw new Error("InvalidType of requestSettings.linearPlaybackPositions, should be [object Array] but is "+Object.prototype.toString.call(b.linearPlaybackPositions));if(b.linearPlaybackPositions.length>0)for(var f=0;f<b.linearPlaybackPositions.length;f++){if(c=b.linearPlaybackPositions[f],"number"!=typeof c||c!==c)throw new Error("InvalidType of requestSettings.linearPlaybackPositions at index "+f+". Should be of type number but is "+typeof b.linearPlaybackPositions[f]);e.linearPlaybackPositions.push(b.linearPlaybackPositions[f])}}if(b.hasOwnProperty("nonlinearPlaybackPositions")){if("[object Array]"!==Object.prototype.toString.call(b.nonlinearPlaybackPositions))throw new Error("InvalidType of requestSettings.nonlinearPlaybackPositions, should be [object Array] but is "+Object.prototype.toString.call(b.nonlinearPlaybackPositions));if(b.nonlinearPlaybackPositions.length>0)for(var g=0;g<b.nonlinearPlaybackPositions.length;g++){if(d=b.nonlinearPlaybackPositions[g],"number"!=typeof d||d!==d)throw new Error("InvalidType of requestSettings.nonlinearPlaybackPositions at index "+g+". Should be of type number but is "+typeof b.nonlinearPlaybackPositions[g]);e.nonlinearPlaybackPositions.push(b.nonlinearPlaybackPositions[g])}}if(b.hasOwnProperty("insertionPointFilter")){if("[object Array]"!==Object.prototype.toString.call(b.insertionPointFilter))throw new Error("InvalidType of requestSettings.insertionPointFilter, should be [object Array] but is "+Object.prototype.toString.call(b.insertionPointFilter));if(b.insertionPointFilter.length>0)for(var h=0;h<b.insertionPointFilter.length;h++){if("string"!=typeof b.insertionPointFilter[h])throw new Error("InvalidType of requestSettings.insertionPointFilter at index "+h+". Should be of type string but is "+typeof b.insertionPointFilter[h]);if(b.insertionPointFilter[h]!==a.adrequest.AdRequester.InsertionPointType.ON_BEFORE_CONTENT&&b.insertionPointFilter[h]!==a.adrequest.AdRequester.InsertionPointType.PLAYBACK_POSITION&&b.insertionPointFilter[h]!==a.adrequest.AdRequester.InsertionPointType.ON_CONTENT_END&&b.insertionPointFilter[h]!==a.adrequest.AdRequester.InsertionPointType.ON_PAUSE&&b.insertionPointFilter[h]!==a.adrequest.AdRequester.InsertionPointType.PLAYBACK_TIME)throw new Error("Invalid Value of requestSettings.insertionPointFilter at index "+h+". Accepted values are onBeforeContent, playbackPosition, onContentEnd, onPause or playbackTime, but is "+b.insertionPointFilter[h]);e.insertionPointFilter.push(b.insertionPointFilter[h])}}if(b.hasOwnProperty("maxLinearBreakDuration")){if("number"!=typeof b.maxLinearBreakDuration)throw new Error("InvalidType of requestSettings.maxLinearBreakDuration, should be number but is "+typeof b.maxLinearBreakDuration);if(!(b.maxLinearBreakDuration>=0))throw new Error("Invalid value of requestSettings.maxLinearBreakDuration, must be larger than or equal to 0");e.maxLinearBreakDuration=b.maxLinearBreakDuration}return e}function f(a){switch(a){case"longForm":return"long_form";case"shortForm":return"short_form"}}function g(b){switch(b){case a.adrequest.AdRequester.InsertionPointType.ON_BEFORE_CONTENT:return"p";case a.adrequest.AdRequester.InsertionPointType.PLAYBACK_POSITION:return"m";case a.adrequest.AdRequester.InsertionPointType.ON_CONTENT_END:return"po";case a.adrequest.AdRequester.InsertionPointType.ON_PAUSE:return"pa";case a.adrequest.AdRequester.InsertionPointType.PLAYBACK_TIME:return"o";default:throw new Error("InvalidInsertionPointType passed")}}function h(a){var b="",c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(window.location.href.toString());return null!==e&&(b=e[1]),b}var i=function(){this.log=function(){}};return i.prototype={setLogMethod:function(a){this.log=a},buildSessionRequestURL:function(a,b,d,e,f){var g=c(a,b,d,e,this.log);return f&&(g+="&tid="+encodeURIComponent(f.id)),g}},i}()}(c),function(c){function d(){b&&b.Pulse&&b.Pulse.Utils.log.apply(null,arguments)}c.adrequest.AdRequester=function(){function f(b,d){if(b===a||null===b)return!1;if(!b.hasOwnProperty("linearPlaybackPositions")||"[object Array]"!==Object.prototype.toString.call(b.linearPlaybackPositions)||0===b.linearPlaybackPositions.length)return!1;if(!b.hasOwnProperty("nonlinearPlaybackPositions")||"[object Array]"!==Object.prototype.toString.call(b.nonlinearPlaybackPositions)||0===b.nonlinearPlaybackPositions.length)return!1;for(var e=0;e<b.linearPlaybackPositions.length;++e)if(-1!==b.nonlinearPlaybackPositions.indexOf(b.linearPlaybackPositions[e])){var f=new c.LogItem;return f.source=c.LogItem.SourceType.SESSION,f.event=c.LogItem.EventType.ILLEGAL_OPERATION,f.message="Both linear and nonlinear ads requested for playback position "+b.linearPlaybackPositions[e]+", but only one type per position is allowed; request canceled",g(d,f),!0}return!1}function g(a,c){for(var d=0;d<a._logCallbacks.length;++d)a._logCallbacks[d](c);if(b&&b.Pulse){var error=c.message;c.errorCode&&(error+=" (VAST error code "+c.errorCode+")"),b.Pulse.Utils.logTagged([{tag:"error",color:"#B82F00"}],error)}}function h(a){return{enforceCacheBusting:a._enforceCacheBusting===!0,useVASTSkipOffset:a._useVASTSkipOffset===!0}}function i(a,b,c,d,e){var f={operation:a,list:b,context:c,step:function(){0===f.list.length?f.finish():f.operation(f.list.shift(),f.context,f.step,f.finish,f.cancel)},finish:d,cancel:e};f.step()}function j(a,e,f,h){if(e.cancelled!==!0&&e.adContext.cancelled!==!0&&e.adContext.sessionContext.sessionCancelled!==!0){var i=function(b){if(e.cancelled!==!0&&e.adContext.cancelled!==!0&&e.adContext.sessionContext.sessionCancelled!==!0){var i,j,k=new c.LogItem;try{d("Parsing VAST response from: ",a.thirdPartyURL),i=e.adContext.sessionContext.vastParser.parse(b)}catch(l){return j=l.hasOwnProperty("errorCode")?l.errorCode:"100",k.message="Could not parse third party ad: "+l.message,k.event=c.LogItem.EventType.INVALID_RESPONSE,k.thirdPartySourceURLs=a.thirdPartyChain.toString(),k.source=c.LogItem.SourceType.AD,k.errorCode=j,g(e.adContext.sessionContext.target,k),h.call(this,a,j),void(e.cancelled=!0)}i?("inventory"===i.type?(u.call(this,i,a),k.message="No ads VAST response.",k.event=c.LogItem.EventType.NO_AD_RESPONSE,k.thirdPartySourceURLs=i.thirdPartyChain.toString(),k.source=c.LogItem.SourceType.AD,k.errorCode="303",g(e.adContext.sessionContext.target,k),h(i,"303"),e.cancelled=!0):(u.call(this,i,a),setTimeout(function(){f(i)},0)),e.currentNode=i,e.adContext.currentChain=i):(setTimeout(function(){h(a,"900")},0),e.cancelled=!0)}}.bind(this),j=new c.HTTPRequester;a.thirdPartyChain.push(a.thirdPartyURL);var k=function(b){j.request(b,i,function(b){if(e.cancelled!==!0&&e.adContext.cancelled!==!0&&e.adContext.sessionContext.sessionCancelled!==!0){var d=new c.LogItem;d.message="Could not retrieve third party ad: "+b,d.event=c.LogItem.EventType.REQUEST_FAILED,d.thirdPartySourceURLs=a.thirdPartyChain.toString(),d.source=c.LogItem.SourceType.AD,d.errorCode="300",g(e.adContext.sessionContext.target,d),h(a,"300"),e.cancelled=!0}})};b&&b.Pulse&&b.Pulse.HTTPRequesterOverride&&b.Pulse.HTTPRequesterOverride.hasOwnProperty("overrideTicketRequestURL")?b.Pulse.HTTPRequesterOverride.overrideTicketRequestURL(a.thirdPartyURL,k,"thirdPartyAdRequest"):(e.adContext.sessionContext.logPassbackURL===!0&&b&&b.Pulse&&b.Pulse.Utils.log("Loading third party ad: "+a.thirdPartyURL),k(a.thirdPartyURL))}}function k(a,b,c,d){var e=function(a){k.call(this,a,b,c,d)};a.thirdPartyURL.length>0?j.call(this,a,b,e,d):(b.completed=!0,c(a))}function l(b,d,e,f){var h,i={adContext:d,cancelled:!1,completed:!1,currentNode:b},l=Date.now(),m=function(){if(i.completed!==!0&&i.cancelled!==!0&&i.adContext.cancelled!==!0&&i.adContext.sessionContext.sessionCancelled!==!0){i.cancelled=!0;var a=(Date.now()-l)/1e3,e=new c.LogItem;e.message="Could not retrieve third party ad: chain timed out after "+a+"s",e.event=c.LogItem.EventType.REQUEST_TIMEOUT,e.thirdPartySourceURLs=b.thirdPartyChain.toString(),e.source=c.LogItem.SourceType.AD,e.errorCode="301",g(d.sessionContext.target,e);for(var h=0;h<i.currentNode.creatives.length;++h)i.currentNode.creatives[h].trackingEvents={};f.call(this,i.currentNode,"301")}},n=function(a){clearTimeout(h),e.call(this,a)},o=function(a){k.call(this,a,i,n,f)}.bind(this);b.thirdPartyURL.length>0?(b.maximumPreparationTime!==a&&(h=setTimeout(m,1e3*b.maximumPreparationTime)),j.call(this,b,i,o,f)):(i.completed=!0,e.call(this,b))}function m(d,e,f,h,i){var j,k,m,n={sessionContext:e,cancelled:!1,completed:!1,currentChain:null},o=function(a,h,j){if(n.completed!==!0&&n.cancelled!==!0&&e.sessionCancelled!==!0){if(d.ads[0]&&d.ads[0].trackingEvents.report&&d.ads[0].trackingEvents.report.urls.length>0&&b&&b.Pulse&&b.Pulse._instance){var k="301"===a?"2":a;b.Pulse._instance._tracker.reportPulseError(d.ads[0],k)}var l=new c.LogItem;if(j||(l.message=h,"301"===a?l.event=c.LogItem.EventType.REQUEST_TIMEOUT:l.event=c.LogItem.EventType.REQUEST_CANCELED,l.thirdPartySourceURLs=d.thirdPartyChain.toString(),l.source=c.LogItem.SourceType.AD,l.errorCode=a,g(e.target,l)),d.ready=!0,d.ads.length>=2){var m=d.ads[d.ads.length-1];d.ads=[],null!==n.currentChain&&w(n.currentChain,d,"error"),z(d,a);for(var o=0;o<d.creatives.length;++o)d.creatives[o].trackingEvents.urls=[];u(d,m,!1,!0),r.call(this,d,m),"inventory"===m.type&&(d.companions=[]),f()}else i("No passback candidates remaining");n.cancelled=!0}}.bind(this),p=function(a,b){o("900",a,b)},q=function(){var a=(Date.now()-k)/1e3;o("301","Could not retrieve third party ad: passback timed out after "+a+"s")},s=function(a){clearTimeout(m),n.completed=!0,u(d,a,!1,!0),r.call(this,d,j),d.ads.shift(),d.ready=!0,"inventory"===d.type&&(d.companions=[]),f.call(this)}.bind(this),t=function(a,c){d.ads[0]&&d.ads[0].trackingEvents.report&&d.ads[0].trackingEvents.report.urls.length>0&&b&&b.Pulse&&b.Pulse._instance&&b.Pulse._instance._tracker.reportPulseError(d.ads[0],c),d.ads.shift();for(var e=0;e<a.creatives.length;++e)a.creatives[e].trackingEvents={};a.thirdPartyChain.length=0,a.trackingEvents.hasOwnProperty("impression")&&(a.trackingEvents.impression.urls.length=0),d.ads.length>0?(u.call(this,d.ads[0],a,!0),z(d.ads[0],c),j=d.ads[0],l.call(this,j,n,s,t)):i("No passback candidates remaining")}.bind(this);return d.ready&&e.skipLazyAds===!1||!d.ready&&e.skipLazyAds===!0?f.call(this):e.skipLazyAds&&c.adresponse.Ad.hasPassback(d)||!d.ready?(d.maximumPreparationTime!==a&&(k=Date.now(),m=setTimeout(q,1e3*d.maximumPreparationTime)),n.currentChain=d.ads[0],j=d.ads[0],l.call(this,j,n,s,t)):f(),p}function n(a,b,c,d,e){var f=a.ads.slice(0);i(m.bind(this),f,b,c,e)}function o(a,b,c,d,e){var f=a.slots.slice(0);i(n.bind(this),f,b,c,e)}function p(a,b,d,e,f){var g=new c.adrequest.VASTParser(h(this)),j={target:a,vastParser:g,sessionCancelled:!1,skipLazyAds:f},k=function(){j.sessionCancelled===!1&&d.call(this,b)}.bind(this),l=function(){j.sessionCancelled===!1&&e(b)}.bind(this),m=b.insertionPoints.slice(0);i(o,m,j,k,l);var n=function(error){j.sessionCancelled===!1&&(j.sessionCancelled=!0,e(error))};return n}function q(a,b,d){for(var f,h,i,j,k=0,l=[],m=[],n=[],o=0;o<b.insertionPoints.length;++o)h=b.insertionPoints[o],h.conditions[0].type===c.adresponse.PropertyCondition.PLAYBACK_POSITION&&l.push(h.conditions[0].value);for(var p=0;p<a.insertionPoints.length;++p){if(i=a.insertionPoints[p],j=!1,i.conditions[0].type===c.adresponse.PropertyCondition.ConditionName.PLAYBACK_POSITION)++k,-1!==l.indexOf(i.conditions[0].value)&&(j=!0,m.push(i.conditions[0].value));else for(var o=0;o<b.insertionPoints.length;++o)if(h=b.insertionPoints[o],h.conditions[0].type===i.conditions[0].type){if(i.conditions[0].type===c.adresponse.EventCondition.ConditionName.ON_PAUSE){b.insertionPoints.splice(o,1);break}j=!0,n.push(i.conditions[0].type);break}j||b.insertionPoints.push(i)}if(k>0&&k===m.length&&n.push(c.adrequest.AdRequester.InsertionPointType.PLAYBACK_POSITION),n.length>0){for(var p=0;p<n.length;++p)e[n[p]]&&(n[p]=e[n[p]]);var q=n.join(", ");f=new c.LogItem,f.source=c.LogItem.SourceType.SESSION,f.event=c.LogItem.EventType.WARNING,f.message="Some insertion point types were received, but not merged, as they already exist: "+q,g(d,f)}if(m.length>0){var q=m.join(", ");f=new c.LogItem,f.source=c.LogItem.SourceType.SESSION,f.event=c.LogItem.EventType.WARNING,f.message="Some playback positions were received, but not merged, as they already exist: "+q,g(d,f)}}function r(a,b){a.id=b.id,a.type=b.type,a.candidate=b.candidate,a.customId=b.customId,a.campaignId=b.campaignId,a.customCampaignId=b.customCampaignId,a.goalId=b.goalId,a.customGoalId=b.customGoalId,a.allowLinearityToChange=b.allowLinearityToChange,a.partOfAnExclusiveCampaign=b.partOfAnExclusiveCampaign,a.showCountdown=b.showCountdown,a.variant=b.variant;for(var c=0;c<b.creatives.length;++c)s.call(this,a.creatives[c],b.creatives[c])}function s(a,b){a.type=b.type,a.sequence=b.sequence,this._useVASTSkipOffset!==!0&&(a.skipOffset=b.skipOffset,a.skipResetTime=b.skipResetTime,a.skipButtonMode=b.skipButtonMode),a.lastCompletion=b.lastCompletion}function t(a,b){a.duration=b.duration,a.clickThroughUrl=b.clickThroughUrl,a.adParameters=b.adParameters,a.universalAdId=b.universalAdId,a.skipOffset=b.skipOffset,a.skipResetTime=b.skipResetTime,a.skipButtonMode=b.skipButtonMode}function u(a,b,d,e){if(a!==b){a.thirdPartyURL&&0===a.creatives.length&&a.creatives.push(new c.adresponse.LinearCreative);for(var f=0;f<b.thirdPartyChain.length;++f)a.thirdPartyChain.push(b.thirdPartyChain[f]);if(d?(v(b,"error"),v(b,"impression")):(v(a,"error"),v(a,"impression")),w(b,a),"inventory"!==a.type){for(var g=0;g<b.creatives.length;++g){var h=a.creatives[g],i=b.creatives[g];w(i,h);for(var j=0;j<i.mediaFiles.length;++j)h.mediaFiles.push(y(i.mediaFiles[j]));e&&t(h,i)}for(var j=0;j<b.companions.length;++j)b.companions[j].targetAd=a,a.companions.push(b.companions[j]);e?(a.title=b.title,a.pricing=b.pricing,a.verifications=b.verifications,a.categories=b.categories,a.conditional=b.conditional,a.description=b.description,a.advertiser=b.advertiser):a.pricing||(a.pricing=b.pricing)}}}function v(a,b){if(a.trackingEvents.hasOwnProperty(b)){for(var c,d=[],e=0;e<a.trackingEvents[b].urls.length;++e)c=a.trackingEvents[b].urls[e],c.thirdParty&&d.push(c);a.trackingEvents[b].urls=d}}function w(a,b,c){if(b)for(var d,e=Object.keys(a.trackingEvents),f=0;f<e.length;++f)if(d=e[f],(!c||d===c)&&a.trackingEvents.hasOwnProperty(d))if("progress"!==d)if(b.trackingEvents.hasOwnProperty(d)||(b.trackingEvents[d]={urls:[],blocked:!1}),"report"===d&&a.trackingEvents.hasOwnProperty("report")&&0==b.trackingEvents.report.urls.length)b.trackingEvents.report.urls=a.trackingEvents.report.urls;else for(var g,h=0;h<a.trackingEvents[d].urls.length;++h)g=a.trackingEvents[d].urls[h],b.trackingEvents[d].urls.push(g);else x(a.trackingEvents.progress,b)}function x(a,b){var c,d=Object.keys(a);b.trackingEvents.hasOwnProperty("progress")||(b.trackingEvents.progress={});for(var e=b.trackingEvents.progress,f=0;f<d.length;++f){c=d[f],e.hasOwnProperty(c)||(e[c]={urls:[],blocked:!1});for(var g,h=0;h<a[c].urls.length;++h)g=a[c].urls[h],e[c].urls.push(g)}}function y(a){var b=new c.adresponse.MediaFile;return b.apiFramework=a.apiFramework,b.bitRate=a.bitRate,b.deliveryMethod=a.deliveryMethod,b.height=a.height,b.id=a.id,b.mimeType=a.mimeType,b.url=a.url,b.width=a.width,b}function z(a,b){a.trackingEvents.hasOwnProperty("error")||(a.trackingEvents.error={urls:[],blocked:!1});for(var c=a.trackingEvents.error.urls,d=0;d<c.length;++d)c[d].thirdParty&&(b&&(c[d].url=c[d].url.replace(D,encodeURIComponent(b))),a.trackingEvents.hasOwnProperty("impression")||(a.trackingEvents.impression={urls:[],blocked:!1}),a.trackingEvents.impression.urls.push({url:c[d].url,thirdParty:!0}))}function A(a){return 0===a.toLowerCase().indexOf("https")}function B(a){return/(^(http|https)\:\/\/)?([a-z0-9\-]+)\.([a-z0-9\-]+)\.[a-z]+/i.test(a)}var C=function(d,h){if(!(this instanceof c.adrequest.AdRequester))return new C(d,h);if(!B(d)){var i=new Error("Argument vpHost invalid or missing");throw i.name="Invalid_Arguments",i}if(this._vpHost=d,!(h&&h instanceof Object))throw new Error("Argument adRequesterSettings invalid or missing");this._logCallbacks=[],h=JSON.parse(JSON.stringify(h)),h.hasOwnProperty("persistentId")?this._pid=h.persistentId:this._pid=a;var j=this,k=function(a,e,i,k,l){a||(a={}),e||(e={});var m=!1;if(e&&e.hasOwnProperty("pulse_preview")&&(m=e.pulse_preview),e.enforceCacheBusting===!1?this._enforceCacheBusting=!1:this._enforceCacheBusting=!0,e.useVASTSkipOffset===!0?this._useVASTSkipOffset=!0:this._useVASTSkipOffset=!1,!i){var n=new c.LogItem;return n.message="Required parameter missing: 'onSuccess' callback",n.event=c.LogItem.EventType.INVALID_ARGUMENT,n.source=c.LogItem.SourceType.SESSION,g(this,n),function(){}}if(!k){var n=new c.LogItem;return n.message="Required parameter missing: 'onFail' callback",n.event=c.LogItem.EventType.INVALID_ARGUMENT,n.source=c.LogItem.SourceType.SESSION,g(this,n),function(){}}var o=null,q=!1,r=new c.HTTPRequester,s=function(){},t=function(){},u=!1,v=function(a){var d=new c.LogItem;d.source=c.LogItem.SourceType.SESSION,q?(d.message="Session request canceled: "+a,d.event=c.LogItem.EventType.REQUEST_CANCELED):(d.message="Session request failed: "+a+" URL: "+o,d.event=c.LogItem.EventType.REQUEST_FAILED),g(j,d),window.OO&&b.Pulse&&b.Pulse.SessionRequestFailedCallback&&o?b.Pulse.SessionRequestFailedCallback(o,a,w,k):k(l?l:a)},w=function(a){u=!0;var b,e,f=new c.adrequest.VPTP3Parser(m);try{b=JSON.parse(a)}catch(l){throw new Error("Unable to parse VPTP Ticket, malformed JSON data: "+l.message)}try{e=f.parse(b),e.secure=A(d)&&!h.ignoreSecure}catch(n){var o=new c.LogItem;return o.message=n.message,o.event=c.LogItem.EventType.INVALID_RESPONSE,o.source=c.LogItem.SourceType.SESSION,g(j,o),void k(n.message)}s=p.call(this,j,e,i,v,!0)}.bind(this),x=function(error){q=!0,u===!1?t(error):s(error)},y=function(){return e&&e.hasOwnProperty("vptpTicketData")&&e.vptpTicketData};if(y())return setTimeout(w,0,e.vptpTicketData),function(){};if(f(e,this))return setTimeout(function(){k(l?l:"Incompatible request settings")},0),function(){};try{var z=new c.adrequest.URLBuilder;z.setLogMethod(function(a){g(this,a)}.bind(this));var o=z.buildSessionRequestURL(d,h,a,e,l),B=function(a){t=r.request(a,w,v)};window.OO&&b.Pulse&&b.Pulse.HTTPRequesterOverride&&b.Pulse.HTTPRequesterOverride.hasOwnProperty("overrideTicketRequestURL")?b.Pulse.HTTPRequesterOverride.overrideTicketRequestURL(o,B,"firstPartyAdRequest"):B(o);
}catch(C){var n=new c.LogItem;return n.message=C.message,n.event=c.LogItem.EventType.INVALID_ARGUMENT,n.source=c.LogItem.SourceType.SESSION,g(this,n),k(C.message),null}return x}.bind(this);this.requestSession=function(a,b,c,d){return k.call(this,a,b,c,d)},this.requestSessionExtension=function(d,h,i,l){var m;if(null===d||d===a||!(d instanceof c.adresponse.Session))return m=new c.LogItem,m.source=c.LogItem.SourceType.SESSION,m.event=c.LogItem.EventType.INVALID_ARGUMENT,d?m.message="Invalid type: only Session accepted for argument 'session'":m.message="Required parameter missing: 'session'",g(this,m),function(){};if(null===i||i===a)return m=new c.LogItem,m.source=c.LogItem.SourceType.SESSION,m.event=c.LogItem.EventType.INVALID_ARGUMENT,m.message="Required parameter missing: 'requestSettings'",g(this,m),function(){};if(null===l||l===a)return m=new c.LogItem,m.source=c.LogItem.SourceType.SESSION,m.event=c.LogItem.EventType.INVALID_ARGUMENT,m.message="Required parameter missing: 'onComplete' callback",g(this,m),function(){};var n=[],o=[],p=[],r=[];if(!i.hasOwnProperty("insertionPointFilter")||i.hasOwnProperty("insertionPointFilter")&&0===i.insertionPointFilter.length){for(var s in c.adrequest.AdRequester.InsertionPointType)n.push(c.adrequest.AdRequester.InsertionPointType[s]);o.push(c.adrequest.AdRequester.InsertionPointType.PLAYBACK_POSITION)}else{n=n.concat(i.insertionPointFilter);for(var t=0;t<n.length;++t)if(n[t]===c.adrequest.AdRequester.InsertionPointType.PLAYBACK_POSITION){o.push(c.adrequest.AdRequester.InsertionPointType.PLAYBACK_POSITION);break}}var u,v=[],w=[];if(i.linearPlaybackPositions)for(var x=0;x<i.linearPlaybackPositions.length;++x){u=!0;for(var t=0;t<d.insertionPoints.length;++t)if(C=d.insertionPoints[t],C.conditions[0].type===c.adresponse.PropertyCondition.ConditionName.PLAYBACK_POSITION&&C.conditions[0].value===i.linearPlaybackPositions[x]){u=!1,w.push(i.linearPlaybackPositions[x]);break}u&&p.push(i.linearPlaybackPositions[x])}if(i.nonlinearPlaybackPositions)for(var x=0;x<i.nonlinearPlaybackPositions.length;++x){u=!0;for(var t=0;t<d.insertionPoints.length;++t)if(C=d.insertionPoints[t],C.conditions[0].type===c.adresponse.PropertyCondition.ConditionName.PLAYBACK_POSITION&&C.conditions[0].value===i.nonlinearPlaybackPositions[x]){u=!1,w.push(i.nonlinearPlaybackPositions[x]);break}u&&r.push(i.nonlinearPlaybackPositions[x])}if(f(i,this))return setTimeout(function(){l(d)},0),function(){};for(var y=0;y<n.length;++y){var z=n[y],A=!0;if(z!==c.adrequest.AdRequester.InsertionPointType.ON_PAUSE){for(var B=0;B<d.insertionPoints.length;B++){var C=d.insertionPoints[B];if(C.conditions[0].type===z&&z!==c.adrequest.AdRequester.InsertionPointType.PLAYBACK_POSITION){v.push(z),A=!1;break}}A&&z!==c.adrequest.AdRequester.InsertionPointType.PLAYBACK_POSITION&&o.push(z)}else o.push(z)}if(v.length>0){for(var t=0;t<v.length;++t)e[v[t]]&&(v[t]=e[v[t]]);var D=v.join(", ");m=new c.LogItem,m.source=c.LogItem.SourceType.SESSION,m.event=c.LogItem.EventType.WARNING,m.message="Some insertion point types were excluded from the request, as they already exist: "+D,g(this,m)}if(w.length>0){var D=w.join(", ");m=new c.LogItem,m.source=c.LogItem.SourceType.SESSION,m.event=c.LogItem.EventType.WARNING,m.message="Some playback positions were excluded from the request, as they already exist: "+D,g(this,m)}if(0===p.length&&0===r.length&&(o=o.filter(function(a,b,d){return a!==c.adrequest.AdRequester.InsertionPointType.PLAYBACK_POSITION})),o.length>0){var E=function(a){return a.id!==d.id?(m=new c.LogItem,m.source=c.LogItem.SourceType.SESSION,m.event=c.LogItem.EventType.ILLEGAL_OPERATION,m.message="The request response's session id does not match; unmodified session returned",g(j,m),void l(d)):(q(a,d,j),void l(d))},F=JSON.parse(JSON.stringify(i));F.insertionPointFilter=o,i&&(F.linearPlaybackPositions=p,F.nonlinearPlaybackPositions=r);var G=function(error){b&&b.Pulse&&b.Pulse.Utils.logTagged([{tag:"error",color:"#B82F00"}],error),l(d)};return k.call(this,h,F,E,G,d)}return m=new c.LogItem,m.source=c.LogItem.SourceType.SESSION,m.event=c.LogItem.EventType.ILLEGAL_OPERATION,m.message="None of the provided insertion point types and/or playback positions can be requested again; unmodified session returned",g(this,m),setTimeout(function(){l(d)},0),function(){}}};C.prototype.addLogListener=function(a){a&&"[object Function]"==Object.prototype.toString.call(a)&&this._logCallbacks.push(a)},C.prototype.requestThirdParty=function(b,d){var e;if(b instanceof c.adresponse.InsertionPoint)e=!0;else{if(!(b instanceof c.adresponse.Ad))throw new Error("The supplied third party container is not of a valid type: only InsertionPoints and Ads are accepted");e=!1}if(b._partOfOngoingRequest)throw new Error("The supplied container is already waiting for a request response");if(e&&!b._partOfOngoingRequest)for(var f=0;f<b.slots.length;f++)for(var i=b.slots[f],j=0;j<i.ads.length;j++){var k=i.ads[j];if(k._partOfOngoingRequest)throw new Error("The supplied insertionPoint has ads already waiting for a request response")}if(!e&&b.ready)return void d(b);var l=function(a){if(a?b._partOfOngoingRequest=a:delete b._partOfOngoingRequest,e)for(var c=0;c<b.slots.length;c++)for(var d=b.slots[c],f=0;f<d.ads.length;f++){var g=d.ads[f];a?g._partOfOngoingRequest=a:delete g._partOfOngoingRequest}};l(!0);var n,p=!1,q=function(a){throw l(!1),new Error("Third party request failed unexpectedly: "+a)},r=function(){l(!1),p=!0,d.call(this,b)}.bind(this),s=new c.adrequest.VASTParser(h(this)),t={target:this,vastParser:s,sessionCancelled:!1,skipLazyAds:!1},u=!1;e?(n=function(error){if(!p&&t.sessionCancelled===!1){for(var d,e,f,h=function(){},i=0;i<b.slots.length;++i)if(d=b.slots[i],i===b.slots.length-1)for(var j=0;j<d.ads.length;++j)e=d.ads[j],(f=m.call(this,e,t,h,a,h))("Third party ad request cancelled",!0);var k=new c.LogItem;k.message="Third party request for insertion point canceled: "+error,k.source=c.LogItem.SourceType.AD,k.event=c.LogItem.EventType.REQUEST_CANCELED,g(t.target,k),t.sessionCancelled=!0,r()}}.bind(this),o.call(this,b,t,r,a,q)):n=m.call(this,b,t,r,a,q);var v=function(a){if(u)throw new Error("Request has already been cancelled");u=!0,n(a)};return v},C.prototype.requestPassback=function(b,d,e){var f,g=!1;if(f=c.tracking.Tracker.resolveErrorCode(b,d),b instanceof c.adresponse.LinearCreative)b=b.parentAd,g=!0;else if(!(b instanceof c.adresponse.Ad))throw new Error("Invalid type: only Creative or Ad accepted");if(b.hasOwnProperty("trackingEvents")&&b.trackingEvents.hasOwnProperty("error")&&b.trackingEvents.error.hasOwnProperty("blocked")&&b.trackingEvents.error.blocked===!0)throw new Error("Cannot request passback after tracking error");if(b.hasOwnProperty("trackingEvents")&&b.trackingEvents.hasOwnProperty("impression")&&b.trackingEvents.impression.hasOwnProperty("blocked")&&b.trackingEvents.impression.blocked===!0)throw new Error("Cannot request passback after tracking impression");if(b._partOfOngoingRequest)throw g?new Error("The supplied creative's parent ad is already waiting for a request response"):new Error("The supplied ad is already waiting for a request response");if(b._partOfOngoingRequest=!0,!c.adresponse.Ad.hasPassback(b))throw g?new Error("The supplied creative's parent ad has no passback candidates available"):new Error("The supplied ad has no passback candidates available");var i,j=function(a){throw delete b._partOfOngoingRequest,new Error("Passback loading failed unexpectedly: "+a)},k=function(){for(var a=0;a<i.length;++a)i[a].thirdParty&&b.trackingEvents.error.urls.push(i[a]);delete b._partOfOngoingRequest,e.call(this,b)}.bind(this);b.trackingEvents.impression.urls.length=0,z(b,f),i=b.trackingEvents.error.urls,b.trackingEvents.error.urls=[];for(var l=0;l<b.creatives.length;++l)b.creatives[l].trackingEvents={},b.creatives[l].mediaFiles=[];b.companions=[];var n=new c.adrequest.VASTParser(h(this)),o={target:this,vastParser:n,sessionCancelled:!1,skipLazyAds:!0,logPassbackURL:!0},p=!1,q=m.call(this,b,o,k,a,j),r=function(a){if(p)throw new Error("Request has already been cancelled");p=!0,q.call(this,a)}.bind(this);return r};var D=/\[ERRORCODE\]|%5BERRORCODE%5D/g;return C}(),c.adrequest.AdRequester.InsertionPointType={ON_BEFORE_CONTENT:"onBeforeContent",PLAYBACK_POSITION:"playbackPosition",ON_CONTENT_END:"onContentEnd",ON_PAUSE:"onPause",PLAYBACK_TIME:"playbackTime"};var e={};for(var f in c.adrequest.AdRequester.InsertionPointType){var g=c.adrequest.AdRequester.InsertionPointType[f];e[g]=f}c.adrequest.AdRequester.ContentForm={SHORT_FORM:"shortForm",LONG_FORM:"longForm"}}(c),function(b){b.adrequest.VASTParser=function(){function c(a,c){var f,g,h,m,o,p,q,error,r,s,t=!1;if(f=new b.adresponse.Ad,!(a.getElementsByTagName("AdSystem").length>0))throw error=new Error,error.message='Invalid VAST. VAST Ad missing "AdSystem" element.',error.errorCode="101",error;var u=a.getElementsByTagName("AdSystem")[0].textContent;if(u&&u.toLowerCase().indexOf("videoplaza karbon")>-1&&(t=!0),a.getElementsByTagName("AdTitle").length>0){var v=a.getElementsByTagName("AdTitle")[0].textContent;v&&(f.title=v)}if(a.getElementsByTagName("Description").length>0){var w=a.getElementsByTagName("Description")[0].textContent;w&&(f.description=w)}if(a.getElementsByTagName("Advertiser").length>0){var x=a.getElementsByTagName("Advertiser")[0].textContent;x&&(f.advertiser=x)}if("Wrapper"===a.firstChild.nodeName){if(g=a.getElementsByTagName("VASTAdTagURI"),!(g.length>0))throw error=new Error,error.message="Invalid VAST. VAST Wrapper Ad missing VASTAdTagURI element.",error.errorCode="101",error;f.thirdPartyURL=g[0].textContent}else g=null;for(f.sequence=k(a,"sequence")?parseInt(k(a,"sequence")):0,f.id=k(a,"id"),null===f.id&&(t?(f.id="0",f.type="inventory"):f.id=""),m=a.getElementsByTagName("Extension"),h=0;h<m.length;h++)"AdServer"===k(m[h],"type")&&"Videoplaza"===k(m[h],"name")&&(o=m[h].getElementsByTagName("AdInfo")[0],f.campaignId=k(o,"cid"),f.customId=k(o,"customaid"),f.customGoalId=k(o,"customgid"),f.customCampaignId=k(o,"customcid"),f.goalId=k(o,"gid"),f.type=l(k(o,"format")),f.variant=j(k(o,"variant")),f.partOfAnExclusiveCampaign="true"===k(o,"exclusive"),p=o.getElementsByTagName("Companion"));for(d.call(this,f,a,"Impression","impression",c),s=a.getElementsByTagName("Survey"),s.length>0&&(f.survey=n(s[0].textContent)),q=a.getElementsByTagName("Error"),null===g&&t&&0===q.length&&"inventory"===f.type&&(q=a.getElementsByTagName("Impression")),h=0;h<q.length;h++)f.trackingEvents.hasOwnProperty("error")||(f.trackingEvents.error={urls:[],blocked:!1}),f.trackingEvents.error.urls.push({url:i.call(this,n(q[h].textContent),c),thirdParty:!0});if(r=a.getElementsByTagName("Creative"),!t&&0===r.length&&null===g)throw error=new Error,error.message="Invalid VAST. VAST InLine Ad missing creatives!",error.errorCode="101",error;if(f.creatives=e.call(this,r,f,c),f.creatives&&f.creatives[0]&&f.creatives[0].mediaFiles&&f.creatives[0].mediaFiles[0]&&"VPAID"!==f.creatives[0].mediaFiles[0].apiFramework&&a.getElementsByTagName("Impression").length<1)throw error=new Error,error.message="Invalid VAST. VAST Ad missing Impression elements!",error.errorCode="101",error;if("4.0"===c){var y=k(a,"conditionalAd");"false"===y?f.conditional=!1:"true"===y&&(f.conditional=!0);var z=a.getElementsByTagName("ViewableImpression");z.length>0&&(z=z[0],d.call(this,f,z,"Viewable","impressionViewable",c),d.call(this,f,z,"NotViewable","impressionNotViewable",c),d.call(this,f,z,"ViewUndetermined","impressionViewUndetermined",c));var A=a.getElementsByTagName("AdVerifications")[0];if(A)for(var B=A.getElementsByTagName("Verification"),C=0;C<B.length;++C){var D=B[C],E={trackingEvents:{}},F=D.getElementsByTagName("JavaScriptResource")[0];if(F){var G=k(F,"apiFramework");E.javascriptResource=n(F.textContent),E.javascriptResourceAPIFramework=G}var H=D.getElementsByTagName("FlashResource")[0];if(H){var I=k(H,"apiFramework");E.flashResource=n(H.textContent),E.flashResourceAPIFramework=I}var z=D.getElementsByTagName("ViewableImpression");z.length>0&&(z=z[0],d.call(this,E,z,"Viewable","impressionViewable",c),d.call(this,E,z,"NotViewable","impressionNotViewable",c),d.call(this,E,z,"ViewUndetermined","impressionViewUndetermined",c)),(E.javascriptResource||E.flashResource)&&f.verifications.push(E)}for(var J=a.getElementsByTagName("Category"),C=0;C<J.length;++C){var K=J[C],L=n(K.textContent),M=k(K,"authority");if(M)f.categories.push({label:L,authority:M});else if(L)throw error=new Error,error.message="Invalid VAST. Category without authority attribute.",error.errorCode="101",error}var N=a.getElementsByTagName("Pricing")[0];if(N){var O=k(N,"model"),P=k(N,"currency"),Q=parseFloat(n(N.textContent));if(!O||!P)throw error.message="Invalid VAST. Pricing is missing model or currency attributes.",error.errorCode="101",error;if(O=O.toLowerCase(),"cpm"!==O&&"cpc"!==O&&"cpe"!==O&&"cpv"!==O)throw error.message='Invalid VAST. Unknown pricing model "'+O+'".',error.errorCode="101",error;f.pricing={model:O,currency:P,value:Q}}}return f}function d(a,b,c,d,e){for(var f=b.getElementsByTagName(c),g=0;g<f.length;g++){a.trackingEvents.hasOwnProperty(d)||(a.trackingEvents[d]={urls:[],blocked:!1});var h=k(f[g],"id");h?a.trackingEvents[d].urls.push({id:h,url:i.call(this,n(f[g].textContent),e),thirdParty:!0}):a.trackingEvents[d].urls.push({url:i.call(this,n(f[g].textContent),e),thirdParty:!0})}}function e(c,d,e){for(var g,j,l,m,o,error,p,q,r,s,t,u,v,w,x=[],y=0,z=0;z<c.length;z++){m=k(c[z],"id");var A;if(g=c[z].getElementsByTagName("Linear")[0],j=c[z].getElementsByTagName("NonLinearAds")[0],l=c[z].getElementsByTagName("CompanionAds")[0],g){for(++y,A=new b.adresponse.LinearCreative,A.parentAd=d,A.type="linear",A.id=m,A.sequence=k(c[z],"sequence")?parseInt(k(c[z],"sequence")):0,p=c[z].getElementsByTagName("TrackingEvents"),p.length>0&&(A.trackingEvents=f.call(this,p[0],e)),r=c[z].getElementsByTagName("ClickTracking"),q=0;q<r.length;q++)A.trackingEvents.hasOwnProperty("clickthrough")||(A.trackingEvents.clickthrough={urls:[],blocked:!1}),A.trackingEvents.clickthrough.urls.push({url:i.call(this,n(r[q].textContent),e),thirdParty:!0});for(var B=c[z].getElementsByTagName("CustomClick"),C=0;C<B.length;C++)A.trackingEvents.hasOwnProperty("customClick")||(A.trackingEvents.customClick={urls:[],blocked:!1}),A.trackingEvents.customClick.urls.push({url:i.call(this,n(B[C].textContent),e),thirdParty:!0});if(s=c[z].getElementsByTagName("ClickThrough"),s.length>0&&(A.clickThroughUrl=n(s[0].textContent)),t=c[z].getElementsByTagName("MediaFile"),0===d.thirdPartyURL.length){if(!t||0===t.length)throw error=new Error,error.message="Invalid VAST. Creative element has no MediaFiles.",error.errorCode="101",error;for(q=0;q<t.length;q++){if(u=new b.adresponse.MediaFile,!k(t[q],"delivery"))throw error=new Error,error.message='Invalid VAST. MediaFile missing property "delivery".',error.errorCode="101",error;if(!k(t[q],"width"))throw error=new Error,error.message='Invalid VAST. MediaFile missing property "width".',error.errorCode="101",error;if(!k(t[q],"height"))throw error=new Error,error.message='Invalid VAST. MediaFile missing property "height".',error.errorCode="101",error;if(!k(t[q],"type"))throw error=new Error,error.message='Invalid VAST. MediaFile missing property "type".',error.errorCode="101",error;u.apiFramework=k(t[q],"apiFramework"),u.bitRate=parseFloat(k(t[q],"bitrate")),u.deliveryMethod=k(t[q],"delivery"),u.height=parseFloat(k(t[q],"height")),u.id=k(t[q],"id"),u.mimeType=k(t[q],"type"),u.url=t[q].textContent,u.width=parseFloat(k(t[q],"width")),A.mediaFiles.push(u)}if("4.0"===e){var D=c[z].getElementsByTagName("UniversalAdId")[0];if(!D)throw error=new Error,error.message="Invalid VAST. VAST 4.0 creative without UniversalAdId element.",error.errorCode="101",error;var E=n(D.textContent),F=k(D,"idRegistry");F||(F="unknown"),A.universalAdId={identifier:E,registry:F}}}else if(0!==t.length)throw error=new Error,error.message="Invalid VAST. MediaFile elements not allowed in Wrapper Linear.",error.errorCode="101",error;if(0===d.thirdPartyURL.length){if(o=c[z].getElementsByTagName("Duration"),!o||0===o.length)throw error=new Error,error.message="Invalid VAST. No Duration element.",error.errorCode="101",error;try{A.duration=h(o[0].textContent)}catch(G){A.duration=a}}else o=0;if(w=k(g,"skipoffset"),A.skipResetTime=0,w){var H;if(w.indexOf("%")>-1)if(A.duration){var I=parseFloat(String(w).substring(0,w.indexOf("%")));H=isNaN(I)?a:(A.duration||0)*(I/100)}else H=w;else H=h(w);A.skipOffset=H,A.skipButtonMode=b.adresponse.LinearCreative.SkipButtonMode.ALWAYS}else A.skipButtonMode=b.adresponse.LinearCreative.SkipButtonMode.NEVER;A.adParameters=c[z].getElementsByTagName("AdParameters"),A.adParameters.length>0?A.adParameters=n(A.adParameters[0].textContent):A.adParameters=null,x.push(A)}else if(j&&0===d.thirdPartyURL.length){var J=j.getElementsByTagName("NonLinear");if(J.length>0)throw error=new Error,error.message="Invalid VAST. VAST nonlinear creatives not accepted.",error.errorCode="101",error}else if(l&&"3.0"===e&&(v=k(l,"required"),null!==v&&"none"!==v))throw error=new Error,error.message='Invalid VAST. VAST 3.0 companions not accepted unless "required" attribute is "none".',error.errorCode="101",error}if(y>1)throw error=new Error,error.message="Invalid VAST. Ads with multiple linear creatives are not supported.",error.errorCode="101",error;return x}function f(a,c){var d,e,f,h,j;d={},e=a.getElementsByTagName("Tracking");for(var l=0;l<e.length;l++)if(f=e.item(l),h=k(f,"event"),"acceptinvitationlinear"===h.toLowerCase()?h=b.tracking.Tracker.CreativeEventType.ACCEPT_INVITATION:"closelinear"===h.toLowerCase()&&(h=b.tracking.Tracker.CreativeEventType.CLOSE),"progress"===h){if(j=k(f,"offset"),!g(j)){var error=new Error;throw error.message="Invalid VAST. Progress event with missing or invalid offset value.",error.errorCode="101",error}d.hasOwnProperty(h)||(d[h]={}),d[h].hasOwnProperty(j)||(d[h][j]={urls:[],blocked:!1}),d[h][j].urls.push({url:i.call(this,n(f.textContent),c),thirdParty:!0})}else d.hasOwnProperty(h)||(d[h]={urls:[],blocked:!1}),d[h].urls.push({url:i.call(this,n(f.textContent),c),thirdParty:!0});return d}function g(a){return a&&null!==a.match(o)}function h(a){var b=a.split(":"),c=0;if(!(b.length>0&&b.length<=3))throw new Error("Invalid VAST. Invalid timestamp format");for(var d=0;d<b.length;d++)c+=Number(b[b.length-d-1]*(d?Math.pow(60,d):1));if(isNaN(c))throw new Error("Invalid VAST. Invalid timestamp format");return c}function i(a,b){return this.options.enforceCacheBusting&&"2.0"===b&&-1===a.indexOf("[CACHEBUSTING]")&&-1===a.indexOf("%5BCACHEBUSTING%5D")&&a.length>0&&(a+=a.indexOf("?")>-1?"&rnd=[CACHEBUSTING]":"?rnd=[CACHEBUSTING]"),a}function j(a){return a&&(a=a.toLowerCase(),"bumper"===a||"sponsor"===a)?"sponsor":"normal"}function k(a,b){var c;return a&&a.attributes&&(c=a.attributes.getNamedItem(b))?c.value:null}function l(a){return"spot_standard"===a?"standard_spot":a}function m(a){var b,c,d=/^\s*$/;if(3===a.nodeType)d.test(a.nodeValue)&&a.parentNode.removeChild(a);else if(8===a.nodeType&&"#comment"===a.nodeName)a.parentNode.removeChild(a);else if(1===a.nodeType||9===a.nodeType)for(b=a.firstChild;b;)c=b.nextSibling,m(b),b=c}function n(a){return a.replace(/^\s+|\s+$/g,"")}var o=/^(\d\d:\d\d:\d\d(.\d\d\d)?)$|^((100)|(\d\d?)|(1\d\d?\.0*)|(\d\d?\.\d?\d?)|(\.\d\d?))%$/,p=function(a){return a=a||{},a.enforceCacheBusting!==!1&&(a.enforceCacheBusting=!0),a.useVASTSkipOffset!==!0&&(a.useVASTSkipOffset=!1),this.options=a,this.parser=new window.DOMParser,this instanceof b.adrequest.VASTParser?void 0:new p};return p.prototype.parse=function(a){var d,e,f,g,error,h;try{d=this.parser.parseFromString(a,"text/xml")}catch(j){throw error=new Error,error.message="Could not parse VAST. "+j.message,error.errorCode="100",error}if(e=d.documentElement,m(e),!e)throw error=new Error,error.message="Could not parse VAST. No root element",error.errorCode="100",error;if("VAST"!==e.nodeName)throw error=new Error,error.message='Could not parse VAST. Root element is not "VAST".',error.errorCode="100",error;h=k(e,"version");var l;if(e.hasChildNodes()){if(f=e.getElementsByTagName("Ad"),g=e.getElementsByTagName("Error"),"Ad"===e.firstChild.nodeName){if(f.length>1)throw error=new Error,error.message="Invalid VAST. Found more than one ad.",error.errorCode="101",error;l=c.call(this,f[0],h)}else if("Error"===e.firstChild.nodeName){l=new b.adresponse.Ad,l.id="0",l.type="inventory";for(var o=0;o<g.length;o++)l.trackingEvents.hasOwnProperty("error")||(l.trackingEvents.error={urls:[],blocked:!1}),l.trackingEvents.error.urls.push({url:i.call(this,n(g[o].textContent),h),thirdParty:!0})}else if("parsererror"===e.firstChild.nodeName)throw error=new Error,error.message="Could not parse VAST. XML bad form: "+n(e.firstChild.textContent),error.errorCode="100",error}else l=new b.adresponse.Ad,l.id="0",l.type="inventory";for(var p=0;p<l.creatives.length;++p){var q=l.creatives[p];q instanceof b.adresponse.LinearCreative&&q.mediaFiles.sort(function(a,b){return a.bitRate||(a.bitRate=0),b.bitRate||(b.bitRate=0),0===a.bitRate&&0===b.bitRate?0:0===a.bitRate&b.bitRate>0?-1:a.bitRate>0&0===b.bitRate?1:b.bitRate-a.bitRate})}return l},p}(),b.adrequest.VAST3Parser=b.adrequest.VASTParser}(c),function(b){b.adrequest.VPTP3Parser=function(){function c(a){var b=[];if("[object Object]"!==Object.prototype.toString.call(a))throw new Error("VPTP Ticket trackingEvents should be object but is "+Object.prototype.toString.call(a));if(!(a.tracking.length>0))throw new Error("VPTP Ticket trackingEvents.tracking can not be empty");for(var c=0;c<a.tracking.length;c++)b[a.tracking[c].event]?b[a.tracking[c].event].urls.push({url:a.tracking[c].value}):b[a.tracking[c].event]={urls:[{url:a.tracking[c].value}],blocked:!1};return b}function d(a,c,d){var f=[];if("[object Array]"!==Object.prototype.toString.call(a))throw new Error("VPTP Ticket insertionPoint should be array but is "+Object.prototype.toString.call(a));for(var g=0;g<a.length;g++){var h=new b.adresponse.InsertionPoint;if(h.parentSession=c,!p(a[g],"conditions"))throw new Error("VPTP Ticket insertionPoint is missing conditions!");if(h.conditions=n(a[g].conditions.condition),!p(a[g],"slot"))throw new Error("VPTP Ticket insertionPoint is missing slots!");h.slots=e(a[g].slot,h,c,d),f.push(h)}return f}function e(a,c,d,e){var g=[];if("[object Array]"!==Object.prototype.toString.call(a))throw new Error("VPTP Ticket insertionPoint.slot should be array but is "+Object.prototype.toString.call(a));if(!(a.length>0))throw new Error("VPTP Ticket insertionPoint.slot cannot be empty!");for(var h=0;h<a.length;h++){var i=a[h],j=new b.adresponse.Slot;if(j.parentInsertionPoint=c,p(i,"trackingEvents")){if("[object Object]"!==Object.prototype.toString.call(i.trackingEvents))throw new Error("VPTP Ticket insertionPoint.slot.trackingEvents should be object but is "+Object.prototype.toString.call(i.trackingEvents));if(!p(i.trackingEvents,"tracking"))throw new Error("VPTP Ticket slot.trackingEvents is missing tracking object!");if("[object Array]"!==Object.prototype.toString.call(i.trackingEvents.tracking))throw new Error("VPTP Ticket insertionPoint.slot.trackingEvents.tracking should be array but is "+Object.prototype.toString.call(i.trackingEvents.tracking));for(var k=0;k<i.trackingEvents.tracking.length;++k){var l=i.trackingEvents.tracking[k];if(!p(l,"event"))throw new Error("VPTP Ticket slot.trackingEvent object is missing event property!");if("string"!=typeof l.event)throw new Error("VPTP Ticket slot.trackingEvent object event property should be string but is "+typeof l.event);if(!p(l,"value"))throw new Error("VPTP Ticket slot.trackingEvent object is missing value property!");if("string"!=typeof l.value)throw new Error("VPTP Ticket slot.trackingEvent object value property should be string but is "+typeof l.value);j.trackingEvents[l.event]?j.trackingEvents[l.event].urls.push({url:l.value}):j.trackingEvents[l.event]={urls:[{url:l.value}],blocked:!1}}}if(!p(i,"vast"))throw new Error("VPTP Ticket insertionPoint.slot missing VAST property!");if(!p(i.vast,"ad"))throw new Error("VPTP Ticket insertionPoint.slot.vast missing 'ad' property!");if("[object Array]"!==Object.prototype.toString.call(i.vast.ad))throw new Error("VPTP Ticket insertionPoint.slot.vast.ad property should be array but is "+Object.prototype.toString.call(i.vast.ad));if(!(i.vast.ad.length>0))throw new Error("VPTP Ticket insertionPoint.slot.vast.ad array is empty!");for(var n=i.vast.ad,o=n.length,q=[],r=0;o>r;r++){var s=null;if(!p(n[r],"inLine"))throw new Error("VPTP Ticket ad missing 'inLine' property!");if("[object Object]"!==Object.prototype.toString.call(n[r].inLine))throw new Error("VPTP Ticket ad.inLine property should be object but is "+Object.prototype.toString.call(n[r].inLine));if(p(n[r].inLine,"creatives")){if("[object Object]"!==Object.prototype.toString.call(n[r].inLine.creatives))throw new Error("VPTP Ticket ad.inLine.creatives property should be object but is "+Object.prototype.toString.call(n[r].inLine.creatives));if(!p(n[r].inLine.creatives,"creative"))throw new Error("VPTP Ticket ad.inLine.creatives missing 'creative' property!");if("[object Array]"!==Object.prototype.toString.call(n[r].inLine.creatives.creative))throw new Error("VPTP Ticket ad.inLine.creatives.creative property should be array but is "+Object.prototype.toString.call(n[r].inLine.creatives.creative));for(var t=0;t<n[r].inLine.creatives.creative.length;t++){var u=n[r].inLine.creatives.creative[t];if(p(u,"linear")){if("[object Object]"!==Object.prototype.toString.call(u.linear))throw new Error("Creative.linear should be object but is "+Object.prototype.toString.call(u.linear));if(!p(u.linear,"adParameters"))throw new Error("Linear is missing AdParameters!");if("[object Object]"!==Object.prototype.toString.call(u.linear.adParameters))throw new Error("Linear AdParameters should be object but is "+Object.prototype.toString.call(u.linear.adParameters));if(!p(u.linear.adParameters,"value"))throw new Error("Linear AdParameters is missing 'value' property!");if("[object String]"!==Object.prototype.toString.call(u.linear.adParameters.value))throw new Error("Unparsed AdParameters.value should be string but is "+Object.prototype.toString.call(u.linear.adParameters.value));u.linear.adParameters.value=JSON.parse(u.linear.adParameters.value)}else{if(!p(u,"nonLinearAds"))throw new Error("Creative is missing linear or nonLinearAds property!");if("[object Object]"!==Object.prototype.toString.call(u.nonLinearAds))throw new Error("Creative.nonLinearAds should be object but is "+Object.prototype.toString.call(u.nonLinearAds));if(!p(u.nonLinearAds,"nonLinear"))throw new Error("Creative.nonLinearAds is missing nonLinear!");if("[object Array]"!==Object.prototype.toString.call(u.nonLinearAds.nonLinear))throw new Error("Creative.nonLinearAds.nonLinear should be array but is "+Object.prototype.toString.call(u.nonLinearAds.nonLinear));if(0===u.nonLinearAds.nonLinear.length)throw new Error("Creative.nonLinearAds.nonLinear is empty!");if(!p(u.nonLinearAds.nonLinear[0],"adParameters"))throw new Error("Creative.nonLinearAds.nonLinear is missing AdParameters!");if("[object Object]"!==Object.prototype.toString.call(u.nonLinearAds.nonLinear[0].adParameters))throw new Error("Creative.nonLinearAds.nonLinear.adParameters should be object but is "+Object.prototype.toString.call(u.nonLinearAds.nonLinear[0].adParameters));if(!p(u.nonLinearAds.nonLinear[0].adParameters,"value"))throw new Error("Creative.nonLinearAds.nonLinear.adParameters is missing 'value' property!");if("[object String]"!==Object.prototype.toString.call(u.nonLinearAds.nonLinear[0].adParameters.value))throw new Error("Unparsed AdParameters.value should be string but is "+Object.prototype.toString.call(u.nonLinearAds.nonLinear[0].adParameters.value));u.nonLinearAds.nonLinear[0].adParameters.value=JSON.parse(u.nonLinearAds.nonLinear[0].adParameters.value)}if(0===t)if(p(u,"linear")){if(p(u.linear,"mediaFiles")&&p(u.linear.mediaFiles,"mediaFile")){if("[object Array]"!==Object.prototype.toString.call(u.linear.mediaFiles.mediaFile))throw new Error("VPTP Linear Creative.mediaFiles.mediaFile should be Array but is "+Object.prototype.toString.call(u.linear.mediaFiles.mediaFile));if(0===u.linear.mediaFiles.mediaFile.length)s=f(n[r],j,e);else{if(!p(u.linear.mediaFiles.mediaFile[0],"value"))throw new Error("VPTP MediaFile missing value property!");if("string"!=typeof u.linear.mediaFiles.mediaFile[0].value)throw new Error("VPTP MediaFile value property should be string but is "+typeof u.linear.mediaFiles.mediaFile[0].value);-1!=u.linear.mediaFiles.mediaFile[0].value.indexOf("spot_selector")&&(s=f(n[r],j,e),s.type=b.adresponse.Ad.AdType.SPOT_SELECTOR)}}s||(s=f(n[r].inLine.creatives.creative[0].linear.adParameters.value.ad[0],j,e))}else p(u,"nonLinearAds")&&(s=f(n[r].inLine.creatives.creative[0].nonLinearAds.nonLinear[0].adParameters.value.ad[0],j,e))}}else s=f(n[r],j,e),s.type="inventory";if(null!=s){if("spot_selector"!==s.type&&s.ads.length>0){for(var v=0,w=0;w<s.ads.length;++w)v+=s.ads[w].maximumPreparationTime;s.maximumPreparationTime=Math.min(s.maximumPreparationTime,v)}switch(s.type){case b.adresponse.Ad.AdType.SKIN_INSKIN:case b.adresponse.Ad.AdType.SPOT_INTERACTIVE:case b.adresponse.Ad.AdType.SPOT_SELECTOR:case b.adresponse.Ad.AdType.SPOT_TAKEOVER:s=m(s);default:q.push(s)}}}j.ads=q,g.push(j)}return g}function f(a,c,d,e){var i=new b.adresponse.Ad;if(i.parentSlot=c,e?i.candidate=e:i.candidate=1,i.ready=!0,p(a,"id")&&(i.id=a.id),p(a,"inLine")||p(a,"wrapper")){var l="inLine";if(p(a,"wrapper")){if(l="wrapper",!p(a[l],"vastadTagURI"))throw new Error("VPTP Wrapper ad missing vastadTagURI!");if(!(a[l].vastadTagURI.length>0))throw new Error("VPTP Wrapper ad vastadTagURI is empty!");i.thirdPartyURL=a[l].vastadTagURI}if(!p(a[l],"impression"))throw new Error("VPTP ad "+l+" is missing impression property!");if("[object Array]"!==Object.prototype.toString.call(a[l].impression))throw new Error("VPTP ad "+l+" impression property should be array but is "+Object.prototype.toString.call(a[l].impression));if(a[l].impression.length>0)for(var m=a[l].impression,n=m.length,q=0;n>q;q++){var r=m[q];p(i.trackingEvents,"impression")||(i.trackingEvents.impression={urls:[],blocked:!1}),"inLine"===l&&p(r,"value")?i.trackingEvents.impression.urls.push({url:r.value.toString()}):"wrapper"===l&&i.trackingEvents.impression.urls.push({url:r.toString()})}if(p(a[l],"error")){if("string"!=typeof a[l].error)throw new Error("VPTP Ad error property should be string but is "+typeof a[l]);a[l].error.length>0&&(p(i.trackingEvents,"error")?i.trackingEvents.error.urls.push({url:a[l].error}):i.trackingEvents.error={urls:[{url:a[l].error}],blocked:!1})}if(p(a[l],"adTitle")&&(i.title=a[l].adTitle.toString()),p(a[l],"creatives")){if("[object Object]"===Object.prototype.toString.call(a[l].creatives)&&p(a[l].creatives,"creative")&&"[object Array]"===Object.prototype.toString.call(a[l].creatives.creative)&&a[l].creatives.creative.length>0)for(var s,t=a[l].creatives.creative,u=t.length,v=0;u>v;v++){var w=t[v];if(s=0,p(w,"sequence")&&(s=parseInt(w.sequence),NaN===s&&(s=0)),p(w,"linear")){var x=new b.adresponse.LinearCreative;if(x.parentAd=i,x.sequence=s,p(w,"id")&&(x.type=w.id),p(w.linear,"duration")&&("string"==typeof w.linear.duration?x.duration=o(w.linear.duration):"number"==typeof w.linear.duration&&(x.duration=w.linear.duration)),p(w.linear,"mediaFiles")){if(!p(w.linear.mediaFiles,"mediaFile"))throw new Error("VPTP Linear Creative.mediaFiles missing mediaFile property!");if("[object Array]"===Object.prototype.toString.call(w.linear.mediaFiles.mediaFile)&&w.linear.mediaFiles.mediaFile.length>0)for(var y=w.linear.mediaFiles.mediaFile,z=y.length,A=0;z>A;A++){var B=y[A],C=new b.adresponse.MediaFile;if(!p(B,"value"))throw new Error("VPTP MediaFile missing value property!");if("string"!=typeof B.value)throw new Error("VPTP MediaFile value property should be string but is "+typeof B.value);if(C.url=B.value,!p(B,"type"))throw new Error("VPTP MediaFile missing type property!");
if("string"!=typeof B.type)throw new Error("VPTP MediaFile type property should be string but is "+typeof B.type);if(C.mimeType=B.type,!p(B,"width"))throw new Error("VPTP MediaFile missing width property!");if("number"!=typeof B.width)throw new Error("VPTP MediaFile width property should be number but is "+typeof B.width);if(C.width=parseFloat(B.width),!p(B,"height"))throw new Error("VPTP MediaFile missing height property!");if("number"!=typeof B.height)throw new Error("VPTP MediaFile height property should be number but is "+typeof B.height);if(C.height=parseFloat(B.height),!p(B,"bitrate"))throw new Error("VPTP MediaFile missing bitrate property!");if("number"!=typeof B.bitrate)throw new Error("VPTP MediaFile bitrate property should be number but is "+typeof B.bitrate);if(C.bitRate=parseFloat(B.bitrate),!p(B,"delivery"))throw new Error("VPTP MediaFile missing delivery property!");if("string"!=typeof B.delivery)throw new Error("VPTP MediaFile delivery property should be string but is "+typeof B.delivery);if(C.deliveryMethod=B.delivery,p(B,"apiFramework")){if("string"!=typeof B.apiFramework)throw new Error("VPTP MediaFile apiFramework property should be string but is "+typeof B.apiFramework);C.apiFramework=B.apiFramework}p(x,"mediaFiles")||(x.mediaFiles=[]),x.mediaFiles.push(C)}}else if("wrapper"!==l)throw new Error("VPTP Linear Creative missing mediaFiles property!");if(p(w.linear,"videoClicks")){if("[object Object]"!==Object.prototype.toString.call(w.linear.videoClicks))throw new Error("VPTP Linear Creative.videoClicks should be Object but is "+Object.prototype.toString.call(w.linear.videoClicks));if(!p(w.linear.videoClicks,"clickTracking"))throw new Error("VPTP Linear Creative videoClicks missing clickTracking property!");if("[object Array]"!==Object.prototype.toString.call(w.linear.videoClicks.clickTracking))throw new Error("VPTP Linear Creative.videoClicks.clickTracking should be Array but is "+Object.prototype.toString.call(w.linear.videoClicks.clickTracking));if(w.linear.videoClicks.clickTracking.length>0){p(x.trackingEvents,"clickthrough")||(x.trackingEvents.clickthrough={urls:[],blocked:!1});for(var q=0;q<w.linear.videoClicks.clickTracking.length;++q){var D=w.linear.videoClicks.clickTracking[q];if(!p(D,"value"))throw new Error("VPTP ClickTracking object missing value property!");if("string"!=typeof D.value)throw new Error("VPTP ClickTracking value property should be string but is "+typeof D.value);x.trackingEvents.clickthrough.urls.push({url:D.value})}}if(p(w.linear.videoClicks,"clickThrough")){if("[object Object]"!==Object.prototype.toString.call(w.linear.videoClicks.clickThrough))throw new Error("VPTP Linear Creative.videoClicks clickThrough property should be object but is "+Object.prototype.toString.call(w.linear.videoClicks.clickThrough));if(!p(w.linear.videoClicks.clickThrough,"value"))throw new Error("VPTP Linear Creative.videoClicks.clickThrough missing value property!");if("string"!=typeof w.linear.videoClicks.clickThrough.value)throw new Error("VPTP Linear Creative.videoClicks.clickThrough value property should be string but is "+typeof w.linear.videoClicks.clickThrough.value);x.clickThroughUrl=w.linear.videoClicks.clickThrough.value}}if(p(w.linear,"trackingEvents")){if("[object Object]"!==Object.prototype.toString.call(w.linear.trackingEvents))throw new Error("VPTP Linear Creative.trackingEvents should be Object but is "+Object.prototype.toString.call(w.linear.trackingEvents));if(!p(w.linear.trackingEvents,"tracking"))throw new Error("VPTP Linear Creative missing trackingEvents.tracking property!");if("[object Array]"!==Object.prototype.toString.call(w.linear.trackingEvents.tracking))throw new Error("VPTP Linear Creative.trackingEvents.tracking should be Array but is "+Object.prototype.toString.call(w.linear.trackingEvents.tracking));if(w.linear.trackingEvents.tracking.length>0)x.trackingEvents=j(x.trackingEvents,w.linear.trackingEvents.tracking);else{if(!d)throw new Error("VPTP Linear Creative.trackingEvents.tracking array is empty!");x.trackingEvents=[]}}if(w.linear.hasOwnProperty("skipOffset")||w.linear.hasOwnProperty("skipoffset")){var E,F=w.linear.hasOwnProperty("skipoffset")?w.linear.skipoffset:w.linear.skipOffset;if(F.indexOf("%")>-1){var G=parseFloat(String(F).substring(0,F.indexOf("%")));E=(x.duration||0)*(G/100)}else E=o(F);x.skipOffset=E}if(i.creatives.push(x),p(w.linear,"adParameters")&&"[object Object]"===Object.prototype.toString.call(w.linear.adParameters)&&p(w.linear.adParameters,"value")&&"[object Object]"===Object.prototype.toString.call(w.linear.adParameters.value)&&p(w.linear.adParameters.value,"ad")){if("[object Array]"!==Object.prototype.toString.call(w.linear.adParameters.value.ad))throw new Error("VPTP Linear Creative adParameters.value.ad should be Array but is "+Object.prototype.toString.call(w.linear.adParameters.value.ad));if(!(w.linear.adParameters.value.ad.length>0))throw new Error("VPTP Linear Creative adParameters.value.ad is empty!");for(var H=w.linear.adParameters.value.ad,I=H.length,J=0;I>J;J++){var K=f(H[J],c,d,J+1);K&&(p(K,"lazyPrepared")&&(i.ready=!1),i.ads.push(K))}}}else if(p(w,"nonLinearAds"))p(w.nonLinearAds,"nonLinear")&&h(i,w.nonLinearAds,s,w.id,d);else if(p(w,"companionAds")&&p(w.companionAds,"companion")){var L=b.adresponse.Companion.RequiredRule.NO;if(p(w.companionAds,"required"))switch(w.companionAds.required){case"all":L=b.adresponse.Companion.RequiredRule.YES;break;case"any":L=b.adresponse.Companion.RequiredRule.AT_LEAST_ONE_FOR_THIS_SEQUENCE;break;case"none":L=b.adresponse.Companion.RequiredRule.NO}g(i,w.companionAds.companion,s,L)}}}else i.type="inventory",i.trackingEvents.error=i.trackingEvents.impression,i.trackingEvents.impression={urls:[],blocked:!1};i=k(i,a)}for(var q=0;q<i.creatives.length;++q){var M=i.creatives[q];M instanceof b.adresponse.LinearCreative&&M.mediaFiles.sort(function(a,b){return a.bitRate?b.bitRate?a.bitRate<b.bitRate?1:b.bitRate<a.bitRate?-1:0:-1:1})}return i}function g(a,c,d,e){for(var f,g,h=0;h<c.length;++h){if(f=c[h],g=new b.adresponse.Companion,g.parentAd=a,g.sequence=d,g.required=e,!p(f,"width"))throw new Error("VPTP Companion missing required attribute width");if(g.width=parseInt(f.width),isNaN(g.width))throw new Error("VPTP Companion width is not a number");if(!p(f,"height"))throw new Error("VPTP Companion missing required attribute height");if(g.height=parseInt(f.height),isNaN(g.height))throw new Error("VPTP Companion height is not a number");if(p(f,"id")&&(g.id=f.id),i(f,g,!0),p(f,"trackingEvents")){if("[object Object]"!==Object.prototype.toString.call(f.trackingEvents))throw new Error("VPTP Linear Companion.trackingEvents should be Object but is "+Object.prototype.toString.call(f.trackingEvents));if(!p(f.trackingEvents,"tracking"))throw new Error("VPTP Linear Companion missing trackingEvents.tracking property!");if("[object Array]"!==Object.prototype.toString.call(f.trackingEvents.tracking))throw new Error("VPTP Linear Companion.trackingEvents.tracking should be Array but is "+Object.prototype.toString.call(f.trackingEvents.tracking));if(!(f.trackingEvents.tracking.length>0))throw new Error("VPTP Linear Companion.trackingEvents.tracking array is empty!");g.trackingEvents=j(g.trackingEvents,f.trackingEvents.tracking)}if(p(f,"companionClickTracking")){p(g.trackingEvents,"clickThrough")||(g.trackingEvents.clickThrough={urls:[],blocked:!1});for(var k,l,h=0;h<f.companionClickTracking.length;++h){if(k=f.companionClickTracking[h],!p(k,"value"))throw new Error("Companion has ClickTracking with no URL value");l={url:k.value,thirdPartyURL:!0},p(k,"id")||(l.id=k.id),g.trackingEvents.clickThrough.urls.push(l)}}a.companions.push(g)}}function h(a,c,d,e,f){for(var g,h,k=0;k<c.nonLinear.length;++k){if(g=c.nonLinear[k],h=new b.adresponse.NonLinearCreative,h.parentAd=a,h.sequence=d,p(g,"minSuggestedDuration")&&("string"==typeof g.minSuggestedDuration?h.duration=o(g.minSuggestedDuration):"number"==typeof g.minSuggestedDuration&&(h.duration=g.minSuggestedDuration),isNaN(h.duration)))throw new Error("VPTP NonLinearCreative duration is not a number");if(p(g,"width")&&(h.width=parseInt(g.width),isNaN(h.width)))throw new Error("VPTP NonLinearCreative width is not a number");if(p(g,"height")&&(h.height=parseInt(g.height),isNaN(h.height)))throw new Error("VPTP NonLinearCreative height is not a number");if(e&&(h.type=e),i(g,h,!1),p(c,"trackingEvents")){if("[object Object]"!==Object.prototype.toString.call(c.trackingEvents))throw new Error("VPTP nonLinearAds trackingEvents should be Object but is "+Object.prototype.toString.call(c.trackingEvents));if(!p(c.trackingEvents,"tracking"))throw new Error("VPTP nonLinearAds missing trackingEvents.tracking property!");if("[object Array]"!==Object.prototype.toString.call(c.trackingEvents.tracking))throw new Error("VPTP nonLinearAds trackingEvents.tracking should be Array but is "+Object.prototype.toString.call(c.trackingEvents.tracking));if(c.trackingEvents.tracking.length>0)h.trackingEvents=j(h.trackingEvents,c.trackingEvents.tracking);else{if(!f)throw new Error("VPTP nonLinearAds trackingEvents.tracking array is empty!");h.trackingEvents=[]}}if(p(g,"nonLinearClickTracking")){p(h.trackingEvents,"clickThrough")||(h.trackingEvents.clickThrough={urls:[],blocked:!1});for(var l,m,k=0;k<g.nonLinearClickTracking.length;++k){if(l=g.nonLinearClickTracking[k],!p(l,"value"))throw new Error("NonLinearCreative has ClickTracking with no URL value");m={url:l.value,thirdPartyURL:!0},p(l,"id")||(m.id=l.id),h.trackingEvents.clickThrough.urls.push(m)}}a.creatives.push(h)}}function i(a,c,d){var e,f=d?"Companion":"NonLinearCreative";if(p(a,"staticResource")){if(!p(a.staticResource,"value"))throw new Error("VPTP "+f+" has StaticResource with no URL value");if(e=new b.adresponse.StaticResource,e.url=a.staticResource.value,p(a.staticResource,"creativeType")&&(e.mimeType=a.staticResource.creativeType),p(a,"apiFramework")&&(e.apiFramework=a.apiFramework),p(a,"adParameters")&&p(a.adParameters,"value")&&(e.adParameters=a.adParameters.value,p(a.adParameters,"xmlEncoded"))){if("boolean"!=typeof a.adParameters.xmlEncoded)throw new Error("VPTP "+f+" has adParameters.xmlEncoded with invalid type");e.adParametersXmlEncoded=a.adParameters.xmlEncoded}if(d?p(a,"companionClickThrough")&&(e.clickThroughUrl=a.companionClickThrough):p(a,"nonLinearClickThrough")&&(e.clickThroughUrl=a.nonLinearClickThrough),p(a,"assetWidth")&&(e.assetWidth=parseInt(a.assetWidth),isNaN(e.assetWidth)))throw new Error("VPTP "+f+" assetWidth is not a number");if(p(a,"assetHeight")&&(e.assetHeight=parseInt(a.assetHeight),isNaN(e.assetHeight)))throw new Error("VPTP "+f+" assetHeight is not a number");if(p(a,"expandedWidth")&&(e.expandedWidth=parseInt(a.expandedWidth),isNaN(e.expandedWidth)))throw new Error("VPTP "+f+" expandedWidth is not a number");if(p(a,"expandedHeight")&&(e.expandedHeight=parseInt(a.expandedHeight),isNaN(e.expandedWidth)))throw new Error("VPTP "+f+" expandedHeight is not a number");c.resources.push(e)}p(a,"iframeResource")&&(e=new b.adresponse.IFrameResource,e.url=a.iframeResource,c.resources.push(e)),a.hasOwnProperty("htmlResource")?(e=new b.adresponse.HtmlResource,e.source=a.htmlResource.value,c.resources.push(e)):a.hasOwnProperty("htmlresource")&&(e=new b.adresponse.HtmlResource,e.source=a.htmlresource.value,c.resources.push(e))}function j(a,c){a||(a={});for(var d=0;d<c.length;d++){var e=c[d];if(!p(e,"value"))throw new Error("VPTP Tracking object missing value property!");if(!p(e,"event"))throw new Error("VPTP Tracking object missing event property!");var f="";switch(e.event){case"3":case"4":case"91":f="";break;case"10":f="interaction";break;case"100":f="timeSpent";break;default:f=e.event}"acceptinvitationlinear"===f.toLowerCase()?f=b.tracking.Tracker.CreativeEventType.ACCEPT_INVITATION:"closelinear"===f.toLowerCase()&&(f=b.tracking.Tracker.CreativeEventType.CLOSE),f.length>0&&(p(a,f)||(a[f]={urls:[],blocked:!1}),a[f].urls.push({url:e.value.toString()}))}return a}function k(c,d){var e=a,f=null;if(p(d,"inLine"))f=d.inLine;else{if(!p(d,"wrapper"))return c;f=d.wrapper}var g=null;if(p(f,"extensions")){if(!p(f.extensions,"extension"))throw new Error("VPTP Extensions missing extension property!");if("[object Array]"!==Object.prototype.toString.call(f.extensions.extension))throw new Error("VPTP Extensions.extension should be array but is "+Object.prototype.toString.call(f.extensions.extension));if(f.extensions.extension.length>0)for(var h=f.extensions.extension,i=h.length,j=0;i>j;j++){var k=h[j];p(k,"adInfo")&&(g=k.adInfo)}}if(!c||!g)return c;if(p(g,"report")){p(c.trackingEvents,"report")||(c.trackingEvents.report={urls:[],blocked:!1});var m=/\[PASSBACK_INDEX\]|%5BPASSBACK_INDEX%5D/g,n=g.report.replace(m,encodeURIComponent(c.candidate));c.trackingEvents.report.urls=[{url:n,thirdParty:!1}]}if(p(g,"format")&&(c.type=g.format),p(g,"requestType")&&"lazy"===g.requestType&&null!==c.thirdPartyURL&&(c.lazyPrepared=!0),p(g,"timeout"))c.maximumPreparationTime=o(g.timeout);else if(b.adresponse.Ad.hasPassback(c))throw new Error("VPTP Extensions missing timeout value");if(p(g,"startAdTimeout")&&(c.startTimeout=o(g.startAdTimeout)),p(g,"variant")?c.variant=g.variant&&"normal"!==g.variant.toLowerCase()?"sponsor":"normal":c.variant="normal",p(g,"gid")&&(c.goalId=g.gid),p(g,"cid")&&(c.campaignId=g.cid),p(g,"customaid")&&(c.customId=g.customaid),p(g,"customgid")&&(c.customGoalId=g.customgid),p(g,"customcid")&&(c.customCampaignId=g.customcid),p(g,"allowLinearModeChange")&&(c.allowLinearModeChange="true"==g.allowLinearModeChange||"TRUE"==g.allowLinearModeChange),p(g,"countdown")&&(c.showCountdown="true"==g.countdown||"TRUE"==g.countdown),p(g,"exclusive")&&(c.partOfExclusiveCampaign="true"==g.exclusive||"TRUE"==g.exclusive),g.hasOwnProperty("labels")&&g.labels.hasOwnProperty("label")&&"[object Array]"===Object.prototype.toString.call(g.labels.label)&&g.labels.label.length>0)for(var q=0;q<g.labels.label.length;q++){var r=g.labels.label[q];r.hasOwnProperty("name")&&r.hasOwnProperty("value")&&(c.labels[r.name]=r.value)}p(g,"lastImpression")&&(e=Number(g.lastImpression)),p(g,"lastCompletion")&&(e=Number(g.lastCompletion));for(var s=c.creatives.filter(function(a,c,d){return a instanceof b.adresponse.LinearCreative||a instanceof b.adresponse.NonLinearCreative}),t=0;t<s.length;t++){var u=s[t];if(p(g,"showSkipButton")&&(g.showSkipButton===b.adresponse.LinearCreative.SkipButtonMode.ALWAYS?u.skipButtonMode=b.adresponse.LinearCreative.SkipButtonMode.ALWAYS:g.showSkipButton===b.adresponse.LinearCreative.SkipButtonMode.NEVER?u.skipButtonMode=b.adresponse.LinearCreative.SkipButtonMode.NEVER:g.showSkipButton===b.adresponse.LinearCreative.SkipButtonMode.AFTER_FIRST_COMPLETION&&(u.skipButtonMode=b.adresponse.LinearCreative.SkipButtonMode.AFTER_FIRST_COMPLETION),"after_first_impression"===g.showSkipButton&&(u.skipButtonMode=b.adresponse.LinearCreative.SkipButtonMode.AFTER_FIRST_COMPLETION)),g.hasOwnProperty("skipOffset")||g.hasOwnProperty("skipoffset")){var v,w=g.hasOwnProperty("skipoffset")?g.skipoffset:g.skipOffset;if(w.indexOf("%")>-1&&c&&c.creatives&&c.creatives[0]&&c.creatives[0].duration){var x=parseFloat(String(w).substring(0,w.indexOf("%")));v=(c.creatives[0].duration||0)*(x/100)}else v=o(w);u.skipOffset=v}p(g,"skipReset")&&(u.skipResetTime=o(g.skipReset)),u.lastCompletion=e}if(p(g,"companions")&&p(g.companions,"companion"))for(var y=g.companions.companion,q=0;q<y.length;++q)l(c,y[q]);return c}function l(a,b){var c=null;if(!p(b,"id"))throw new Error("VPTP Companion AdInfo is missing id");for(var d=0;d<a.companions.length;++d)if(a.companions[d].id===b.id){c=a.companions[d];break}if(null!==c){if(p(b,"customaid")&&(c.customId=b.customaid),!p(b,"zone"))throw new Error("VPTP Companion AdInfo is missing zone");c.zone=b.zone}}function m(a){var c=new b.adresponse.Ad;return c.type=b.adresponse.Ad.AdType.INVENTORY,a.type==b.adresponse.Ad.AdType.SPOT_SELECTOR?c.trackingEvents.error=a.ads[0].trackingEvents.error:c.trackingEvents.error=a.trackingEvents.error,c.parentSlot=a.parentSlot,c}function n(a){var c=[];if("[object Array]"!==Object.prototype.toString.call(a))throw new Error("VPTP Ticket conditions should be array but is "+Object.prototype.toString.call(a));for(var d=0;d<a.length;d++){var e,f=a[d];if(!p(f,"type"))throw new Error("VPTP condition is missing type property!");if("string"!=typeof f.type)throw new Error("VPTP condition type property should be string but is "+typeof f.type);if("EVENT"===f.type)e=new b.adresponse.EventCondition;else{if("PROPERTY"!==f.type)throw new Error("VPTP condition with unknown type: "+f.type);e=new b.adresponse.PropertyCondition}if(!p(f,"name"))throw new Error("VPTP condition is missing name property!");if("string"!=typeof f.name)throw new Error("VPTP condition name property should be string but is "+typeof f.name);if(e.type=f.name.toLowerCase().substr(0,1)+f.name.substr(1),e instanceof b.adresponse.PropertyCondition){if(p(f,"value")){if("string"!=typeof f.value)throw new Error("VPTP condition value property should be string but is "+typeof f.value);e.value=o(f.value)}if(p(f,"operator")){if("string"!=typeof f.operator)throw new Error("VPTP condition operator property should be string but is "+typeof f.operator);e.operator=f.operator.toLowerCase()}}if(p(f,"condition")){if("[object Array]"!==Object.prototype.toString.call(f.condition))throw new Error("VPTP condition condition property should be Array but is "+Object.prototype.toString.call(f.condition));e.conditions=n(f.condition)}c.push(e)}return c}function o(a){if(!a)return Number.NaN;var b=a.split(":");if(!b||0===b.length)return Number.NaN;var c=0;b.length>=1&&isNaN(parseFloat(b[b.length-1]))===!1&&(c=parseFloat(b[b.length-1]));var d=0;b.length>=2&&isNaN(parseFloat(b[b.length-2]))===!1&&(d=parseInt(b[b.length-2]));var e=0;return b.length>=3&&isNaN(parseFloat(b[b.length-3]))===!1&&(e=parseInt(b[b.length-3])),c+60*d+3600*e}function p(a,b){var c=[];for(var d in a)c.push({actual:d,lowerCase:d.toLowerCase()});for(var e=0;e<c.length;e++)if(c[e].lowerCase===b.toLowerCase()){if(c[e].actual===b)return!0;throw new Error("Invalid object property key! Expected: "+b+" but was: "+c[e].actual)}return!1}var q=function(a){return this instanceof b.adrequest.VPTP3Parser?void(this._previewMode=a):new q(a)};return q.prototype.parse=function(a){var e=new b.adresponse.Session;if(e.id=a.tid||"",e.language=a.lang||"",p(a,"trackingEvents")&&(e.trackingEvents=c(a.trackingEvents)),!p(a,"insertionPoint"))throw new Error("VPTP Ticket is missing insertionPoints!");return e.insertionPoints=d(a.insertionPoint,e,this._previewMode),e},q}()}(c),function(b){b.tracking.Tracker=function(){function c(a){var b;for(var c in a.trackingEvents)a.trackingEvents[c].blocked=!0;for(var d=0;d<a.creatives.length;++d){b=a.creatives[d];for(var c in b.trackingEvents)if("progress"===c)for(var e in b.trackingEvents.progress)b.trackingEvents.progress[e].blocked=!0;else b.trackingEvents[c].blocked=!0}}function d(a,c){if(!a.hasOwnProperty("trackingEvents")){var d=new b.LogItem;throw d.source=b.LogItem.SourceType.TRACKER,d.event=b.LogItem.EventType.INVALID_ARGUMENT,d.message="Missing trackingEvents property on the passed Session Object. Can not track event '"+c+"'.",s(this,d),new Error("Abort execution")}if(!a.trackingEvents.hasOwnProperty(c)){var d=new b.LogItem;throw d.source=b.LogItem.SourceType.TRACKER,d.event=b.LogItem.EventType.REQUEST_FAILED,d.message="Event '"+c+"' does not exist on the passed Session Object.",s(this,d),new Error("Abort execution")}if(a.trackingEvents[c].blocked){var d=new b.LogItem;throw d.source=b.LogItem.SourceType.TRACKER,d.event=b.LogItem.EventType.ILLEGAL_OPERATION,d.message="Can not track '"+c+"' more than once on the passed Session Object.",s(this,d),new Error("Abort execution")}a.trackingEvents[c].blocked=!0,f.apply(this,[a.secure,a.trackingEvents[c].urls])}function e(a,c){return function(error){if(!c){var d=new b.LogItem;d.source=b.LogItem.SourceType.TRACKER,d.event=b.LogItem.EventType.REQUEST_FAILED,d.message=error+". Failed to track URL : "+a.url,s(this,d)}}}function f(a,c,d,f){for(var g=this,h="undefined"!=typeof a?a:!1,i=new b.HTTPRequester(h),j=0;j<c.length;j++){var k=c[j];if(k){var l=e(k,f).bind(g),m=k.url.replace(A,encodeURIComponent(d));m=m.replace(B,encodeURIComponent(d)),m=m.replace(D,Math.floor(1e16*Math.random())),i.imgRequest(m,l)}}}function g(a,b,c){for(var d=a;d<y.length;++d)h.apply(this,[b,y[d],c,!0])}function h(a,c,d,e){var g=a,h=k(a);"error"===c&&(a instanceof b.adresponse.LinearCreative||a instanceof b.adresponse.NonLinearCreative)&&(a=a.parentAd);for(var i=Object.keys(a.trackingEvents),j=!1,l=0;l<i.length;l++)if(i[l].toLowerCase()===c.toLowerCase())if(a.trackingEvents[i[l]].blocked){if(!e){var m=new b.LogItem;throw m.source=b.LogItem.SourceType.TRACKER,m.event=b.LogItem.EventType.ILLEGAL_OPERATION,m.message="Can not track '"+c+"' more than once"+u(g),s(this,m),new Error("Abort execution")}}else z[c.toLowerCase()]&&(a.trackingEvents[i[l]].blocked=!0),f.apply(this,[h,a.trackingEvents[i[l]].urls,d,e]),j=!0;if(!j&&!e){var m=new b.LogItem;m.source=b.LogItem.SourceType.TRACKER,m.event=b.LogItem.EventType.WARNING,m.message="Event '"+c+"' does not exist"+u(g),s(this,m)}}function i(a,c){var d,e=!1,g=!1;if(a.trackingEvents.hasOwnProperty("progress")&&a.trackingEvents.progress.hasOwnProperty(c)){if(d=a.trackingEvents.progress[c],g=k(a),d.blocked){var h=new b.LogItem;throw h.source=b.LogItem.SourceType.TRACKER,h.event=b.LogItem.EventType.ILLEGAL_OPERATION,h.message="Can not track progress '"+c+"' more than once"+u(a),s(this,h),new Error("Abort execution")}d.blocked=!0,f.apply(this,[g,d.urls,0]),e=!0}if(!e){var h=new b.LogItem;h.source=b.LogItem.SourceType.TRACKER,h.event=b.LogItem.EventType.WARNING,h.message="Event 'progress' does not exist or offset is invalid"+u(a),s(this,h)}}function j(a){var b=null;try{b=a.parentSlot.parentInsertionPoint.parentSession}catch(error){}return b}function k(a){var c=!1,d=null;return a instanceof b.adresponse.Ad?d=j(a):(a instanceof b.adresponse.LinearCreative||a instanceof b.adresponse.NonLinearCreative)&&(d=j(a.parentAd)),d&&(c=d.secure),c}function l(c,d,e,j,m){var p=k(c);if(!c.hasOwnProperty("trackingEvents")){var q=new b.LogItem;throw q.source=b.LogItem.SourceType.TRACKER,q.event=b.LogItem.EventType.INVALID_ARGUMENT,q.message="Missing trackingEvents property. Can not track event '"+d+"'"+u(c),s(this,q),Error("Abort execution")}if(o(d)&&l.apply(this,[c,"interaction",a,a,!0]),n(d)||"error"===d){"progress"===d.toLowerCase()?i.apply(this,[c,j]):h.apply(this,[c,d,e]);var r;switch(d.toLowerCase()){case"complete":r=1;break;case"thirdquartile":r=2;break;case"midpoint":r=3;break;case"firstquartile":r=4;break;default:r=999}r<y.length&&g.apply(this,[r,c,e])}else if(c.trackingEvents.hasOwnProperty(d))if(z[d])if(c.trackingEvents[d].blocked){if("interaction"!==d&&!m){var q=new b.LogItem;throw q.source=b.LogItem.SourceType.TRACKER,q.event=b.LogItem.EventType.ILLEGAL_OPERATION,q.message="Can not track '"+d+"' more than once"+u(c),s(this,q),Error("Abort execution")}}else c.trackingEvents[d].blocked=!0,f.apply(this,[p,c.trackingEvents[d].urls,e]);else f.apply(this,[p,c.trackingEvents[d].urls,e]);else if(!m){var q=new b.LogItem;throw q.source=b.LogItem.SourceType.TRACKER,q.event=b.LogItem.EventType.INVALID_ARGUMENT,q.message="Custom tracking event '"+d+"' does not exist"+u(c),s(this,q),Error("Abort execution")}}function m(a){var b=a.split(":"),c=0;if(b.length>0)for(var d=0;d<b.length;d++)c+=Number(b[b.length-d-1]*(d?Math.pow(60,d):1));return c}function n(a){for(var c in b.tracking.Tracker.AdEventType)if(b.tracking.Tracker.AdEventType[c].toLowerCase()===a.toLowerCase())return!0;for(var c in b.tracking.Tracker.CreativeEventType)if(b.tracking.Tracker.CreativeEventType[c].toLowerCase()===a.toLowerCase())return!0;return!1}function o(a){for(var b in w)if(w[b].toLowerCase()===a.toLowerCase())return!0;return!1}function p(a){var c=k(a);a.hasOwnProperty("parentSlot")&&a.parentSlot instanceof b.adresponse.Slot&&a.parentSlot.hasOwnProperty("trackingEvents")&&a.parentSlot.trackingEvents.hasOwnProperty("slotStart")&&!a.parentSlot.trackingEvents.slotStart.blocked&&(a.parentSlot.trackingEvents.slotStart.blocked=!0,f.apply(this,[c,a.parentSlot.trackingEvents.slotStart.urls]))}function q(a,error,d){var e=a,f=!1;if((a instanceof b.adresponse.LinearCreative||a instanceof b.adresponse.NonLinearCreative)&&(f=!0,e=a.parentAd),d)if(r("error",e)===!0){var g=new b.LogItem;g.source=b.LogItem.SourceType.TRACKER,g.event=b.LogItem.EventType.ILLEGAL_OPERATION,g.message="Can not track 'error' more than once"+u(a),f&&(g.message=g.message.substring(0,g.message.length-1)+"'s parent ad."),s(this,g)}else if(r("impression",e)===!0){var g=new b.LogItem;g.source=b.LogItem.SourceType.TRACKER,g.event=b.LogItem.EventType.ILLEGAL_OPERATION,g.message="Can't track error since 'impression' has already been tracked for this item.",s(this,g)}else p.apply(this,[e]),l.apply(this,[a,"error",d]),c(e);else if(v.resolveErrorCode(new b.adresponse.Ad,error)||v.resolveErrorCode(new b.adresponse.LinearCreative,error)||v.resolveErrorCode(new b.adresponse.NonLinearCreative,error)){var g=new b.LogItem;g.source=b.LogItem.SourceType.TRACKER,g.event=b.LogItem.EventType.INVALID_ARGUMENT,g.message="Error type not supported for "+t(a)+".",s(this,g)}else{var g=new b.LogItem;g.source=b.LogItem.SourceType.TRACKER,g.event=b.LogItem.EventType.INVALID_ARGUMENT,g.message="Error type not supported.",s(this,g)}}function r(a,b){return b&&b.hasOwnProperty("trackingEvents")&&b.trackingEvents.hasOwnProperty(a)&&b.trackingEvents[a].hasOwnProperty("blocked")&&b.trackingEvents[a].blocked===!0}function s(a,b){for(var c=0;c<a._logCallbacks.length;++c)a._logCallbacks[c](b)}function t(a){return a instanceof b.adresponse.Ad?"Ad":a instanceof b.adresponse.LinearCreative?"LinearCreative":a instanceof b.adresponse.NonLinearCreative?"NonLinearCreative":a instanceof b.adresponse.Companion?"Companion":""}function u(a){return a instanceof b.adresponse.Ad?" on the passed Ad Object.":a instanceof b.adresponse.LinearCreative?" on the passed LinearCreative Object.":a instanceof b.adresponse.NonLinearCreative?" on the passed NonLinearCreative Object.":a instanceof b.adresponse.Companion?" on the passed Companion Object.":""}var v=function(){return this instanceof b.tracking.Tracker?(this._logCallbacks=[],void(this.previewMode=!1)):new v},w={MUTE:"mute",UNMUTE:"unmute",PAUSE:"pause",REWIND:"rewind",RESUME:"resume",ACCEPT_INVITATION:"acceptinvitation",EXPAND:"expand",FULLSCREEN:"fullscreen",COLLAPSE:"collapse",EXIT_FULLSCREEN:"exitfullscreen",CLICKTHROUGH:"clickthrough",CLOSE:"close"},x={xmlParsingError:100,vastValidationError:101,vastResponseError:102,adTypeNotSupportedError:200,adLinearityError:201,wrapperError:300,wrapperTimeoutError:301,noVASTResponseError:303,generalLinearError:400,linearMediaFileNotFoundError:401,mediaFileTimeoutError:402,noSupportedMediaFileFoundError:403,mediaFileDisplayError:405,generalNonlinearError:500,nonlinearMediaFileNotFoundError:502,noSupportedNonLinearResourceFoundError:503,undefinedError:900},y=["complete","thirdQuartile","midpoint","firstQuartile","start"],z={startcontent:"startcontent",impression:"impression",complete:"complete",thirdquartile:"thirdquartile",midpoint:"midpoint",firstquartile:"firstquartile",start:"start",interaction:"interaction",creativeview:"creativeview"};v.prototype.reportPulseError=function(a,c){var d=function(a){var c=[];return a&&a instanceof b.adresponse.Ad&&a.trackingEvents.hasOwnProperty("report")&&!a.trackingEvents.report.blocked&&a.trackingEvents.report.urls.length>0&&(a.trackingEvents.report.blocked=!0,c.push(a.trackingEvents.report.urls.pop())),c},e=d(a);if(e.length>0){for(var g=0;g<e.length;g++){var h=e[g].url;h&&-1===h.indexOf("PULSE_ERROR")&&-1===h.indexOf("PASSBACK_INDEX")&&(h+=(h.indexOf("?")>-1?"&":"?")+"[AAB_PULSE_ERROR]="+c+"&[AAB_PASSBACK_INDEX]="+a.candidate,e[g].url=h)}f(k(a),e,c||900,!0)}},v.prototype.reportError=function(a,error){var c=v.resolveErrorCode(a,error);if(!this.previewMode)if(a instanceof b.adresponse.Ad||a instanceof b.adresponse.LinearCreative||a instanceof b.adresponse.NonLinearCreative)q.apply(this,[a,error,c]);else if(a instanceof b.adresponse.Companion){var d=new b.LogItem;d.source=b.LogItem.SourceType.TRACKER,d.event=b.LogItem.EventType.INVALID_ARGUMENT,d.message="Cannot report errors on Companion ads.",s(this,d)}else{var d=new b.LogItem;d.source=b.LogItem.SourceType.TRACKER,d.event=b.LogItem.EventType.INVALID_ARGUMENT,d.message="Not a trackable object.",s(this,d)}},v.prototype.trackEvent=function(a,c,e){if(!this.previewMode){if(!c||""===c){var f=new b.LogItem;return f.source=b.LogItem.SourceType.TRACKER,f.event=b.LogItem.EventType.INVALID_ARGUMENT,f.message="Event passed can not be an empty string.",void s(this,f)}if("error"===c){var f=new b.LogItem;return f.source=b.LogItem.SourceType.TRACKER,f.event=b.LogItem.EventType.INVALID_ARGUMENT,f.message='"error" must be tracked using reportError()',void s(this,f)}if(a instanceof b.adresponse.Session)try{d.apply(this,[a,c])}catch(g){}else if(a instanceof b.adresponse.Ad)if(r("error",a)===!0){var f=new b.LogItem;f.source=b.LogItem.SourceType.TRACKER,f.event=b.LogItem.EventType.ILLEGAL_OPERATION,f.message="Can not track any more events after reporting error on the passed Ad Object.",s(this,f)}else try{p.apply(this,[a]),l.apply(this,[a,c])}catch(g){}else if(a instanceof b.adresponse.LinearCreative||a instanceof b.adresponse.NonLinearCreative||a instanceof b.adresponse.Companion)if(null!=a.parentAd&&r("error",a.parentAd)===!0){var f=new b.LogItem;f.source=b.LogItem.SourceType.TRACKER,f.event=b.LogItem.EventType.ILLEGAL_OPERATION,f.message="Can not track any more events after reporting error on the passed Ad Object.",s(this,f)}else try{l.apply(this,[a,c,0,e])}catch(g){}else{var f=new b.LogItem;f.source=b.LogItem.SourceType.TRACKER,f.event=b.LogItem.EventType.INVALID_ARGUMENT,f.message="Invalid object passed. Can not track event '"+c+"'. Object passed should be of type Session, Ad, Creative or Companion.",s(this,f)}}},v.prototype.addLogListener=function(a){a&&"function"==typeof a&&this._logCallbacks.push(a)};var A=/\[ERRORCODE\]|%5BERRORCODE%5D/g,B=/\[PULSE_ERROR\]|%5BPULSE_ERROR%5D/g,C=/\[c\]|%5Bc%5D/g,D=/\[CACHEBUSTING\]|%5BCACHEBUSTING%5D/g;return v.prototype.trackProgress=function(a,c){if(!(a instanceof b.adresponse.LinearCreative)){var d=new b.LogItem;return d.source=b.LogItem.SourceType.TRACKER,d.event=b.LogItem.EventType.INVALID_ARGUMENT,d.message="Progress can only be tracked on LinearCreative objects.",void s(this,d)}if(a.trackingEvents.progress){var e,f=[];for(var g in a.trackingEvents.progress){if(e=null,g.indexOf("%")>-1&&a.duration>0){var h=parseFloat(String(g).substring(0,g.indexOf("%")));e=isNaN(h)?null:a.duration*(h/100)}else e=m(g);null!==e&&c>=e&&f.push(g)}for(var j=0;j<f.length;++j)if(!a.trackingEvents.progress[f[j]].blocked)try{i.call(this,a,f[j])}catch(k){}}},v.resolveErrorCode=function(a,error){var c;if(a instanceof b.adresponse.Ad)switch(error){case b.tracking.Tracker.AdError.TYPE_NOT_SUPPORTED:c=x.adTypeNotSupportedError;break;case b.tracking.Tracker.AdError.NO_AD:c=x.noVASTResponseError;break;case b.tracking.Tracker.AdError.GENERAL_ERROR:c=x.generalLinearError}else if(a instanceof b.adresponse.LinearCreative)switch(error){case b.tracking.Tracker.CreativeError.MEDIA_FILE_NOT_FOUND:c=x.linearMediaFileNotFoundError;break;case b.tracking.Tracker.CreativeError.MEDIA_FILE_TIMEOUT:c=x.mediaFileTimeoutError;break;case b.tracking.Tracker.CreativeError.NO_SUPPORTED_MEDIA_FILE_FOUND:c=x.noSupportedMediaFileFoundError;break;case b.tracking.Tracker.CreativeError.MEDIA_FILE_DISPLAY_ERROR:c=x.mediaFileDisplayError}else if(a instanceof b.adresponse.NonLinearCreative)switch(error){case b.tracking.Tracker.CreativeError.MEDIA_FILE_NOT_FOUND:c=x.nonlinearMediaFileNotFoundError;break;case b.tracking.Tracker.CreativeError.MEDIA_FILE_TIMEOUT:c=x.mediaFileTimeoutError;break;case b.tracking.Tracker.CreativeError.NO_SUPPORTED_MEDIA_FILE_FOUND:
c=x.noSupportedNonLinearResourceFoundError;break;case b.tracking.Tracker.CreativeError.MEDIA_FILE_DISPLAY_ERROR:c=x.mediaFileDisplayError}return c},v.prototype.trackTimeSpent=function(c,d){if(!(d instanceof b.adresponse.LinearCreative||d instanceof b.adresponse.NonLinearCreative)){var e=new b.LogItem;return e.source=b.LogItem.SourceType.TRACKER,e.event=b.LogItem.EventType.INVALID_ARGUMENT,e.message="'timeSpent' can only be tracked on LinearCreative and NonLinearCreative objects.",void s(this,e)}if(r("error",d)===!0){var e=new b.LogItem;return e.source=b.LogItem.SourceType.TRACKER,e.event=b.LogItem.EventType.ILLEGAL_OPERATION,e.message="Can not track any more events after reporting error on the passed creative.",void s(this,e)}if(!d.trackingEvents.hasOwnProperty("timeSpent")){var e=new b.LogItem;return e.source=b.LogItem.SourceType.TRACKER,e.event=b.LogItem.EventType.INVALID_ARGUMENT,e.message="Event 'timeSpent' does not exist on the passed object.",void s(this,e)}if(isNaN(c)||!isFinite(c)||0>c){var e=new b.LogItem;return e.source=b.LogItem.SourceType.TRACKER,e.event=b.LogItem.EventType.INVALID_ARGUMENT,e.message="'timeSpent' must be tracked with a positive number.",void s(this,e)}var g=d.trackingEvents.timeSpent.urls[0].url,h=Math.floor(c),i=g.replace(C,h);i=i.replace(D,Math.floor(1e16*Math.random()));var j=k(d);h>0&&f.call(this,j,[{url:i}],a,!0)},v}(),b.tracking.Tracker.SessionEventType={CONTENT_START:"contentStart"},b.tracking.Tracker.AdEventType={IMPRESSION:"impression"},b.tracking.Tracker.CreativeEventType={CREATIVE_VIEW:"creativeview",START:"start",FIRST_QUARTILE:"firstquartile",MIDPOINT:"midpoint",THIRD_QUARTILE:"thirdquartile",COMPLETE:"complete",PROGRESS:"progress",CLICKTHROUGH:"clickthrough",MUTE:"mute",UNMUTE:"unmute",PAUSE:"pause",REWIND:"rewind",RESUME:"resume",FULLSCREEN:"fullscreen",EXIT_FULLSCREEN:"exitfullscreen",EXPAND:"expand",COLLAPSE:"collapse",ACCEPT_INVITATION:"acceptinvitation",CLOSE:"close",SKIP:"skip"},b.tracking.Tracker.AdError={TYPE_NOT_SUPPORTED:"adTypeNotSupportedError",NO_AD:"noAdError",GENERAL_ERROR:"generalAdError"},b.tracking.Tracker.CreativeError={MEDIA_FILE_NOT_FOUND:"mediaFileNotFoundError",MEDIA_FILE_TIMEOUT:"mediaFileTimeoutError",NO_SUPPORTED_MEDIA_FILE_FOUND:"noSupportedMediaFileFoundError",MEDIA_FILE_DISPLAY_ERROR:"mediaFileDisplayError"},b.tracking.Tracker.PulseError={START_AD_TIMEOUT_ERROR:1,PASSBACK_TIMEOUT_ERROR:2,XML_PARSING_ERROR:100,VAST_VALIDATION_ERROR:101,VAST_RESPONSE_ERROR:102,AD_TYPE_NOT_SUPPORTED_ERROR:200,AD_LINEARITY_ERROR:201,WRAPPER_ERROR:300,WRAPPER_TIMEOUT_ERROR:301,NO_VAST_RESPONSE_ERROR:303,GENERAL_LINEAR_ERROR:400,LINEAR_MEDIA_FILE_NOT_FOUND_ERROR:401,MEDIA_FILE_TIMEOUT_ERROR:402,NO_SUPPORTED_MEDIA_FILE_FOUND_ERROR:403,MEDIA_FILE_DISPLAY_ERROR:405,UNDEFINED_ERROR:900}}(c),function(a){a.LogItem=function(){var b=function(c){return this instanceof a.LogItem?(this.source="",this.event=a.LogItem.EventType.GENERAL_ERROR,this.errorCode=null,this.message="",void(this.thirdPartySourceURLs=[])):new b};return b}(),a.LogItem.SourceType={AD:"ad",SESSION:"session",TRACKER:"tracker"},a.LogItem.EventType={NO_AD_RESPONSE:"noAd",INVALID_ARGUMENT:"invalidArgument",INVALID_RESPONSE:"invalidResponse",GENERAL_ERROR:"generalError",REQUEST_FAILED:"requestFailed",REQUEST_TIMEOUT:"requestTimeout",REQUEST_CANCELED:"requestCanceled",WARNING:"warning",ILLEGAL_OPERATION:"illegalOperation"}}(c),function(a){a.HTML5HTTPRequester=function(){var b=function(c){return this instanceof a.HTML5HTTPRequester?(c=c||{},void(this._withoutCredentials=c.withoutCredentials||!1)):new b(c)};return b.prototype.request=function(b,c,d,e){var f,g,h="GET";if(e=e||12e3,c||(c=function(){}),d||(d=function(){}),window.XMLHttpRequest)if(f=new window.XMLHttpRequest,"withCredentials"in f){if(this._withoutCredentials!==!0)try{f.withCredentials=!0}catch(i){}try{f.open(h,b,!0),f.timeout=e,g=!1}catch(i){return void d(a.httpErrorCodeTranslation[0])}f.onreadystatechange=function(){4===f.readyState&&(200===f.status?c(f.responseText):g||d(a.httpErrorCodeTranslation[f.status]||"unknownError"))};try{f.send()}catch(i){d("unknownError")}}else if(window.XDomainRequest){f=new window.XDomainRequest,f.onload=function(){c(f.responseText)},f.onerror=function(){d(a.httpErrorCodeTranslation.ieError||"unknownError")},f.onprogress=function(){},f.ontimeout=function(){};try{f.open(h,b),f.timeout=e,f.send()}catch(i){d(a.httpErrorCodeTranslation.ieError||"unknownError")}}else d("corsNotSupportedInBrowser");var j=function(a){g=!0,f.abort(),f=null,c=function(){},d(a)};return j},b.prototype.postRequest=function(b,c,d,e,f){var g,h,i="POST";f=f||12e3,d||(d=function(){}),e||(e=function(){});var j=[];for(var k in c)j.push(k+"="+c[k]);if(j=j.join("&"),window.XMLHttpRequest)if(g=new window.XMLHttpRequest,"withCredentials"in g){try{g.withCredentials=!0}catch(l){}try{g.open(i,b,!0),g.timeout=f,h=!1}catch(l){return void e(a.httpErrorCodeTranslation[0])}g.onreadystatechange=function(){4===g.readyState&&(200===g.status?d(g.responseText):h||e(a.httpErrorCodeTranslation[g.status]||"unknownError"))};try{g.send(j)}catch(l){e("unknownError")}}else if(window.XDomainRequest){g=new window.XDomainRequest,g.onload=function(){d(g.responseText)},g.onerror=function(){e(a.httpErrorCodeTranslation.ieError||"unknownError")},g.onprogress=function(){},g.ontimeout=function(){};try{g.open(i,b),g.timeout=f,g.send(j)}catch(l){e(a.httpErrorCodeTranslation.ieError||"unknownError")}}else e("corsNotSupportedInBrowser");var m=function(a){h=!0,g.abort(),g=null,d=function(){},e(a)};return m},b}()}(c),function(a,b){a.HTTPRequester=function(){function c(a){for(var b=0;b<f.length;++b)if(f[b]===a)return void f.splice(b,1)}function d(){return b&&b.Pulse?b.Pulse.Utils.isFlashAvailable():!1}function e(a){return b&&b.Pulse&&b.Pulse.HTTPRequesterOverride&&b.Pulse.HTTPRequesterOverride.hasOwnProperty(a)}a.httpErrorCodeTranslation={503:"Service unavailable",500:"Internal server error",404:"The requested resource could not be found",400:"Bad request",0:"Request could not be sent to the server",ieError:"Request failed",secureError:"The request could not be sent as the SDK has been configured to only allow requests over HTTPS"};var f=[],g=function(a){return this._secure&&0===a.toLowerCase().indexOf("http:")},h=function(c,e){return this instanceof a.HTTPRequester?(this._secure="undefined"!=typeof c?c:!1,this._HTMLrequester=new a.HTML5HTTPRequester({withoutCredentials:e}),void(d()&&(this._flashRequester=new b.Pulse.Flash.FlashHTTPRequester))):new h(c)};return h.prototype.request=function(c,f,h,i){var j,k;if(g.call(this,c))return void h(a.httpErrorCodeTranslation.secureError||"unknownError");j=e("request")?b.Pulse.HTTPRequesterOverride.request(c,f,h,i):this._HTMLrequester.request(c,f,function(error){if(d())if("corsNotSupportedInBrowser"===error||error===a.httpErrorCodeTranslation[0]){"corsNotSupportedInBrowser"===error&&(error="CORS does not appear to be correctly configured on the server.");try{k=this._flashRequester.request(c,f,h,i)}catch(g){h(error)}}else h(error);else e("request")?b.Pulse.HTTPRequesterOverride.request(c,f,h,i):h(error)}.bind(this),i);var l=function(a){k?k(a):j(a)};return l},h.prototype.postRequest=function(c,f,h,i,j){var k,l;if(g.call(this,c))return void i(a.httpErrorCodeTranslation.secureError||"unknownError");k=e("postRequest")?b.Pulse.HTTPRequesterOverride.postRequest(c,h,i,j):this._HTMLrequester.request(c,h,function(error){if(d())if("corsNotSupportedInBrowser"===error||error===a.httpErrorCodeTranslation[0]){"corsNotSupportedInBrowser"===error&&(error="CORS does not appear to be correctly configured on the server.");try{l=this._flashRequester.postRequest(c,f,h,i,j)}catch(b){i(error)}}else i(error);else i(error)}.bind(this),j);var m=function(a){l?l(a):k(a)};return m},h.prototype.imgRequest=function(d,h){if(g.call(this,d))return void h(a.httpErrorCodeTranslation.secureError||"unknownError");if(e("imgRequest"))b.Pulse.HTTPRequesterOverride.imgRequest(d,h);else{var i=document.createElement("img");f.push(i);var j=function(){c(i)};i.onload=j,i.onerror=j,i.setAttribute("src",d)}},h}()}(c,b),window.videoplaza=c,window.videoplaza.buildDate="20170831",window.videoplaza.versionNumber="2.0.17.17.0",window.OO=b;var d=document.createEvent("Event");d.initEvent("pulseready",!0,!0),document.dispatchEvent(d)}(window);