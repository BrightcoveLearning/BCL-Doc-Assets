<article class="bcls-article">
  <section class="bcls-section">
    <h2 id="introduction">Introduction</h2>
    <p>The CMS API does not support updating multiple videos with a single request. However, you can iterate over a set of data to this, and this sample demonstrates this, using a sample Brightcove account. To get access tokens and make the API calls, it uses a proxy built by Brightcove Learning services.</p>
    <p>Since the aim is just to show the logic, we will just update one bit of metadata for the videos: the description.</p>
  </section>
  <!-- <section class="bcls-section">
  <h2 id="getCredentials" class="bcls-expander-head">Get credentials</h2>

  <div class="bcls-expander-content">
  <p>To use the CMS API you will need proper credentials.</p>

  <p>The easiest way to get credentials in most cases is through the Studio Admin API Authentication section (requires admin permissions on your account). See <a href="/node/14056">Managing API Authentication Credentials</a> for details. In most cases, you probably just want to get permissions for all CMS API operation:</p>

  <figure class="bcls-figure"><img class="bcls-image" alt="CMS API Permissions" src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/cms-api/cms-permissions.png" />
  <figcaption class="bcls-caption--image">CMS API Permissions</figcaption>
  </figure>

  <p>If the permissions you need are not available in Studio, or if you prefer to get them directly from the OAuth API, use your choice of the <strong>Get Client Credentials</strong> documents listed below. Whichever option you choose, you will need to ask for the correct operation permissions. The following can be used with cURL or Postman to get all permissions for the CMS API:</p>

  <pre class="line-numbers">
  <code class="language-json">"operations": [
    "video-cloud/video/all",
    "video-cloud/playlist/all",
    "video-cloud/sharing-relationships/all",
    "video-cloud/notifications/all"
  ]</code></pre>

  <ul>
  	<li><a href="/node/17924">OAuth: Get Client Credentials Using cURL</a></li>
  	<li><a href="/node/17923">OAuth: Get Client Credentials Using Postman</a></li>
  </ul>
  </div>
  </section> -->

  <!-- <p>Account ID: <input size="60" id="account_id" type="text" placeholder="57838016001" /></p>

  <p>Client ID: <input size="60" id="client_id" type="text" placeholder="f05869d2-f201-47d1-9606-aaafa66fea6e" /></p>

  <p>Client Secret: <input size="120" id="client_secret" type="text" placeholder="2F4CvF8DER1j3fmQr3TjKSmD6jMfvigM3HwCVkdhykvYOOUamFYeu9U8fRpks-EH7PCJcthc8Is" /></p> -->
<section class="bcls-section">
<h2 id="dataInput">Inputs for the Update</h2>

<fieldset class="bcls-fieldset"><legend>Videos to Update</legend>

<p><button class="bcls-button" id="getVideos">Get Videos</button></p>
<p>Video metadata for update:<textarea id="videoData" class="bcls-code" style="height:20em;">Video data for the update will appear here.</textarea></p>

<p><button id="setRequest" class="bcls-button">Update the videos</button></p>
</fieldset>
</section>

<section class="bcls-section">
<h2 id="outputLog">Results</h2>

<fieldset class="bcls-fieldset"><legend>Outputs</legend>

<p>API request:<textarea id="apiRequest" class="bcls-code"></textarea></p>

<pre>
<code id="response">Response will appear here...</code></pre>
</fieldset>
</section>

<section class="bcls-section">
<h2 id="sampleCode">Code for the sample</h2>

<h3>HTML code:</h3>

<p>To see the HTML code, view the source for this page.</p>

<h3>JavaScript code:</h3>

<pre class="line-numbers">
<code class="language-javascript">var BCLS = ( function (window, document, creds) {
    var account_id_field = document.getElementById("account_id"),
        account_id,
        client_id_field = document.getElementById("client_id"),
        client_id = null,
        client_secret_field = document.getElementById("client_secret"),
        client_secret = null,
        setRequest_btn = document.getElementById("setRequest"),
        apiRequest = null,
        apiRequest_field = document.getElementById("apiRequest"),
        submit_button = document.getElementById("submit"),
        response = document.getElementById("response"),
        totalVideos = 0,
        offset = 0,
        callNumber = 0,
        requestBody,
        videoData_display = document.getElementById("videoData"),
        videoData,
        t1,
        currentVideo,
        // functions
        isDefined,
        cleanString,
        cleanUpData,
        submitRequest,
        setRequest,
        logResponse,
        init;
    // is defined
    isDefined = function(x){
        if(x !== "" &amp;&amp; x !== null &amp;&amp; x !== undefined){
            return true;
        } else{
            return false;
        }
    };
    // function to remove spaces from string
    cleanString = function (str) {
        // remove spaces
        str = str.replace(/\s/g, "");
        return str;
    };
    // clean up data before submitting
    cleanUpData = function () {
        var i, iMax, item;
        iMax = videoData.length;
        for (i = 0; i &lt; iMax; i++) {
            item = videoData[i];
            // truncate over-long descriptions
            if (item.description.length &gt; 120) {
                item.description = item.description.substr(0, 250) + "...";
            }
            // use name for missing descriptions
            if (item.description === "") {
                item.description = item.name;
            }
        }
        // console.log("videoData Cleaned", videoData);
    };
    // function to set up request
    setRequest = function () {

        currentVideo = videoData[callNumber];
        if (isDefined(currentVideo)) {
            apiRequest = "https://cms.api.brightcove.com/v1/accounts/" + account_id + "/videos/" + currentVideo.id;
            requestBody = '{"description":"' + currentVideo.description + '"}';
            // display the request URL
            apiRequest_field.textContent = apiRequest;
            submitRequest();
        }

    };
    // function to set the request
    logResponse = function (data) {
        response.innerHTML += data + ",
";
    };
    // function to make API request
    submitRequest = function () {
        var httpRequest = new XMLHttpRequest(),
            proxyURL = "https://solutions.brightcove.com/bcls/bcls-proxy/bcls-proxy.php",
            requestData,
            getResponse = function () {
                try {
                    if (httpRequest.readyState === 4) {
                      if (httpRequest.status &gt;= 200 &amp;&amp; httpRequest.status &lt; 300) {
                        logResponse(httpRequest.responseText);
                        if (callNumber &lt; totalVideos) {
                            callNumber++;
                            setRequest();
                        }
                      } else {
                        alert("There was a problem with the request. Request returned " + httpRequest.status);
                      }
                    }
                  }
                  catch(e) {
                    alert('Caught Exception: ' + e);
                  }
            };
        if (account_id === null || client_id === null || client_secret === null) {
            alert("You must provide an account id, client id, and client secret");
            return false;
        }
        // get latest request URL in case use edited it
        apiRequest = cleanString(apiRequest_field.value);
        // set up request data
        requestData = "client_id=" + client_id + "&amp;client_secret=" + client_secret + "&amp;url=" + encodeURIComponent(apiRequest) + "&amp;requestBody=" + encodeURIComponent(requestBody) + "&amp;requestType=PATCH";
        // set response handler
        httpRequest.onreadystatechange = getResponse;
        // open the request
        httpRequest.open("POST", proxyURL);
        // set headers
        httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        // open and send request
        httpRequest.send(requestData);
    };
    // init function to set up event listeners
    init = function () {
        // event listeners
        setRequest_btn.addEventListener("click", function () {
            // trim any leading/trailing spaces from the input strings
            account_id = cleanString(account_id_field.value) || creds.account_id;
            client_id = cleanString(client_id_field.value) || creds.client_id;
            client_secret = cleanString(client_secret_field.value) || creds.client_secret;
            // get and clean up video data
            videoData = JSON.parse(videoData_display.value);
            totalVideos = videoData.length;
            cleanUpData();
            // set up the request
            setRequest();
        });
    }
    // initialize - set up data
    init();

})(window, document, creds);</code></pre>

<h3>Proxy</h3>

<aside class="bcls-aside bcls-aside--information">In order to build your own version the sample app on this page, you must create and host your own proxy. (The proxies used by Brightcove Learning Services only accept requests from Brightcove domains.) You can download two versions of our proxy code:
<ul>
	<li><a href="//learning-services-media.brightcove.com/doc-assets/proxy/bcls-proxy-for-distribution.php.zip">This is a general version that expects client credentials to be passed with the request</a></li>
	<li><a href="//learning-services-media.brightcove.com/doc-assets/proxy/doc-samples-proxy.php.zip">This version allows you to save your client credentials in the proxy itself on lines 25-26 (recommended)</a></li>
</ul>
</aside>
</section>
</article>
<script src="//learning-services-media.brightcove.com/doc-assets/node/18031-cms-api-sample-update-videos/creds.js"></script><script src="//learning-services-media.brightcove.com/doc-assets/node/18031-cms-api-sample-update-videos/update-metadata.js"></script>
