<article class="bcls-article">
<section class="bcls-section">
<h2 id="Introduction">Introduction</h2>

<p>Media sharing is a feature of Video Cloud that lets publishers share videos with other publishers, enabling you to more easily manage videos across multiple accounts. For example, publishers can keep a master account of video content and then share videos out to other divisions or subsidiaries of the organization.</p>

<aside class="bcls-aside bcls-aside--information"><strong>Media sharing is available only for Video Cloud Enterprise and Pro customers with multiple accounts.</strong> If you are interested in upgrading your Video Cloud account, please contact Brightcove for more information.</aside>
</section>

<section class="bcls-section">
<h2 id="Terminology">Terminology</h2>

<p>In media sharing, there are two accounts involved:</p>

<table class="bcls-table">
	<caption class="bcls-caption--table">Media Sharing Accounts</caption>
	<thead class="bcls-table__head">
		<tr>
			<th>Account</th>
			<th>Description</th>
		</tr>
	</thead>
	<tbody class="bcls-table__body">
		<tr>
			<td>Master</td>
			<td>The account that created the original video.
<p>The Master owns the content and is responsible for setting up, managing and providing content to Affiliates.</p>
            </td>
		</tr>
		<tr>
			<td>Affiliate</td>
			<td>The account that is receiving the video.
<p>The Affiliate can accept content shared to it from a Master.</p>
            </td>
		</tr>
        <tr>
            <td>Channel</td>
            <td>A pipeline through which content is shared from a Master to any number of Affiliates.
<p>The Affiliates summary of the rules agreed upon by accepting content from a specific Master. It also contains details about how the Affiliate would like to accept content.</p>
            </td>
        </tr>
        <tr>
            <td>Relationship</td>
            <td>Describes the interaction between a Master and an Affiliate. <p>A relationship is comprised of a Master to share content, a Channel through which content is shared, a Contract for accepting content, and an Affiliate to receive content.</p>
            </td>
        </tr>
	</tbody>
</table>
</section>

<section class="bcls-section">
    <h2 id="what_is_shared">What is shared?</h2>
    <p>This section explains what gets shared, and how subsequent changes to the video are handled.</p>
    <h3>When the video is shared</h3>
    <p>Most of the video metadata fields are copied from the master to the affiliate account when the video is shared. The notable exceptions are:</p>
    <ul>
        <li><code>id</code> - the video will have its own id in the affiliate account</li>
        <li>date/time fields such as <code>created_at</code> and <code>updated_at</code></li>
    </ul>
    <p>All the video assets (renditions, images, text_tracks, etc.) are shared by reference to the affiliate account. The affiliate video will use those assets for playback.</p>
    <aside class="bcls-aside bcls-aside--information">Note that billing will still be based on the account that the video is played back from, not the account where the assets reside.</aside>
    <h3>After the video is shared</h3>
    <p>After the video has been shared, some changes to the video in the master account are automatically inherited by the affiliate accounts, and some are not.</p>
    <h4>Video assets</h4>
    <p>Master changes to the <strong>source/rendition and text track assets</strong> are <em>always</em> inherited by affiliates. Affiliates cannot modify these assets.</p>
    <p>Image (thumbnail and poster) assets changed by master are inherited by affiliates <strong>IF</strong> the affiliate has not replaced those images. Once the affiate replaces the thumbnail and/or poster, changes on the master are no longer inherited.</p>
    <h4>Video metadata</h4>
    <p>Any video metadata (such as the name, description, and reference id) can be modified by the affiliate, and changes made on the master video are <strong>not</strong> inherited by the affiate.</p>
    <p>Note, however, that if the master <strong>re-shares</strong> the video (this can only be done through the CMS API, not in Studio), all assets and metadata (aside from data/time fields) will be shared to affiliates, <strong>overwriting any changes the affiliates have made</strong>.</p>
    <aside class="bcls-aside bcls-aside--warning">Before you reshare a video, be sure that this is what you want to do, and that your affiliates know that it is going to happen!</aside>

</section>

<section class="bcls-section">
    <h2 id="overview_media_sharing_steps">Overview of media sharing steps</h2>
    <p>A default <strong>channel</strong> will be set up in your account when media sharing is enabled.</p>
    <p>Here is the logical flow for setting up a sharing relationship:</p>
    <figure class="bcls-figure">
        <img class="bcls-image" src="//learning-services-media.brightcove.com/doc-assets/node/18325-media-sharing-cms-api/18325-admin-flow.svg" alt="Set Up Sharing">
        <figcaption class="bcls-caption--image">Set Up Sharing</figcaption>
    </figure>
    <p>And here is the logic around sharing a video:</p>
    <figure class="bcls-figure">
        <img class="bcls-image" src="//learning-services-media.brightcove.com/doc-assets/node/18325-media-sharing-cms-api/18325-sharing-flow.svg" alt="Sharing Operations">
        <figcaption class="bcls-caption--image">Sharing Operations</figcaption>
    </figure>

</section>

<section class="bcls-section">
<h2 id="CMS_API_operations">CMS API requests - setup</h2>
<p>This section lists the CMS API operations involved in setting up media sharing.</p>
<h3>Channel management</h3>
<h4>List channel(s) (master)</h4>
<table class="bcls-table">
    <caption class="bcls-caption--table">List Channels</caption>
    <tbody class="bcls-table__body">
        <tr>
            <th>Method</th>
            <td>GET</td>
        </tr>
        <tr>
            <th>Endpoint</th>
            <td>https://cms.api.brightcove.com/v1/accounts/<span class="bcls-input">master_account_id</span>/channels</td>
        </tr>
        <tr>
            <th>Request body</th>
            <td>
            </td>
        </tr>
        <tr>
            <th>Sample response</th>
            <td>
<pre class="line-numbers"><code class="language-json">{
	"account_id": "57838016001",
	"name": "default",
	"updated_at": "2017-08-23T17:11:18.474Z",
	"created_at": "2017-08-23T17:11:18.474Z"
}</code></pre>
            </td>
        </tr>
    </tbody>
</table>
<h4>Create channel (master)</h4>
<table class="bcls-table">
    <caption class="bcls-caption--table">Create Channel</caption>
    <tbody class="bcls-table__body">
        <tr>
            <th>Method</th>
            <td>PUT</td>
        </tr>
        <tr>
            <th>Endpoint</th>
            <td>https://cms.api.brightcove.com/v1/accounts/<span class="bcls-input">master_account_id</span>/channels/<span class="bcls-input">channel_name</span></td>
        </tr>
        <tr>
            <th>Request body</th>
            <td>
<pre class="line-numbers"><code class="language-json">{
  "account_id": "57838016001",
  "name": "channel_name"
}</code></pre>
            </td>
        </tr>
        <tr>
            <th>Sample response</th>
            <td>
<pre class="line-numbers"><code class="language-json">{
	"account_id": "57838016001",
	"name": "channel_name",
	"updated_at": "2017-08-23T19:12:24.139Z",
	"created_at": "2017-08-23T19:12:24.139Z"
}</code></pre>
            </td>
        </tr>
    </tbody>
</table>
<h4>List affiliates for channel (master)</h4>
<table class="bcls-table">
    <caption class="bcls-caption--table">List Channel Affiliates</caption>
    <tbody class="bcls-table__body">
        <tr>
            <th>Method</th>
            <td>GET</td>
        </tr>
        <tr>
            <th>Endpoint</th>
            <td>https://cms.api.brightcove.com/v1/accounts/<span class="bcls-input">master_account_id</span>/channels/default/members</td>
        </tr>
        <tr>
            <th>Request body</th>
            <td>
            </td>
        </tr>
        <tr>
            <th>Sample response</th>
            <td>
<pre class="line-numbers"><code class="language-json">[
	{
		"account_id": "20318290001",
		<span class="bcls-highlight">"approved": false</span>
	},
	{
		"account_id": "1485884786001",
		<span class="bcls-highlight">"approved": true</span>
	},
	{
		"account_id": "1752604059001",
		"approved": true
	}
]</code></pre>
            </td>
        </tr>
    </tbody>
</table>
<h4>Add affiliate from channel (master)</h4>
<table class="bcls-table">
    <caption class="bcls-caption--table">Add Affiliate</caption>
    <tbody class="bcls-table__body">
        <tr>
            <th>Method</th>
            <td>PUT</td>
        </tr>
        <tr>
            <th>Endpoint</th>
            <td>https://cms.api.brightcove.com/v1/accounts/<span class="bcls-input">master_account_id</span>/channels/default/members/<span class="bcls-input">affiliate_account_id</span></td>
        </tr>
        <tr>
            <th>Request body</th>
            <td>
<pre class="line-numbers"><code class="language-json">{
  "account_id":"<span class="bcls-input">affiliate_account_id</span>"
}</code></pre>
            </td>
        </tr>
        <tr>
            <th>Sample response</th>
            <td>
<pre class="line-numbers"><code class="language-json">{
	"account_id": "1485884786001"
}</code></pre>
            </td>
        </tr>
    </tbody>
</table>
<h4>Remove affiliate from channel (master)</h4>
<table class="bcls-table">
    <caption class="bcls-caption--table">Remove Affiliate</caption>
    <tbody class="bcls-table__body">
        <tr>
            <th>Method</th>
            <td>DELETE</td>
        </tr>
        <tr>
            <th>Endpoint</th>
            <td>https://cms.api.brightcove.com/v1/accounts/<span class="bcls-input">master_account_id</span>/channels/default/members/<span class="bcls-input">affiliate_account_id</span></td>
        </tr>
        <tr>
            <th>Request body</th>
            <td>
            </td>
        </tr>
        <tr>
            <td>Sample response</td>
            <td>204 NO CONTENT (empty response body)</td>
        </tr>
    </tbody>
</table>
<h4>Get available contracts (affiliate)</h4>
<table class="bcls-table">
    <caption class="bcls-caption--table">Get Contracts</caption>
    <tbody class="bcls-table__body">
        <tr>
            <th>Method</th>
            <td>GET</td>
        </tr>
        <tr>
            <th>Endpoint</th>
            <td>https://cms.api.brightcove.com/v1/accounts/<span class="bcls-input">affiliate_account_id</span>/contracts</td>
        </tr>
        <tr>
            <th>Request body</th>
            <td>
            </td>
        </tr>
        <tr>
            <td>Sample response</td>
            <td>
<pre class="line-numbers"><code class="language-json">[
	{
		"account_id": "1485884786001",
		"channel": {
			"account_id": "57838016001",
			"name": "default"
		},
		<span class="bcls-highlight">"approved": false,</span>
		<span class="bcls-highlight">"auto_accept": false,</span>
		"approved_at": null,
		"updated_at": "2017-08-23T17:45:41.556Z",
		"created_at": "2017-08-23T17:45:41.556Z"
	}
]</code></pre>
            </td>
        </tr>
    </tbody>
</table>

<p>The two essential fields in the response are:</p>
<ul>
    <li><code>approved</code> - when set to true, the contract is accepted by the affiliate</li>
    <li><code>auto-accept</code> - when set to true, videos shared through this contract will be automatically accepted by the affiliate; otherwise, they must be approved one by one</li>
</ul>

<p>We will see how to update the contract below.</p>

<h4>Get a specific contract (affiliate)</h4>
<table class="bcls-table">
    <caption class="bcls-caption--table">Get Contract</caption>
    <tbody class="bcls-table__body">
        <tr>
            <th>Method</th>
            <td>GET</td>
        </tr>
        <tr>
            <th>Endpoint</th>
            <td>https://cms.api.brightcove.com/v1/accounts/<span class="bcls-input">affiliate_account_id</span>/contracts/<span class="bcls-input">master_account_id</span></td>
        </tr>
        <tr>
            <th>Request body</th>
            <td>
            </td>
        </tr>
        <tr>
            <td>Sample response</td>
            <td>
<pre class="line-numbers"><code class="language-json">{
	"account_id": "1485884786001",
	"channel": {
		"account_id": "57838016001",
		"name": "default"
	},
	<span class="bcls-highlight">"approved": false,</span>
	<span class="bcls-highlight">"auto_accept": false,</span>
	"approved_at": null,
	"created_at": "2017-08-23T17:45:41.556Z",
	"updated_at": "2017-08-23T17:45:41.556Z"
}</code></pre>
            </td>
        </tr>
    </tbody>
</table>


<h4>Accepting a contract (affiliate)</h4>
<table class="bcls-table">
    <caption class="bcls-caption--table">Accept Contracts</caption>
    <tbody class="bcls-table__body">
        <tr>
            <th>Method</th>
            <td>PATCH</td>
        </tr>
        <tr>
            <th>Endpoint</th>
            <td>https://cms.api.brightcove.com/v1/accounts/<span class="bcls-input">affiliate_account_id</span>/contracts/<span class="bcls-input">master_account_id</span></td>
        </tr>
        <tr>
            <th>Request body</th>
            <td>
<pre class="line-numbers"><code class="language-json">{
  "approved": true,
  "auto_accept": true
}</code></pre>
            </td>
        </tr>
        <tr>
            <td>Sample response</td>
            <td>
<pre class="line-numbers"><code class="language-json">{
	"account_id": "1485884786001",
	"channel": {
		"account_id": "57838016001",
		"name": "default"
	},
    <span class="bcls-highlight">"approved": true,</span>
	<span class="bcls-highlight">"auto_accept": true,</span>
	"approved_at": "2017-08-27T12:27:21.582Z",
	"created_at": "2017-08-23T17:45:41.556Z",
	"updated_at": "2017-08-27T12:27:21.582Z"
}</code></pre>
            </td>
        </tr>
    </tbody>
</table>

<p>If you include only <code>"approved":true</code>, each video will have to be approved individually.</p>

</section>
<section class="bcls-section">
    <h2 id="cms_operations_sharing">CMS API requests - sharing</h2>
    <p>This section details the CMS API requests used in sharing videos.</p>
    <h3>Getting existing shares (master)</h3>
    <p>To find out if a video has already been shared to other accounts, you can use the request below.</p>
    <aside class="bcls-aside bcls-aside--information">This is important, because sharing a video to an account that you have already shared it to is a <strong>reshare</strong> that will overwrite any metadata changes that the affiliate has made!</aside>
    <table class="bcls-table">
        <caption class="bcls-caption--table">Get Shares</caption>
        <tbody class="bcls-table__body">
            <tr>
                <th>Method</th>
                <td>GET</td>
            </tr>
            <tr>
                <th>Endpoint</th>
                <td>https://cms.api.brightcove.com/v1/accounts/<span class="bcls-input">master_account_id</span>/videos/<span class="bcls-input">video_id</span>/shares</td>
            </tr>
            <tr>
                <th>Request body</th>
                <td>
                </td>
            </tr>
            <tr>
                <td>Sample response</td>
                <td>
<pre class="line-numbers"><code class="language-json">[
	{
		"video_id": "5553744346001",
		"affiliate_id": "1752604059001",
		"affiliate_video_id": "5553754248001",
		"status": "COMPLETE",
		"shared_at": "2017-08-27T14:35:01.890Z",
		"updated_at": "2017-08-27T14:35:25.630Z"
	},
	{
		"video_id": "5553744346001",
		"affiliate_id": "1485884786001",
		"affiliate_video_id": "5553758415001",
		"status": "COMPLETE",
		"shared_at": "2017-08-27T14:34:34.919Z",
		"updated_at": "2017-08-27T14:35:25.212Z"
	}
]</code></pre>
                </td>
            </tr>
        </tbody>
    </table>

    <h3>Sharing (or resharing) a video (master)</h3>
    <p>The request described below will share a video to one or more affiliate accounts.</p>
    <aside class="bcls-aside bcls-aside--information">Remember that if the video has already been shared to an affiliate, this request will <strong>reshare</strong> the video, and overwrite any changes the affiliate has made to the video metadata!</aside>
    <table class="bcls-table">
        <caption class="bcls-caption--table">Share Video</caption>
        <tbody class="bcls-table__body">
            <tr>
                <th>Method</th>
                <td>POST</td>
            </tr>
            <tr>
                <th>Endpoint</th>
                <td>https://cms.api.brightcove.com/v1/accounts/<span class="bcls-input">master_account_id</span>/videos/<span class="bcls-input">video_id</span>/shares</td>
            </tr>
            <tr>
                <th>Request body</th>
                <td>
<pre class="line-numbers"><code class="language-json">[
  { "id": "<span class="bcls-input">affiliate_account_id_1</span>" },
  { "id": "<span class="bcls-input">affiliate_account_id_2</span>" }
]</code></pre>
                </td>
            </tr>
            <tr>
                <td>Sample response</td>
                <td>
<pre class="line-numbers"><code class="language-json">[
	{
		"video_id": "5553744346001",
		"affiliate_id": "1485884786001",
		"affiliate_video_id": null,
		"status": "PROCESSING",
		"shared_at": "2017-08-27T14:25:55.710Z",
		"updated_at": "2017-08-27T14:25:55.710Z"
	}
]</code></pre>
                </td>
            </tr>
        </tbody>
    </table>
    <p>Sharing will create a new video in the affiliate's account. The <code>state</code> of the video will be <code>PROCESSING</code> until the share is complete <strong>and</strong> the video has been accepted by the affiliate (if <code>auto_accept</code> is set to <code>false</code> on the contract by the affiliate - see the previous section on setting up sharing).</p>
    <aside class="bcls-aside bcls-aside--warning">
        <p>Note that if the <code>reference_id</code> for the master video is already in use in the affiliate account, the share will fail. The master and affiliate will need to resolve the issue by changing the <code>reference_id</code> in one of the accounts and then retry the share.</p>
        <p>Because sharing is an asynchronous operation, no error will be returned on the share requests. However, the GET shares request (see above) will show an error for the account.</p>
    </aside>
    <h3>Unsharing a video</h3>
    <table class="bcls-table">
    <caption class="bcls-caption--table">Unshare Video</caption>
    <tbody class="bcls-table__body">
        <tr>
            <th>Method</th>
            <td>DELETE</td>
        </tr>
        <tr>
            <th>Endpoint</th>
            <td>https://cms.api.brightcove.com/v1/accounts/<span class="bcls-input">master_account_id</span>/videos/<span class="bcls-input">video_id</span>/shares/<span class="bcls-input">affiliate_account_id</span></td>
        </tr>
        <tr>
            <th>Request body</th>
            <td>
            </td>
        </tr>
        <tr>
            <td>Sample response</td>
            <td>202 ACCEPTED (empty response body)</td>
        </tr>
    </tbody>
</table>

</section>
</article>
