<article class="bcls-article">
<article class="bcls-article">
<section class="bcls-section">
<h2 id="getCredentials" class="bcls-expander-head">Get credentials</h2>

<div class="bcls-expander-content">
<p>To use the Ingest Profiles API you will need proper credentials.</p>

<p>The easiest way to get credentials in most cases is through the Studio Admin API Authentication section (requires admin permissions on your account). See <a href="/node/14056">Managing API Authentication Credentials</a> for details. In most cases, you probably just want to get permissions for all Ingest Profiles API operation:</p>

<figure class="bcls-figure"><img class="bcls-image" alt="Ingest Profiles API Permissions" src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/ingest-profiles-api/ingest-profiles-permissions.png" />
<figcaption class="bcls-caption--image">Ingest Profiles API Permissions</figcaption>
</figure>

<p>If the permissions you need are not available in Studio, or if you prefer to get them directly from the OAuth API, use your choice of the <strong>Get Client Credentials</strong> documents listed below. Whichever option you choose, you will need to ask for the correct operation permissions. The following can be used with cURL or Postman to get all permissions for the Ingest Profiles API:</p>

<pre class="line-numbers">
<code class="language-json">"operations": [
  "video-cloud/ingest-profiles/profile/read",
  "video-cloud/ingest-profiles/profile/write",
  "video-cloud/ingest-profiles/account/read",
  "video-cloud/ingest-profiles/account/write"
]</code></pre>

<ul>
  <li><a href="/node/18521">OAuth API Sample: Create Client Credentials</a></li>
	<li><a href="/node/17924">OAuth: Get Client Credentials Using cURL</a></li>
	<li><a href="/node/17923">OAuth: Get Client Credentials Using Postman</a></li>
</ul>
</div>
</section>

<section class="bcls-section">
<h2 id="Set_default_profile_app">Set default profile app</h2>

<p>You can use the form below to set the default ingest profile for one or more accounts.</p>

<fieldset><legend>Input</legend>

<p>If you do not enter account information, a Brightcove sample account will be used.</p>

<p>Account id: <input id="account_id_input" type="text" placeholder="1752604059001" /></p>

<p>Client id: <input id="client_id_input" type="text" size="60" placeholder="c5d0a622-5479-46d8-8d8a-5f034b943fab" /></p>

<p>Client secret: <input id="client_secret_input" type="text" size="60" placeholder="w7NQYu0vUloM4GYYy2SXAxrvyFpt8fwI35qAFZcS13-VIgs0itwKNsAwHOS80sOWKJ1BUwHIvSFG" /></p>

<p><button class="bcls-button" id="get_profiles">Get Account Profiles</button></p>

<p>Profile to set as default: <select name="profile_select" id="profile_select" style="width:200px;"></select></p>

<p><button class="bcls-button" id="set_default_profile" disabled style="opacity:.6;">Set the Selected Profile as Default</button></p>
<p><button class="bcls-button" id="update_default_profile" disabled style="opacity:.6;">Set the Selected Profile as Default</button></p>
</fieldset>

<fieldset><legend>Output</legend>

<div id="logger" style="color:rgb(237, 104, 38)">
  <p>Waiting for input...</p>
</div>

<h4>Current API request</h4>

<pre>
  <code id="api_request_display">API request will appear here...</code></pre>

<h4>Current API request</h4>

<pre>
  <code id="api_request_body_display">API request body will appear here...</code></pre>

<h4>Response data</h4>

<pre>
  <code id="api_response" style="width:95%;height:30em;">Response will appear here...</code></pre>
</fieldset>
</section>
<section class="bcls-section">
  <h2 id="Code_used_in_the_sample">Code used in the sample</h2>
  <h3>HTML</h3>
<pre class="line-numbers"><code class="language-html">&lt;section class="bcls-section"&gt;
&lt;h2 id="Set_default_profile_app"&gt;Set default profile app&lt;/h2&gt;

&lt;p&gt;You can use the form below to set the default ingest profile for one or more accounts.&lt;/p&gt;

&lt;fieldset&gt;&lt;legend&gt;Input&lt;/legend&gt;

&lt;p&gt;If you do not enter account information, a Brightcove sample account will be used.&lt;/p&gt;

&lt;p&gt;Account ids (comma-delimited list): &lt;input id="account_id_input" type="text" placeholder="1752604059001" /&gt;&lt;/p&gt;

&lt;p&gt;Client id: &lt;input id="client_id_input" type="text" size="60" placeholder="c5d0a622-5479-46d8-8d8a-5f034b943fab" /&gt;&lt;/p&gt;

&lt;p&gt;Client secret: &lt;input id="client_secret_input" type="text" size="60" placeholder="w7NQYu0vUloM4GYYy2SXAxrvyFpt8fwI35qAFZcS13-VIgs0itwKNsAwHOS80sOWKJ1BUwHIvSFG" /&gt;&lt;/p&gt;

&lt;p&gt;&lt;button class="bcls-button" id="get_profiles"&gt;Get Account Profiles&lt;/button&gt;&lt;/p&gt;

&lt;p&gt;Profile to set as default: &lt;select name="profile_select" id="profile_select" style="width:200px;"&gt;&lt;/select&gt;&lt;/p&gt;

&lt;p&gt;&lt;button class="bcls-button" id="set_default_profile" disabled style="opacity:.6;"&gt;Set the Selected Profile as Default&lt;/button&gt;&lt;/p&gt;
&lt;p&gt;&lt;button class="bcls-button" id="update_default_profile" disabled style="opacity:.6;"&gt;Set the Selected Profile as Default&lt;/button&gt;&lt;/p&gt;
&lt;/fieldset&gt;

&lt;fieldset&gt;&lt;legend&gt;Output&lt;/legend&gt;

&lt;div id="logger" style="color:rgb(237, 104, 38)"&gt;
  &lt;p&gt;Waiting for input...&lt;/p&gt;
&lt;/div&gt;

&lt;h4&gt;Current API request&lt;/h4&gt;

&lt;pre&gt;
  &lt;code id="api_request_display"&gt;API request will appear here...&lt;/code&gt;&lt;/pre&gt;

&lt;h4&gt;Current API request&lt;/h4&gt;

&lt;pre&gt;
  &lt;code id="api_request_body_display"&gt;API request body will appear here...&lt;/code&gt;&lt;/pre&gt;

&lt;h4&gt;Response data&lt;/h4&gt;

&lt;pre&gt;
  &lt;code id="api_response" style="width:95%;height:30em;"&gt;Response will appear here...&lt;/code&gt;&lt;/pre&gt;
&lt;/fieldset&gt;
&lt;/section&gt;</code></pre>
  <h3>JavaScript</h3>
<pre class="line-numbers"><code class="language-javascript">var BCLS = (function(window, document) {
  var account_id_input = document.getElementById('account_id_input'),
    client_id_input = document.getElementById('client_id_input'),
    client_secret_input = document.getElementById('client_secret_input'),
    get_profiles = document.getElementById('get_profiles'),
    set_default_profile = document.getElementById('set_default_profile'),
    update_default_profile = document.getElementById('update_default_profile'),
    profile_selector = document.getElementById('profile_selector'),
    profile_select = document.getElementById('profile_select'),
    logger = document.getElementById('logger'),
    api_request_display = document.getElementById('api_request_display'),
    api_request_body_display = document.getElementById('api_request_body_display'),
    api_response = document.getElementById('api_response'),
    profiles = [],
    account_ids = [],
    client_id,
    client_secret,
    selectedProfile;

  // event listeners
  get_profiles.addEventListener('click', function() {
    if  (getAccountInfo()) {
      createRequest('get_profiles');
    } else {
      alert('Account ID, Client ID, and Client Secret are required');
    }
  });

  set_default_profile.addEventListener('click', function() {
    selectedProfile = getSelectedValue(profile_select).value;
    if (isDefined(selectedProfile)) {
      createRequest('set_default_profile');
    } else {
      alert('Please select a profile and click this button again');
    }
  });

  update_default_profile.addEventListener('click', function() {
    selectedProfile = getSelectedValue(profile_select).value;
    if (isDefined(selectedProfile)) {
      createRequest('update_default_profile');
    } else {
      alert('Please select a profile and click this button again');
    }
  });

  /**
   * get account info from input fields
   */
  function getAccountInfo() {
    if (isDefined(account_id_input.value) &amp;&amp; isDefined(client_id_input.value) &amp;&amp; isDefined(client_secret_input.value)) {
      account_id    = removeSpaces(account_id_input.value);
      client_id     = removeSpaces(client_id_input.value);
      client_secret = removeSpaces(client_secret_input.value);
      return true;
    } else {
      return false;
    }
  }

  function logMessage(message) {
    var p = document.createElement('p'),
        txt = document.createTextNode(message);
    p.appendChild(txt);
    logger.appendChild(p);
  }

  /**
   * tests for all the ways a variable might be undefined or not have a value
   * @param {*} x the variable to test
   * @return {Boolean} true if variable is defined and has a value
   */
  function isDefined(x) {
      if ( x === '' || x === null || x === undefined) {
          return false;
      }
      return true;
  }

  /*
   * tests to see if a string is json
   * @param {String} str string to test
   * @return {Boolean}
   */
  function isJson(str) {
      try {
          JSON.parse(str);
      } catch (e) {
          return false;
      }
      return true;
  }

  /**
   * remove spaces from a string
   * @param {String} str string to process
   * @return {String} trimmed string
   */
  function removeSpaces(str) {
      str= str.replace(/\s/g, '');
      return str;
  }

  /**
   * enable a button element
   * @param  {HTMLelement} button a reference to a button element
   */
  function enableButton(button) {
    button.removeAttribute('disabled');
    button.setAttribute('style', 'opacity:1;');
  }

  /**
   * disable a button element
   * @param  {HTMLelement} button a reference to a button element
   */
  function disableButton(button) {
    button.setAttribute('disabled', 'disabled');
    button.setAttribute('style', 'opacity:.6;');
  }

  /**
   * get selected value for single select element
   * @param {htmlElement} e the select element
   * @return {Object} object containing the `value`, text, and selected `index`
   */
  function getSelectedValue(e) {
      var selected = e.options[e.selectedIndex],
          val = selected.value,
          txt = selected.textContent,
          idx = e.selectedIndex;
      return {
          value: val,
          text: txt,
          index: idx
      };
  }

  /**
   * adds options to a select element from an array of valuesArray
   * @param {HTMLelement} selectElement the select element reference
   * @param {Array} valuesArray the array of option values e.g. [{value:'a',label:'alpha'},{value:'b',label:'beta'}]
   */
  function addOptions(selectElement, valuesArray) {
    var i,
      iMax;
    if (selectElement &amp;&amp; valuesArray) {
      iMax = valuesArray.length;
      for (i = 0; i &lt; iMax; i++) {
        var option = document.createElement('option');
        option.setAttribute('value', valuesArray[i].value);
        option.textContent = valuesArray[i].label;
        selectElement.add(option);
      }
    } else {
      console.log('function addOptions: no parameters provided');
    }
  }

  /**
   * createRequest sets up requests, send them to makeRequest(), and handles responses
   * @param  {string} type the request type
   */
  function createRequest(type) {
    var options = {},
      requestBody = {},
      proxyURL = 'https://solutions.brightcove.com/bcls/bcls-proxy/ip2-proxy.php',
      baseURL = 'https://ingestion.api.brightcove.com/v1/accounts/' + account_id,
      endpoint,
      responseDecoded,
      today = new Date().toISOString(),
      tmpArray = [],
      i,
      iMax;

    // set credentials
    options.client_id = client_id;
    options.client_secret = client_secret;
    options.proxyURL = proxyURL;

    switch (type) {
      case 'get_profiles':
        logMessage('Getting profiles');
        endpoint = '/profiles';
        options.url = baseURL + endpoint;
        api_request_display.textContent = options.url;
        api_request_body_display.textContent = 'no request body for this operation';
        options.requestType = 'GET';
        makeRequest(options, function(response) {
          if (isJson(response)) {
            responseDecoded = JSON.parse(response);
            api_response.textContent = JSON.stringify(responseDecoded, null, '  ');
          } else {
            api_response.textContent = response;
            logMessage('The get profiles operation failed; see the API Response for the error');
            return;
          }
          if (Array.isArray(responseDecoded)) {
            iMax = responseDecoded.length;
            for (i = 0; i &lt; iMax; i++) {
              if (responseDecoded[i].hasOwnProperty('dynamic_origin')) {
                var o = {value:responseDecoded[i].id, label:responseDecoded[i].name};
                tmpArray.push(o);
              }
            }
            addOptions(profile_select, tmpArray);
            enableButton(set_default_profile);
          }
        });
        break;
      case 'set_default_profile':
        logMessage('Setting the default profile');
        endpoint = '/configuration';
        options.url = baseURL + endpoint;
        api_request_display.textContent = options.url;
        options.requestType = 'POST';
        requestBody.account_id = account_id;
        requestBody.default_profile_id = selectedProfile;
        api_request_body_display.textContent = JSON.stringify(requestBody, null, '  ');
        options.requestBody = JSON.stringify(requestBody);
        makeRequest(options, function(response) {
          if (isJson(response)) {
            responseDecoded = JSON.parse(response);
            api_response.textContent = JSON.stringify(responseDecoded, null, '  ');
            // check for conflict - means default has already been set
            if (Array.isArray(responseDecoded) &amp;&amp; responseDecoded[0].code === 'CONFLICT') {
              alert('The request failed because the default profile for the account has already been set - use Update Default Profile instead');
              enableButton(update_default_profile);
            }
          } else {
            api_response.textContent = response;
            logMessage('The set default profile operation failed; see the API Response for the error');
            return;
          }
        });
        break;
      case 'update_default_profile':
        logMessage('Updating the default profile');
        endpoint = '/configuration';
        options.url = baseURL + endpoint;
        api_request_display.textContent = options.url;
        options.requestType = 'PUT';
        requestBody.account_id = account_id;
        requestBody.default_profile_id = selectedProfile;
        api_request_body_display.textContent = JSON.stringify(requestBody, null, '  ');
        options.requestBody = JSON.stringify(requestBody);
        makeRequest(options, function(response) {
          if (isJson(response)) {
            responseDecoded = JSON.parse(response);
            api_response.textContent = JSON.stringify(responseDecoded, null, '  ');
          } else {
            api_response.textContent = response;
            logMessage('The set default profile operation failed; see the API Response for the error');
            return;
          }
        });
        break;
      default:
        console.log('Should not be getting to the default case - bad request type sent');
        break;
    }
  }

  /**
   * send API request to the proxy
   * @param  {Object} options for the request
   * @param  {String} options.url the full API request URL
   * @param  {String="GET","POST","PATCH","PUT","DELETE"} requestData [options.requestType="GET"] HTTP type for the request
   * @param  {String} options.proxyURL proxyURL to send the request to
   * @param  {String} options.client_id client id for the account (default is in the proxy)
   * @param  {String} options.client_secret client secret for the account (default is in the proxy)
   * @param  {JSON} [options.requestBody] Data to be sent in the request body in the form of a JSON string
   * @param  {Function} [callback] callback function that will process the response
   */
  function makeRequest(options, callback) {
      var httpRequest = new XMLHttpRequest(),
          response,
          requestParams,
          dataString,
          proxyURL    = options.proxyURL,
          // response handler
          getResponse = function() {
              try {
                  if (httpRequest.readyState === 4) {
                      if (httpRequest.status &gt;= 200 &amp;&amp; httpRequest.status &lt; 300) {
                          response = httpRequest.responseText;
                          // some API requests return '{null}' for empty responses - breaks JSON.parse
                          if (response === '{null}') {
                              response = null;
                          }
                          // return the response
                          callback(response);
                      } else {
                          alert('There was a problem with the request. Request returned ' + httpRequest.status);
                      }
                  }
              } catch (e) {
                  alert('Caught Exception: ' + e);
              }
          };
      /**
       * set up request data
       * the proxy used here takes the following params:
       * url - the full API request (required)
       * requestType - the HTTP request type (default: GET)
       * clientId - the client id (defaults here to a Brightcove sample account value - this should always be stored on the server side if possible)
       * clientSecret - the client secret (defaults here to a Brightcove sample account value - this should always be stored on the server side if possible)
       * requestBody - request body for write requests (optional JSON string)
       */
      requestParams = "url=" + encodeURIComponent(options.url) + "&amp;requestType=" + options.requestType;
      // only add client id and secret if both were submitted
      if (options.client_id &amp;&amp; options.client_secret) {
          requestParams += '&amp;client_id=' + options.client_id + '&amp;client_secret=' + options.client_secret;
      }
      // add request data if any
      if (options.requestBody) {
          requestParams += '&amp;requestBody=' + options.requestBody;
      }
      // set response handler
      httpRequest.onreadystatechange = getResponse;
      // open the request
      httpRequest.open('POST', proxyURL);
      // set headers
      httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
      // open and send request
      httpRequest.send(requestParams);
  }

})(window, document);
</code></pre>
  <h3>Proxy</h3>
  <aside class="bcls-aside bcls-aside--information">In order to build your own version the sample app on this page, you must create and host your own proxy. (The proxies used by Brightcove Learning Services only accept requests from Brightcove domains.) You can download two versions of our proxy code:
    <ul>
        <li><a href="//learning-services-media.brightcove.com/doc-assets/proxy/bcls-proxy-for-distribution.php.zip">This is a general version that expects client credentials to be passed with the request</a></li>
        <li><a href="//learning-services-media.brightcove.com/doc-assets/proxy/doc-samples-proxy.php.zip">This version allows you to save your client credentials in the proxy itself on lines 25-26 (recommended)</a></li>
    </ul>
</aside>
</section>
</article>
<script src="//learning-services-media.brightcove.com/doc-assets/node/18531-ingest-profiles-api-sample-set-default-profile-multiple-accounts-dynamic-delivery/set-default-profile.js"></script>
