<article class="bcls-article">
<section class="bcls-section">
<h2 id="introduction">Introduction</h2>

<p>The Ingest Profiles API allows you to:</p>

<ul>
	<li>
	<p>Get the profiles for your account</p>
	</li>
	<li>
	<p>Create new profiles</p>
	</li>
	<li>
	<p>Update profiles</p>
	</li>
	<li>
	<p>Delete profiles</p>
	</li>
	<li>
	<p>Set or update the default profile for your account</p>
	</li>
</ul>
</section>

<section class="bcls-section">
<h2 id="restful">A Restful API</h2>

<p>The Ingest Profiles API is a RESTful API. It accepts HTTPS requests and returns a JSON response.</p>

<p>This means that you can use the API with any language you choose - Ruby, Java, PHP, Python, JavaScript (via AJAX or nodejs), etc. All you have to be able to do is make HTTPS requests and handle a JSON response.</p>
</section>

<section class="bcls-section">
<h2 id="getCredentials" class="bcls-expander-head">Get credentials</h2>

<div class="bcls-expander-content">
<p>To use the CMS API you will need proper credentials.</p>

<p>The easiest way to get credentials in most cases is through the Studio Admin API Authentication section (requires admin permissions on your account). See <a href="/node/14056">Managing API Authentication Credentials</a> for details. In most cases, you probably just want to get permissions for all Ingest Profiles API operation:</p>

<figure class="bcls-figure"><img class="bcls-image" alt="Ingest Profiles API Permissions" src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/ingest-profiles-api/ingest-profiles-permissions.png" />
<figcaption class="bcls-caption--image">Ingest Profiles API Permissions</figcaption>
</figure>

<p>If the permissions you need are not available in Studio, or if you prefer to get them directly from the OAuth API, use your choice of the <strong>Get Client Credentials</strong> documents listed below. Whichever option you choose, you will need to ask for the correct operation permissions. The following can be used with cURL or Postman to get all permissions for the Ingest Profiles API:</p>

<pre class="line-numbers">
  <code class="language-json">"operations": [
    "video-cloud/ingest-profiles/profile/read",
    "video-cloud/ingest-profiles/profile/write",
    "video-cloud/ingest-profiles/account/read",
    "video-cloud/ingest-profiles/account/write"
  ]</code></pre>

<ul>
	<li><a href="/node/18521">OAuth API Sample: Create Client Credentials</a></li>
	<li><a href="/node/17924">OAuth: Get Client Credentials Using cURL</a></li>
	<li><a href="/node/17923">OAuth: Get Client Credentials Using Postman</a></li>
</ul>
</div>
</section>

<section class="bcls-section">
<h2 id="sample_app">Sample app</h2>

<fieldset class="bcls-fieldset"><legend>Input</legend>

<p>If you do not enter account information, a Brightcove sample account will be used.</p>

<p>Account id: <input id="account_id_input" type="text" value="" placeholder="1752604059001" /></p>

<p>Client id: <input id="client_id_input" type="text" size="60" value="" placeholder="c5d0a622-5479-46d8-8d8a-5f034b943fab" /></p>

<p>Client secret: <input id="client_secret_input" type="text" size="60" value="" placeholder="w7NQYu0vUloM4GYYy2SXAxrvyFpt8fwI35qAFZcS13-VIgs0itwKNsAwHOS80sOWK" /></p>

<table class="bcls-table">
	<tbody class="bcls-table__body">
		<tr>
			<td><button class="bcls-button" id="get_profiles">Get All Profiles</button></td>
			<td><button class="bcls-button" id="create_profile">Create a Custom Profile</button></td>
			<td><button class="bcls-button" id="set_default_profile">Set Default Profile</button></td>
			<td><button class="bcls-button" id="update_default_profile">Update Default Profile</button></td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td id="rendition_selector" style="vertical-align:top;">&nbsp;</td>
			<td id="profile_selector" colspan="2" style="vertical-align:top;text-align:center;"><select id="profile_select" style="min-width:100px;"></select></td>
		</tr>
	</tbody>
</table>
</fieldset>

<fieldset class="bcls-fieldset"><legend>Log</legend>

<div id="logger" style="color:rgb(237, 104, 38)">Waiting for input</div>

<p>Current API request</p>

<pre class="line-numbers">
  <code id="api_request_display" class="language-http">API requests will appear here...</code></pre>

<p>Current API request body</p>

<pre class="line-numbers">
  <code id="api_request_body_display" class="language-http">API request body (if any) will appear here...</code></pre>

<p>Current API response</p>

<pre class="line-numbers">
<code id="api_response" class="language-json">API resonses will appear here...</code></pre>
</fieldset>
</section>

<section class="bcls-section">
<h2 id="Code_used_in_this_app">Code used in this app</h2>

<h3>HTML</h3>

<pre class="line-numbers">
<code class="language-html">&lt;section class="bcls-section"&gt;
  &lt;h2 id="sample_app"&gt;Sample app&lt;/h2&gt;
  &lt;fieldset class="bcls-fieldset"&gt;
    &lt;legend&gt;Input&lt;/legend&gt;

    &lt;p&gt;If you do not enter account information, a Brightcove sample account will be used.&lt;/p&gt;

    &lt;p&gt;Account id: &lt;input id="account_id_input" type="text" value="" placeholder="1752604059001" /&gt;&lt;/p&gt;

    &lt;p&gt;Client id: &lt;input id="client_id_input" type="text" size="60" value="" placeholder="c5d0a622-5479-46d8-8d8a-5f034b943fab" /&gt;&lt;/p&gt;

    &lt;p&gt;Client secret: &lt;input id="client_secret_input" type="text" size="60" value="" placeholder="w7NQYu0vUloM4GYYy2SXAxrvyFpt8fwI35qAFZcS13-VIgs0itwKNsAwHOS80sOWK" /&gt;&lt;/p&gt;
    &lt;table class="bcls-table"&gt;
      &lt;tbody class="bcls-table__body"&gt;
        &lt;tr&gt;
          &lt;td&gt;&lt;button class="bcls-button" id="get_profiles"&gt;Get All Profiles&lt;/button&gt;&lt;/td&gt;
          &lt;td&gt;&lt;button class="bcls-button" id="create_profile"&gt;Create a Custom Profile&lt;/button&gt;&lt;/td&gt;
          &lt;td&gt;&lt;button class="bcls-button" id="set_default_profile"&gt;Set Default Profile&lt;/button&gt;&lt;/td&gt;
          &lt;td&gt;&lt;button class="bcls-button" id="update_default_profile"&gt;Update Default Profile&lt;/button&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td id="rendition_selector" style="vertical-align:top;"&gt;&lt;/td&gt;
          &lt;td id="profile_selector" colspan="2" style="vertical-align:top;text-align:center;"&gt;
            &lt;select id="profile_select" style="min-width:100px;"&gt;&lt;/select&gt;
          &lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/fieldset&gt;
  &lt;fieldset class="bcls-fieldset"&gt;
    &lt;legend&gt;Log&lt;/legend&gt;

    &lt;div id="logger" style="color:rgb(237, 104, 38)"&gt;
      Waiting for input &lt;br&gt;
    &lt;/div&gt;

    &lt;p&gt;Current API request&lt;/p&gt;

    &lt;pre class="line-numbers"&gt;
&lt;code id="api_request_display" class="language-http"&gt;API requests will appear here...&lt;/code&gt;&lt;/pre&gt;

    &lt;p&gt;Current API request body&lt;/p&gt;

    &lt;pre class="line-numbers"&gt;
&lt;code id="api_request_body_display" class="language-http"&gt;API request body (if any) will appear here...&lt;/code&gt;&lt;/pre&gt;

    &lt;p&gt;Current API response&lt;/p&gt;
    &lt;pre class="line-numbers"&gt;&lt;code id="api_response" class="language-json"&gt;API resonses will appear here...&lt;/code&gt;&lt;/pre&gt;
  &lt;/fieldset&gt;
&lt;/section&gt;</code></pre>

<h3>JavaScript</h3>

<pre class="line-numbers">
<code class="language-javascript">var BCLS = (function(window, document) {
  var account_id_input = document.getElementById('account_id_input'),
    client_id_input = document.getElementById('client_id_input'),
    client_secret_input = document.getElementById('client_secret_input'),
    get_profiles = document.getElementById('get_profiles'),
    create_profile = document.getElementById('create_profile'),
    set_default_profile = document.getElementById('set_default_profile'),
    update_default_profile = document.getElementById('update_default_profile'),
    rendition_selector = document.getElementById('rendition_selector'),
    rendition_select = document.getElementById('rendition_select'),
    profile_selector = document.getElementById('profile_selector'),
    profile_select = document.getElementById('profile_select'),
    logger = document.getElementById('logger'),
    api_request_display = document.getElementById('api_request_display'),
    api_request_body_display = document.getElementById('api_request_body_display'),
    api_response = document.getElementById('api_response'),
    renditions = [ {value:'default/audio64', label:'default/audio64'}, {value:'default/audio96', label:'default/audio96'}, {value:'default/audio128', label:'default/audio128'}, {value:'default/audio192', label:'default/audio192'}, {value:'default/video450', label:'default/video450'}, {value:'default/video700', label:'default/video700'}, {value:'default/video900', label:'default/video900'}, {value:'default/video1200', label:'default/video1200'}, {value:'default/video1700', label:'default/video1700'}, {value:'default/video2000', label:'default/video2000'}, {value:'default/video3500', label:'default/video3500'}, {value:'default/video3800', label:'default/video3800'} ],
    profiles = [],
    account_id,
    client_id,
    client_secret,
    selectAll,
    selectedRenditions = [],
    selectedProfile,
    checkboxCollection;

  // event listeners
  get_profiles.addEventListener('click', function() {
    getAccountInfo();
    createRequest('get_profiles');
  });

  create_profile.addEventListener('click', function() {
    selectedRenditions = getCheckedBoxValues(checkboxCollection);
    if (renditions.length === 0) {
      alert('Please select the renditions you want to include and click this button again');
    } else {
      getAccountInfo();
      createRequest('create_profile');
    }
  });

  set_default_profile.addEventListener('click', function() {
    selectedProfile = getSelectedValue(profile_select).value;
    if (isDefined(selectedProfile)) {
      getAccountInfo();
      createRequest('set_default_profile');
    } else {
      alert('Please select a profile and click this button again');
    }
  });

  update_default_profile.addEventListener('click', function() {
    selectedProfile = getSelectedValue(profile_select).value;
    if (isDefined(selectedProfile)) {
      getAccountInfo();
      createRequest('update_default_profile');
    } else {
      alert('Please select a profile and click this button again');
    }
  });

  /**
   * get account info from input fields
   */
  function getAccountInfo() {
    account_id    = (isDefined(account_id_input.value)) ? account_id_input.value : '57838016001';
    client_id     = client_id_input.value;
    client_secret = client_secret_input.value;
  }

  function logMessage(message) {
    var br = document.createElement('br');
    logger.textContent += message;
    logger.appendChild(br);
  }

  /**
   * tests for all the ways a variable might be undefined or not have a value
   * @param {*} x the variable to test
   * @return {Boolean} true if variable is defined and has a value
   */
  function isDefined(x) {
      if ( x === '' || x === null || x === undefined) {
          return false;
      }
      return true;
  }

  /*
   * tests to see if a string is json
   * @param {String} str string to test
   * @return {Boolean}
   */
  function isJson(str) {
      try {
          JSON.parse(str);
      } catch (e) {
          return false;
      }
      return true;
  }

  /**
   * get selected value for single select element
   * @param {htmlElement} e the select element
   * @return {Object} object containing the `value`, text, and selected `index`
   */
  function getSelectedValue(e) {
      var selected = e.options[e.selectedIndex],
          val = selected.value,
          txt = selected.textContent,
          idx = e.selectedIndex;
      return {
          value: val,
          text: txt,
          index: idx
      };
  }

  /**
   * get array of values for checked boxes in a collection
   * @param {htmlElementCollection} elementCollection collection of checkbox elements
   * @return {Array} array of the values of the checked boxes
   */
  function getCheckedBoxValues(elementCollection) {
    var checkedValues = [],
      i,
      iMax;
    if (elementCollection) {
      iMax = elementCollection.length;
      for (i = 0; i &lt; iMax; i++) {
        if (elementCollection[i].checked === true) {
          checkedValues.push(elementCollection[i].value);
        }
      }
      return checkedValues;
    } else {
      console.log('Error: no input recieved');
      return null;
    }
  }

  /**
   * selects all checkboxes in a collection
   * @param {htmlElementCollection} checkboxCollection a collection of the checkbox elements, usually gotten by document.getElementsByName()
   */
  function selectAllCheckboxes(checkboxCollection) {
      var i,
          iMax = checkboxCollection.length;
      for (i = 0; i &lt; iMax; i += 1) {
          checkboxCollection[i].setAttribute('checked', 'checked');
      }
  }

  /**
   * de-selects all checkboxes in a collection
   * @param {htmlElementCollection} checkboxCollection a collection of the checkbox elements, usually gotten by document.getElementsByName()
   */
  function unselectAllCheckboxes(checkboxCollection) {
      var i,
          iMax = checkboxCollection.length;
      for (i = 0; i &lt; iMax; i += 1) {
          checkboxCollection[i].removeAttribute('checked');
      }
  }



  /**
   * adds options to a select element from an array of valuesArray
   * @param {HTMLelement} selectElement the select element reference
   * @param {Array} valuesArray the array of option values e.g. [{value:'a',label:'alpha'},{value:'b',label:'beta'}]
   */
  function addOptions(selectElement, valuesArray) {
    var i,
      iMax;
    if (selectElement &amp;&amp; valuesArray) {
      iMax = valuesArray.length;
      for (i = 0; i &lt; iMax; i++) {
        var option = document.createElement('option');
        option.setAttribute('value', valuesArray[i].value);
        option.textContent = valuesArray[i].label;
        selectElement.add(option);
      }
    } else {
      console.log('function addOptions: no parameters provided');
    }
  }

  /**
   * adds options to a select element from an array of valuesArray
   * @param {HTMLelement} parentElement the parent element for the checkboxes
   * @param {Array} valuesArray the array of value/labels  e.g. [{value:'a',label:'alpha'},{value:'b',label:'beta'}]
   */
  function addCheckboxes (parentElement, valuesArray) {
    var i,
      iMax,
      input,
      label,
      br,
      txt,
      fragment = document.createDocumentFragment();
    if (parentElement &amp;&amp; valuesArray) {
      iMax = valuesArray.length;
      // add select all option
      input             = document.createElement('input');
      input.setAttribute('type', 'checkbox');
      input.setAttribute('id', 'selectAll');
      txt               = document.createTextNode(' ');
      label             = document.createElement('label');
      label.setAttribute('for', 'selectAll');
      label.textContent = 'Select All';
      br                = document.createElement('br');
      fragment.appendChild(input);
      fragment.appendChild(txt);
      fragment.appendChild(label);
      fragment.appendChild(br);
      for (i = 0; i &lt; iMax; i++) {
        input             = document.createElement('input');
        input.setAttribute('type', 'checkbox');
        input.setAttribute('value', valuesArray[i].value);
        input.setAttribute('name', 'checkboxCollection');
        txt               = document.createTextNode(' ');
        label             = document.createElement('label');
        label.setAttribute('for', valuesArray[i].value);
        label.textContent = valuesArray[i].label;
        br                = document.createElement('br');
        fragment.appendChild(input);
        fragment.appendChild(txt);
        fragment.appendChild(label);
        fragment.appendChild(br);
      }
      parentElement.appendChild(fragment);

      // set up select all option
      checkboxCollection = document.getElementsByName('checkboxCollection');
      selectAll = document.getElementById('selectAll');
      selectAll.addEventListener('change', function() {
        if (this.checked) {
          selectAllCheckboxes(checkboxCollection);
        } else {
          unselectAllCheckboxes(checkboxCollection);
        }
      });
    } else {
      console.log('function addCheckboxes: no parameters provided');
    }
  }


  /**
   * createRequest sets up requests, send them to makeRequest(), and handles responses
   * @param  {string} type the request type
   */
  function createRequest(type) {
    var options = {},
      requestBody = {},
      proxyURL = 'https://solutions.brightcove.com/bcls/bcls-proxy/ip2-proxy.php',
      baseURL = 'https://ingestion.api.brightcove.com/v1/accounts/' + account_id,
      endpoint,
      responseDecoded,
      today = new Date().toISOString(),
      tmpArray = [],
      i,
      iMax;

    // set credentials
    if (isDefined(client_id)) {
      options.client_id = client_id;
      options.client_secret = client_secret;
    }
    options.proxyURL = proxyURL;

    switch (type) {
      case 'get_profiles':
        logMessage('Getting profiles');
        endpoint = '/profiles';
        options.url = baseURL + endpoint;
        api_request_display.textContent = options.url;
        api_request_body_display.textContent = 'no request body for this operation';
        options.requestType = 'GET';
        makeRequest(options, function(response) {
          if (isJson(response)) {
            responseDecoded = JSON.parse(response);
            api_response.textContent = JSON.stringify(responseDecoded, null, '  ');
          } else {
            api_response.textContent = response;
            logMessage('The get profiles operation failed; see the API Response for the error');
            return;
          }
          if (Array.isArray(responseDecoded)) {
            iMax = responseDecoded.length;
            for (i = 0; i &lt; iMax; i++) {
              if (responseDecoded[i].hasOwnProperty('dynamic_origin')) {
                var o = {value:responseDecoded[i].id, label:responseDecoded[i].name};
                tmpArray.push(o);
              }
            }
            addOptions(profile_select, tmpArray);
          }
        });
        break;
      case 'create_profile':
        logMessage('Creating profile');
        endpoint = '/profiles';
        options.url = baseURL + endpoint;
        api_request_display.textContent = options.url;
        options.requestType = 'POST';
        requestBody.name = 'test_dynamic_delivery_profile' + today;
        requestBody.description = 'Test profile created from Ingest Profiles API Quick Start - delete if you do not need it';
        requestBody.account_id = account_id;
        requestBody.digital_master = {};
        requestBody.digital_master.rendition = 'passthrough';
        requestBody.digital_master.distribute = true;
        requestBody.dynamic_origin = {};
        requestBody.dynamic_origin.renditions = selectedRenditions;
        requestBody.images = [];
        requestBody.images.push({label:'poster', height: 720, width: 1280});
        requestBody.images.push({label:'thumbnail', height: 90, width: 160});
        api_request_body_display.textContent = JSON.stringify(requestBody, null, '  ');
        options.requestBody = JSON.stringify(requestBody);
        makeRequest(options, function(response) {
          if (isJson(response)) {
            responseDecoded = JSON.parse(response);
            api_response.textContent = JSON.stringify(responseDecoded, null, '  ');
          } else {
            api_response.textContent = response;
            logMessage('The create profile operation failed; see the API Response for the error');
            return;
          }
        });
        break;
      case 'set_default_profile':
        logMessage('Setting the default profile');
        endpoint = '/configuration';
        options.url = baseURL + endpoint;
        api_request_display.textContent = options.url;
        options.requestType = 'POST';
        requestBody.account_id = account_id;
        requestBody.default_profile_id = selectedProfile;
        api_request_body_display.textContent = JSON.stringify(requestBody, null, '  ');
        options.requestBody = JSON.stringify(requestBody);
        makeRequest(options, function(response) {
          if (isJson(response)) {
            responseDecoded = JSON.parse(response);
            api_response.textContent = JSON.stringify(responseDecoded, null, '  ');
            // check for conflict - means default has already been set
            if (Array.isArray(responseDecoded) &amp;&amp; responseDecoded[0].code === 'CONFLICT') {
              alert('The request failed because the default profile for the account has already been set - use Update Default Profile instead');
            }
          } else {
            api_response.textContent = response;
            logMessage('The set default profile operation failed; see the API Response for the error');
            return;
          }
        });
        break;
      case 'update_default_profile':
        logMessage('Updating the default profile');
        endpoint = '/configuration';
        options.url = baseURL + endpoint;
        api_request_display.textContent = options.url;
        options.requestType = 'PUT';
        requestBody.account_id = account_id;
        requestBody.default_profile_id = selectedProfile;
        api_request_body_display.textContent = JSON.stringify(requestBody, null, '  ');
        options.requestBody = JSON.stringify(requestBody);
        makeRequest(options, function(response) {
          if (isJson(response)) {
            responseDecoded = JSON.parse(response);
            api_response.textContent = JSON.stringify(responseDecoded, null, '  ');
          } else {
            api_response.textContent = response;
            logMessage('The set default profile operation failed; see the API Response for the error');
            return;
          }
        });
        break;
      default:
        console.log('Should not be getting to the default case - bad request type sent');
        break;
    }
  }

  /**
   * send API request to the proxy
   * @param  {Object} options for the request
   * @param  {String} options.url the full API request URL
   * @param  {String="GET","POST","PATCH","PUT","DELETE"} requestData [options.requestType="GET"] HTTP type for the request
   * @param  {String} options.proxyURL proxyURL to send the request to
   * @param  {String} options.client_id client id for the account (default is in the proxy)
   * @param  {String} options.client_secret client secret for the account (default is in the proxy)
   * @param  {JSON} [options.requestBody] Data to be sent in the request body in the form of a JSON string
   * @param  {Function} [callback] callback function that will process the response
   */
  function makeRequest(options, callback) {
      var httpRequest = new XMLHttpRequest(),
          response,
          requestParams,
          dataString,
          proxyURL    = options.proxyURL,
          // response handler
          getResponse = function() {
              try {
                  if (httpRequest.readyState === 4) {
                      if (httpRequest.status &gt;= 200 &amp;&amp; httpRequest.status &lt; 300) {
                          response = httpRequest.responseText;
                          // some API requests return '{null}' for empty responses - breaks JSON.parse
                          if (response === '{null}') {
                              response = null;
                          }
                          // return the response
                          callback(response);
                      } else {
                          alert('There was a problem with the request. Request returned ' + httpRequest.status);
                      }
                  }
              } catch (e) {
                  alert('Caught Exception: ' + e);
              }
          };
      /**
       * set up request data
       * the proxy used here takes the following params:
       * url - the full API request (required)
       * requestType - the HTTP request type (default: GET)
       * clientId - the client id (defaults here to a Brightcove sample account value - this should always be stored on the server side if possible)
       * clientSecret - the client secret (defaults here to a Brightcove sample account value - this should always be stored on the server side if possible)
       * requestBody - request body for write requests (optional JSON string)
       */
      requestParams = "url=" + encodeURIComponent(options.url) + "&amp;requestType=" + options.requestType;
      // only add client id and secret if both were submitted
      if (options.client_id &amp;&amp; options.client_secret) {
          requestParams += '&amp;client_id=' + options.client_id + '&amp;client_secret=' + options.client_secret;
      }
      // add request data if any
      if (options.requestBody) {
          requestParams += '&amp;requestBody=' + options.requestBody;
      }
      // set response handler
      httpRequest.onreadystatechange = getResponse;
      // open the request
      httpRequest.open('POST', proxyURL);
      // set headers
      httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
      // open and send request
      httpRequest.send(requestParams);
  }

  function init() {
    addCheckboxes(rendition_selector, renditions);
  }

  init();

})(window, document);
</code></pre>

<h3>Proxy (PHP)</h3>

<aside class="bcls-aside bcls-aside--information">In order to build your own version the sample app on this page, you must create and host your own proxy. (The proxies used by Brightcove Learning Services only accept requests from Brightcove domains.) You can download two versions of our proxy code:
<ul>
	<li><a href="//learning-services-media.brightcove.com/doc-assets/proxy/bcls-proxy-for-distribution.php.zip">This is a general version that expects client credentials to be passed with the request</a></li>
	<li><a href="//learning-services-media.brightcove.com/doc-assets/proxy/doc-samples-proxy.php.zip">This version allows you to save your client credentials in the proxy itself on lines 25-26 (recommended)</a></li>
</ul>
</aside>
</section>
</article>
<script src="//learning-services-media.brightcove.com/doc-assets/node/18528-quick-start-ingest-profiles-api-dynamic-delivery/ip-api-quick-start.js">

</script>
