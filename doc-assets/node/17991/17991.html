<link href="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/js/pikaday/pikaday.css" rel="stylesheet" />
<article class="bcls-article">
<section id="dependencies" class="bcls-section">
<h2>Dependencies</h2>

<p>3rd party libraries used in this sample:</p>

<p><a href="https://github.com/dbushell/Pikaday">Pikaday</a></p>
</section>

<section class="bcls-section" id="inputs">
<h2>Inputs</h2>

<fieldset class="bcls-fieldset"><legend>Basic Information</legend>

<p>By default, you will get results from the Brightcove Training Videos account.</p>

<p><button class="bcls-button" id="useMyAccount">Use My Account Instead</button></p>

<div id="basicInfo" style="display:none">
<table class="bcls-table">
	<tbody class="bcls-table__body">
		<tr>
			<td>Video Cloud Account (Publisher ID):</td>
			<td><input id="accountID" class="required aapi-request" type="text" size="55" /></td>
		</tr>
		<tr>
			<td class="align-top no-wrap">Client id:</td>
			<td><input id="client_id" class="required aapi-request" type="text" size="100" value="" />
			<p>&nbsp;</p>
			</td>
		</tr>
		<tr>
			<td class="align-top no-wrap">Client secret:</td>
			<td><input id="client_secret" class="required aapi-request" type="text" size="100" value="" />
			<p>&nbsp;</p>
			</td>
		</tr>
	</tbody>
</table>

<p class="small" id="n1"><sup class="red">[1]</sup> See <a href="/node/14056">Managing API Credentials</a> for information on getting client credentials.</p>
</div>
</fieldset>

<fieldset class="bcls-fieldset"><legend>Date Range for Report</legend>

<p class="text-warning">Note: the date range <strong>must</strong> be set before you fetch the data. If you wish to set a new date range, you will need to refresh the page.</p>

<p>Start: <input id="fromDatePicker" size="30" /></p>

<p>End: <input id="toDatePicker" size="30" /></p>

<p><span class="bcls-button" id="getData">Get Country Data</span></p>

<p class="text-warning" id="gettingDataDisplay">&nbsp;</p>
</fieldset>
</section>

<section class="bcls-section" id="results">
<h2>Results</h2>

<p>Date: <select id="dateSelector"><option value="all" selected="selected">All</option></select> Country: <select id="countrySelector"><option value="all" selected="selected">All</option></select></p>

<table class="bcls-table">
	<thead class="bcls-table__head">
		<tr>
			<th>Country</th>
			<th>Video Views</th>
		</tr>
	</thead>
	<tbody id="reportTableBody">
	</tbody>
</table>
</section>

<section class="bcls-section" id="code">
<h2>Code for the sample</h2>

<p>The JavaScript code for this sample is shown below â€” view source to see the full page code.</p>

<p>&nbsp;</p>

<pre class="line-numbers language-javascript">
<code>
    var BCLS = (function (window, document, Pikaday) {
    'use strict';
    var proxyURL = 'https://solutions.brightcove.com/bcls/bcls-proxy/analyitcs-by-player-day-proxy.php',
        callNumber = 0,
        callType = '',
        // call limit will be reset once we know how many countries have data for the period
        callLimit = 200,
        useMyAccount = document.getElementById('useMyAccount'),
        basicInfo = document.getElementById('basicInfo'),
        accountID = document.getElementById('accountID'),
        client_id = document.getElementById('client_id'),
        client_secret = document.getElementById('client_secret'),
        dateSelector = document.getElementById('dateSelector'),
        reportTableBody = document.getElementById('reportTableBody'),
        account_id = '1752604059001',
        currentDayIndex = 0,
        currentDay,
        dayMax,
        daysObj = {},
        daysArray = [],
        dateToMS,
        dateFromMS,
        fromPicker,
        toPicker,
        analyticsData = {},
        dayMS,
        fromDate = document.getElementById('fromDatePicker'),
        toDate = document.getElementById('toDatePicker'),
        countrySelector = document.getElementById('countrySelector'),
        getData = document.getElementById('getData'),
        gettingDataDisplay = document.getElementById('gettingDataDisplay'),
        today = new Date(),
        weekAgo = new Date(today.valueOf() - 604800000);
        /**
         * Logging function - safe for IE
         * @param  {string} context description of the data
         * @param  {*} message the data to be logged by the console
         * @return {}
         */
        function bclslog(context, message) {
            if (window['console'] &amp;&amp; console['log']) {
              console.log(context, message);
            }
            return;
        }
        // more robust test for strings 'not defined'
        function isDefined (v) {
            if (v === '' || v === null || v === undefined || v === NaN) {
              return false;
            }
            return true;
        }
        /**
         * function that returns iso date for JS date object
         * @param {date} date the date object
         * @return {string} iso date string
         */
        function dateToISO(date) {
            var y = date.getFullYear(),
                m = date.getMonth(),
                d = date.getDate(),
                isoDate;
            y = y.toString();
            m = m + 1;
            if (m ' + analyticsData[day].date + '';
                        iMax = analyticsData[day].items.length;
                        for (i = 0; i ' + item.country_name + '
' + item.video_view + '';
                        }
                    }
                    reportTableBody.innerHTML = displayStr;
                } else {
                    // we have a selected country - display values for all dates
                    selectedCountry = getSelectValue(countrySelector);
                    displayStr = '';
                    for (day in analyticsData) {
                        displayStr += '' + analyticsData[day].date + '';
                        iMax = analyticsData[day].items.length;
                        for (i = 0; i ' + item.country_name + '
' + item.video_view + '';
                            }
                        }
                    }
                    reportTableBody.innerHTML = displayStr;
                }
            } else if (getSelectValue(countrySelector) === 'all') {
                // a specific data is selected - display all countries for that data
                displayStr = '';
                selectedDate = getSelectValue(dateSelector);
                day = analyticsData[selectedDate];
                displayStr += '' + day.date + '';
                iMax = day.items.length;
                for (i = 0; i ' + item.country_name + '
' + item.video_view + '';
                }
                reportTableBody.innerHTML += displayStr;
            } else {
                // a specific date and country are selected - display country views for that date
                displayStr = '';
                selectedDate = getSelectValue(dateSelector);
                selectedCountry = getSelectValue(countrySelector);
                day = analyticsData[selectedDate];
                displayStr += '' + day.date + '';
                iMax = day.items.length;
                for (i = 0; i ' + item.country_name + '
' + item.video_view + '';
                    }
                }
                reportTableBody.innerHTML += displayStr;
            }
        }
        /**
         * make API calls
         * @param {String} callURL the full URL for the API request
         */
        function makeAnalyticsCall(callURL) {
            var httpRequest = new XMLHttpRequest(),
                options = {},
                newItem = {},
                data,
                requestParams,
                newEl,
                txt,
                // response handler
                getResponse = function () {
                    var i,
                        j,
                        k,
                        player,
                        video,
                        itemsMax,
                        str,
                        analytics,
                        item,
                        newItem = {},
                        thisVideo;
                    try {
                        if (httpRequest.readyState === 4) {
                              if (httpRequest.status &gt;= 200 &amp;&amp; httpRequest.status ' + item.country_name + '';
                                }
                                countrySelector.innerHTML = '</code></pre>
</section>
</article>
<option value="all" selected="selected">All</option>

<p><code>' + str; gettingDataDisplay.innerHTML = 'Country data retrieved!'; getData.innerHTML = 'Get Analytics Data'; // now get the analytics data getAnalyticsData(); callLimit = itemsMax; break; case 'analytics': // add the data values to the value object analyticsData[currentDay] = {}; analyticsData[currentDay].date = currentDay; analyticsData[currentDay].items = []; itemsMax = data.items.length; for (i = 0; i ' + item + ''; } dateSelector.innerHTML = '</code></p>
<option value="\'all\'" selected="selected">All</option>

<p><code>' + str; currentDayIndex = 0; currentDay = daysArray[0]; getCountryData(); } // add date pickers to the date input fields fromPicker = new Pikaday({ field: fromDate, format: 'YYYY-MM-DD' }); toPicker = new Pikaday({ field: toDate, format: 'YYYY-MM-DD' }); // default date range values toDate.value = dateToISO(today); fromDate.value = dateToISO(weekAgo); getData.addEventListener('click', initializeData); countrySelector.addEventListener('change', displayData); dateSelector.addEventListener('change', displayData); useMyAccount.addEventListener('click', function () { if (basicInfo.getAttribute('style') === 'display:none;') { basicInfo.setAttribute('style', 'display:block;'); useMyAccount.innerHTML = 'Use Sample Account'; } else { basicInfo.setAttribute('style', 'display:none;'); useMyAccount.innerHTML = 'Use My Account Instead'; } }); })(window, document, Pikaday); </code> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script><script src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/js/pikaday/pikaday.min.js"></script><script src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/analytics-api/code-samples/video-views-by-country-and-day/video-views-by-country-and-day.js"></script></p>
